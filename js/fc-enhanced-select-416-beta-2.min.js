((e,t)=>{"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.FCEnhancedSelect=t()})("undefined"!=typeof global?global:this.window||this.global,function(e){function t(){return s(this).each(function(e,t){f.enhanceFields(t)}),this}function r(e){if(e&&e.options){for(var t,n=[],l=e.options,o=0;o<l.length;o++)(t=l[o]).selected&&n.push(t.value||t.text);return n=1===n.length?n[0]:n}}function a(){this.focus_node.setAttribute("autocomplete","off-"+Date.now())}function u(){var e;FCUtils.isCurrentBreakpointOrSmaller("phablet")&&(e=this.focus_node.closest(p.formRowSelector))&&FCUtils.scrollToElement(e,null,30)}function n(e){e.target.closest(p.inputFieldSelector)&&(e=e.target.closest(p.wrapperElementSelector).parentNode.querySelector("select"),m(e))}function l(e){e.target.closest(p.inputFieldSelector)&&(e=e.target.closest(p.wrapperElementSelector).parentNode.querySelector("select"),S(e))}function o(e){e.target.closest(p.wrapperElementSelector)&&(e=e.target.closest(p.wrapperElementSelector).parentNode.querySelector("select")).tomselect&&f.syncField(e)}function c(e){var t,n;e.target.closest(p.wrapperElementSelector)&&(e=e.target.closest(p.wrapperElementSelector).parentNode.querySelector("select"),t=e)&&t.tomselect&&(n=t.tomselect.isOpen,requestAnimationFrame(function(){(n?S:m)(t)}))}var s=jQuery,i=null!=s,d=!1,f={},p={bodyClass:"has-fc-enhanced-select",formRowSelector:".form-row.fc-select2-field",selectFieldSelector:".fc-select2-field select",wrapperElementSelector:".ts-wrapper",inputFieldSelector:".ts-control > input",fieldSettings:{maxOptions:999999,create:!1,diacritics:!0,openOnFocus:!1},fieldPluginsSingle:[],fieldPluginsMulti:["remove_button"]},m=(i&&(s.fn.select2=t,s.fn.selectWoo=t),f.syncSelectedValue=function(e){var t;e&&e.tomselect&&(t=r(e),e.tomselect.setValue(t,!0))},f.syncDisabledState=function(e){e&&e.tomselect&&e.tomselect.setDisabled(e.disabled)},f.syncOptions=function(e){e&&e.tomselect&&e.tomselect.sync()},f.syncField=function(e){e&&e.tomselect&&(f.syncSelectedValue(e),f.syncDisabledState(e),f.syncOptions(e))},function(e){e&&e.tomselect&&!(e=e.tomselect).isOpen&&e.open()}),S=function(e){e&&e.tomselect&&(e=e.tomselect).isOpen&&e.close()};f.enhanceFields=function(e,t){if(void 0!==window.TomSelect&&("string"==typeof(e=null==e?p.selectFieldSelector:e)||"object"==typeof e&&e.matches("select"))){null==t&&(t=p.fieldSettings);var n=[e];if("string"==typeof e)try{n=document.querySelectorAll(e)}catch(e){return void console.warn("Enhanced select: "+e.message)}for(var l=0;l<n.length;l++){var o=n[l],c=r(o),s=o.hasAttribute("multiple"),i=o.tomselect;i?f.syncField(o):(t.plugins=s?p.fieldPluginsMulti:p.fieldPluginsSingle,(i=new TomSelect(o,t)).setValue(c,!0),i.on("focus",a),i.on("blur",a),i.on("dropdown_open",u))}}},f.enhanceField=function(e,t){f.enhanceFields(e,t)};return f.init=function(e){d||(p=FCUtils.extendObject(p,e),document.addEventListener("click",c,!0),document.addEventListener("change",o,!0),document.addEventListener("focus",n,!0),document.addEventListener("blur",l,!0),i&&s(document).on("change",o),f.enhanceFields(),document.body.classList.add(p.bodyClass),d=!0)},f});