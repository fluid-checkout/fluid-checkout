((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TomSelect=t()})(this,function(){function n(e,t){e.split(/\s+/).forEach(e=>{t(e)})}class ${constructor(){this._events=void 0,this._events={}}on(e,i){n(e,e=>{var t=this._events[e]||[];t.push(i),this._events[e]=t})}off(e,i){var s=arguments.length;0===s?this._events={}:n(e,e=>{var t;1===s?delete this._events[e]:void 0!==(t=this._events[e])&&(t.splice(t.indexOf(i),1),this._events[e]=t)})}trigger(e,...t){var i=this;n(e,e=>{e=i._events[e];void 0!==e&&e.forEach(e=>{e.apply(i,t)})})}}let r=e=>(e=e.filter(Boolean)).length<2?e[0]||"":1==q(e)?"["+e.join("")+"]":"(?:"+e.join("|")+")",l=i=>{if(!V(i))return i.join("");let s="",n=0,o=()=>{1<n&&(s+="{"+n+"}")};return i.forEach((e,t)=>{e===i[t-1]?n++:(o(),s+=e,n=1)}),o(),s},a=e=>{e=t(e);return r(e)},V=e=>new Set(e).size!==e.length,O=e=>(e+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),q=e=>e.reduce((e,t)=>Math.max(e,D(t)),0),D=e=>t(e).length,t=e=>Array.from(e),o=i=>{if(1===i.length)return[[i]];let s=[];var e=i.substring(1);return o(e).forEach(function(e){let t=e.slice(0);t[0]=i.charAt(0)+t[0],s.push(t),(t=e.slice(0)).unshift(i.charAt(0)),s.push(t)}),s},R=[[0,65535]];let g,H,M=3,i={};var s,z={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(s in z){var B=z[s]||"";for(let e=0;e<B.length;e++){var K=B.substring(e,e+1);i[K]=s}}let Q=new RegExp(Object.keys(i).join("|")+"|[̀-ͯ·ʾʼ]","gu"),G=(e,t="NFKD")=>e.normalize(t),v=e=>t(e).reduce((e,t)=>e+U(t),""),U=e=>(e=G(e).toLowerCase().replace(Q,e=>i[e]||""),G(e,"NFC"));let J=e=>{let n={};var t,i=(e,t)=>{var i=n[e]||new Set,s=new RegExp("^"+a(i)+"$","iu");t.match(s)||(i.add(O(t)),n[e]=i)};for(t of function*(e){for(var[t,i]of e)for(let e=t;e<=i;e++){var s=String.fromCharCode(e),n=v(s);n==s.toLowerCase()||n.length>M||0!=n.length&&(yield{folded:n,composed:s,code_point:e})}}(e))i(t.folded,t.folded),i(t.folded,t.composed);return n},W=e=>{var t,i=J(e),s={},n=[];for(t in i){var o=i[t];o&&(s[t]=a(o)),1<t.length&&n.push(O(t))}n.sort((e,t)=>t.length-e.length);e=r(n);return H=new RegExp("^"+e,"u"),s},X=(e,t=1)=>{let i=0;return e=e.map(e=>(g[e]&&(i+=e.length),g[e]||e)),i>=t?l(e):""},Y=(e,t=1)=>(t=Math.max(t,e.length-1),r(o(e).map(e=>X(e,t)))),Z=(e,n=!0)=>{let o=1<e.length?1:0;return r(e.map(t=>{var i=[],s=n?t.length():t.length()-1;for(let e=0;e<s;e++)i.push(Y(t.substrs[e]||"",o));return l(i)}))},ee=(e,t)=>{for(var s of t)if(s.start==e.start&&s.end==e.end&&s.substrs.join("")===e.substrs.join("")){let i=e.parts;s=s.parts.filter(e=>{for(var t of i){if(t.start===e.start&&t.substr===e.substr)return!1;if(1!=e.length&&1!=t.length){if(e.start<t.start&&e.end>t.start)return!0;if(t.start<e.start&&t.end>e.start)return!0}}return!1});if(!(0<s.length))return!0}return!1};class m{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){var i,s=new m,n=JSON.parse(JSON.stringify(this.parts)),o=n.pop();for(i of n)s.add(i);n=t.substr.substring(0,e-o.start),t=n.length;return s.add({start:o.start,end:o.start+t,length:t,substr:n}),s}}let te=i=>{void 0===g&&(g=W(R)),i=v(i);let s="",n=[new m];for(let t=0;t<i.length;t++){var o=i.substring(t).match(H),r=i.substring(t,t+1),l=o?o[0]:null;let e=[];var a,d,c=new Set;for(a of n){var u,p=a.last();!p||1==p.length||p.end<=t?l?(u=l.length,a.add({start:t,end:t+u,length:u,substr:l}),c.add("1")):(a.add({start:t,end:t+1,length:1,substr:r}),c.add("2")):l?(u=a.clone(t,p),p=l.length,u.add({start:t,end:t+p,length:p,substr:l}),e.push(u)):c.add("3")}if(0<e.length)for(var h of e=e.sort((e,t)=>e.length()-t.length()))ee(h,n)||n.push(h);else 0<t&&1==c.size&&!c.has("3")&&(s+=Z(n,!1),o=new m,(d=n[0])&&o.add(d.last()),n=[o])}return s+=Z(n,!0)},ie=(e,t)=>{if(e)return e[t]},se=(e,t)=>{if(e){for(var i,s=t.split(".");(i=s.shift())&&(e=e[i]););return e}},d=(e,t,i)=>{var s;return!e||null==t.regex||-1===(s=(e+="").search(t.regex))?0:(t=t.string.length/e.length,0===s&&(t+=.5),t*i)},c=(e,t)=>{var i=e[t];if("function"==typeof i)return i;i&&!Array.isArray(i)&&(e[t]=[i])},I=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)};class ne{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,n,t){if(!e||!e.length)return[];let o=[];var r,e=e.split(/\s+/);return t&&(r=new RegExp("^("+Object.keys(t).map(O).join("|")+"):(.*)$")),e.forEach(e=>{let t,i=null,s=null;r&&(t=e.match(r))&&(i=t[1],e=t[2]),0<e.length&&(s=this.settings.diacritics?te(e)||null:O(e))&&n&&(s="\\b"+s),o.push({string:e,regex:s?new RegExp(s,"iu"):null,field:i})}),o}getScoreFunction(e,t){e=this.prepareSearch(e,t);return this._getScoreFunction(e)}_getScoreFunction(e){let n=e.tokens,o=n.length;if(!o)return function(){return 0};let s=e.options.fields,r=e.weights,t=s.length,l=e.getAttrFn;if(!t)return function(){return 1};let a=1===t?function(e,t){var i=s[0].field;return d(l(t,i),e,r[i]||1)}:function(i,s){var e,n=0;return i.field?(e=l(s,i.field),!i.regex&&e?n+=1/t:n+=d(e,i,1)):I(r,(e,t)=>{n+=d(l(s,t),i,e)}),n/t};return 1===o?function(e){return a(n[0],e)}:"and"===e.options.conjunction?function(e){var t,i,s=0;for(i of n){if((t=a(i,e))<=0)return 0;s+=t}return s/o}:function(t){var i=0;return I(n,e=>{i+=a(e,t)}),i/o}}getSortFunction(e,t){e=this.prepareSearch(e,t);return this._getSortFunction(e)}_getSortFunction(i){var e,o=[];let s=this,t=i.options,n=!i.query&&t.sort_empty?t.sort_empty:t.sort;if("function"==typeof n)return n.bind(this);function r(e,t){return"$score"===e?t.score:i.getAttrFn(s.items[t.id],e)}if(n)for(var l of n)!i.query&&"$score"===l.field||o.push(l);if(i.query){e=!0;for(var a of o)if("$score"===a.field){e=!1;break}e&&o.unshift({field:"$score",direction:"desc"})}else o=o.filter(e=>"$score"!==e.field);return o.length?function(e,t){var i;for(i of o){var s,n=i.field;if(s=("desc"===i.direction?-1:1)*(s=r(n,e),n=r(n,t),"number"==typeof s&&"number"==typeof n?n<s?1:s<n?-1:0:(s=v(s+"").toLowerCase(),(n=v(n+"").toLowerCase())<s?1:s<n?-1:0)))return s}return 0}:null}prepareSearch(e,t){let i={},s=Object.assign({},t);if(c(s,"sort"),c(s,"sort_empty"),s.fields){c(s,"fields");let t=[];s.fields.forEach(e=>{"string"==typeof e&&(e={field:e,weight:1}),t.push(e),i[e.field]="weight"in e?e.weight:1}),s.fields=t}return{options:s,query:e.toLowerCase().trim(),tokens:this.tokenize(e,s.respect_word_boundaries,i),total:0,items:[],weights:i,getAttrFn:s.nesting?se:ie}}search(e,i){var s,n=this.prepareSearch(e,i);i=n.options,e=n.query;let o=i.score||this._getScoreFunction(n);e.length?I(this.items,(e,t)=>{s=o(e),(!1===i.filter||0<s)&&n.items.push({score:s,id:t})}):I(this.items,(e,t)=>{n.items.push({score:1,id:t})});e=this._getSortFunction(n);return e&&n.items.sort(e),n.total=n.items.length,"number"==typeof i.limit&&(n.items=n.items.slice(0,i.limit)),n}}let b=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)},u=e=>{var t;return e.jquery?e[0]:e instanceof HTMLElement?e:oe(e)?((t=document.createElement("template")).innerHTML=e.trim(),t.content.firstChild):document.querySelector(e)},oe=e=>"string"==typeof e&&-1<e.indexOf("<"),p=(e,t)=>{var i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)},h=(e,t)=>{Object.assign(e.style,t)},w=(e,...t)=>{var i=re(t);(e=le(e)).map(t=>{i.map(e=>{t.classList.add(e)})})},A=(e,...t)=>{var i=re(t);(e=le(e)).map(t=>{i.map(e=>{t.classList.remove(e)})})},re=e=>{var t=[];return b(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},le=e=>e=Array.isArray(e)?e:[e],_=(e,t,i)=>{if(!i||i.contains(e))for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},ae=(e,t=0)=>0<t?e[e.length-1]:e[0],f=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var i=0;e=e.previousElementSibling;)e.matches(t)&&i++;return i},x=(i,e)=>{b(e,(e,t)=>{null==e?i.removeAttribute(t):i.setAttribute(t,""+e)})},k=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},y="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var de={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return 0<e.length},render:{}};let C=e=>null==e?null:F(e),F=e=>"boolean"==typeof e?e?"1":"0":e+"",S=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ce=(t,i,e)=>{var s,n=t.trigger,o={};t.trigger=function(){var e=arguments[0];if(-1===i.indexOf(e))return n.apply(t,arguments);o[e]=arguments},e.apply(t,[]),t.trigger=n;for(s of i)s in o&&n.apply(t,o[s])},L=(e,t=!1)=>{e&&(e.preventDefault(),t)&&e.stopPropagation()},E=(e,t,i,s)=>{e.addEventListener(t,i,s)},T=(e,t)=>!!t&&!!t[e]&&1==(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0),P=(e,t)=>{var i=e.getAttribute("id");return i||(e.setAttribute("id",t),t)},ue=e=>e.replace(/[\\"']/g,"\\$&"),N=(e,t)=>{t&&e.append(t)};function pe(e,t){var i,o=Object.assign({},de,t),s=o.dataAttr,r=o.labelField,l=o.valueField,a=o.disabledField,d=o.optgroupField,c=o.optgroupLabelField,u=o.optgroupValueField,n=e.tagName.toLowerCase(),p=e.getAttribute("placeholder")||e.getAttribute("data-placeholder"),h=(p||o.allowEmptyOption||(i=e.querySelector('option[value=""]'))&&(p=i.textContent),{placeholder:p,options:[],optgroups:[],items:[],maxItems:null});if("select"===n){var g,v=h.options,m={},f=1;let n=0;var y=e=>{var e=Object.assign({},e.dataset),t=s&&e[s];return e="string"==typeof t&&t.length?Object.assign(e,JSON.parse(t)):e},O=(e,t)=>{var i,s=C(e.value);null!=s&&(s||o.allowEmptyOption)&&(m.hasOwnProperty(s)?t&&((i=m[s][d])?Array.isArray(i)?i.push(t):m[s][d]=[i,t]:m[s][d]=t):((i=y(e))[r]=i[r]||e.textContent,i[l]=i[l]||s,i[a]=i[a]||e.disabled,i[d]=i[d]||t,i.$option=e,i.$order=i.$order||++n,m[s]=i,v.push(i)),e.selected)&&h.items.push(s)};h.maxItems=e.hasAttribute("multiple")?null:1,b(e.children,e=>{var t,i,s;"optgroup"===(g=e.tagName.toLowerCase())?((s=y(t=e))[c]=s[c]||t.getAttribute("label")||"",s[u]=s[u]||f++,s[a]=s[a]||t.disabled,s.$order=s.$order||++n,h.optgroups.push(s),i=s[u],b(t.children,e=>{O(e,i)})):"option"===g&&O(e)})}else(i=e.getAttribute(s))?(h.options=JSON.parse(i),b(h.options,e=>{h.items.push(e[l])})):(i=e.value.trim()||"",(o.allowEmptyOption||i.length)&&(i=i.split(o.delimiter),b(i,e=>{var t={};t[r]=e,t[l]=e,h.options.push(t)}),h.items=i));return Object.assign({},de,h,t)}var j,he=0;class e extends(j=$,j.plugins={},class extends j{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){j.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,i;let s=this,n=[];if(Array.isArray(e))e.forEach(e=>{"string"==typeof e?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(;i=n.shift();)s.require(i)}loadPlugin(e){var t=this.plugins,i=j.plugins[e];if(!j.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(this,[this.plugins.settings[e]||{}]),t.names.push(e)}require(e){var t=this.plugins;if(!this.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');this.loadPlugin(e)}return t.loaded[e]}}){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,he++;var i=u(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s,e=(window.getComputedStyle&&window.getComputedStyle(i,null)).getPropertyValue("direction"),t=pe(i,t),n=(this.settings=t,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag="select"===i.tagName.toLowerCase(),this.rtl=/rtl/i.test(e),this.inputId=P(i,"tomselect-"+he),this.isRequired=i.required,this.sifter=new ne(this.options,{diacritics:t.diacritics}),t.mode=t.mode||(1===t.maxItems?"single":"multi"),"boolean"!=typeof t.hideSelected&&(t.hideSelected="multi"===t.mode),"boolean"!=typeof t.hidePlaceholder&&(t.hidePlaceholder="multi"!==t.mode),t.createFilter),e=("function"!=typeof n&&((n="string"==typeof n?new RegExp(n):n)instanceof RegExp?t.createFilter=e=>n.test(e):t.createFilter=e=>this.settings.duplicates||!this.options[e]),this.initializePlugins(t.plugins),this.setupCallbacks(),this.setupTemplates(),u("<div>")),o=u("<div>"),r=this._render("dropdown"),l=u('<div role="listbox" tabindex="-1">'),a=this.input.getAttribute("class")||"",d=t.mode;w(e,t.wrapperClass,a,d),w(o,t.controlClass),N(e,o),w(r,t.dropdownClass,d),t.copyClassesToDropdown&&w(r,a),w(l,t.dropdownContentClass),N(r,l),u(t.dropdownParent||e).appendChild(r),oe(t.controlInput)?(s=u(t.controlInput),I(["autocorrect","autocapitalize","autocomplete","spellcheck"],e=>{i.getAttribute(e)&&x(s,{[e]:i.getAttribute(e)})}),s.tabIndex=-1,o.appendChild(s),this.focus_node=s):t.controlInput?(s=u(t.controlInput),this.focus_node=s):(s=u("<input/>"),this.focus_node=o),this.wrapper=e,this.dropdown=r,this.dropdown_content=l,this.control=o,this.control_input=s,this.setup()}setup(){let i=this;var e=i.settings;let s=i.control_input,n=i.dropdown;var t=i.dropdown_content;let o=i.wrapper,r=i.control;var l,a,d,c=i.input,u=i.focus_node,p={passive:!0},h=i.inputId+"-ts-dropdown",h=(x(t,{id:h}),x(u,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":h}),P(u,i.inputId+"-ts-control")),g="label[for='"+i.inputId.replace(/['"\\]/g,"\\$&")+"']";let v=document.querySelector(g),m=i.focus.bind(i),f=(v&&(E(v,"click",m),x(v,{for:h}),g=P(v,i.inputId+"-ts-label"),x(u,{"aria-labelledby":g}),x(t,{"aria-labelledby":g})),o.style.width=c.style.width,i.plugins.names.length&&(h="plugin-"+i.plugins.names.join(" plugin-"),w([o,n],h)),(null===e.maxItems||1<e.maxItems)&&i.is_select_tag&&x(c,{multiple:"multiple"}),e.placeholder&&x(s,{placeholder:e.placeholder}),!e.splitOn&&e.delimiter&&(e.splitOn=new RegExp("\\s*"+O(e.delimiter)+"+\\s*")),e.load&&e.loadThrottle&&(e.load=(l=e.load,a=e.loadThrottle,function(e,t){var i=this;d&&(i.loading=Math.max(i.loading-1,0),clearTimeout(d)),d=setTimeout(function(){d=null,i.loadedSearches[e]=!0,l.call(i,e,t)},a)})),E(n,"mousemove",()=>{i.ignoreHover=!1}),E(n,"mouseenter",e=>{var t=_(e.target,"[data-selectable]",n);t&&i.onOptionHover(e,t)},{capture:!0}),E(n,"click",e=>{var t=_(e.target,"[data-selectable]");t&&(i.onOptionSelect(e,t),L(e,!0))}),E(r,"click",e=>{var t=_(e.target,"[data-ts-item]",r);t&&i.onItemSelect(e,t)?L(e,!0):""==s.value&&(i.onClick(),L(e,!0))}),E(u,"keydown",e=>i.onKeyDown(e)),E(s,"keypress",e=>i.onKeyPress(e)),E(s,"input",e=>i.onInput(e)),E(u,"blur",e=>i.onBlur(e)),E(u,"focus",e=>i.onFocus(e)),E(s,"paste",e=>i.onPaste(e)),e=>{var t=e.composedPath()[0];o.contains(t)||n.contains(t)?t==s&&i.isOpen?e.stopPropagation():L(e,!0):(i.isFocused&&i.blur(),i.inputState())}),y=()=>{i.isOpen&&i.positionDropdown()};E(document,"mousedown",f),E(window,"scroll",y,p),E(window,"resize",y,p),this._destroy=()=>{document.removeEventListener("mousedown",f),window.removeEventListener("scroll",y),window.removeEventListener("resize",y),v&&v.removeEventListener("click",m)},this.revertSettings={innerHTML:c.innerHTML,tabIndex:c.tabIndex},c.tabIndex=-1,c.insertAdjacentElement("afterend",i.wrapper),i.sync(!1),e.items=[],delete e.optgroups,delete e.options,E(c,"invalid",()=>{i.isValid&&(i.isValid=!1,i.isInvalid=!0,i.refreshState())}),i.updateOriginalInput(),i.refreshItems(),i.close(!1),i.inputState(),i.isSetup=!0,c.disabled?i.disable():c.readOnly?i.setReadOnly(!0):i.enable(),i.on("change",this.onChange),w(c,"tomselected","ts-hidden-accessible"),i.trigger("initialize"),!0===e.preload&&i.preload()}setupOptions(e=[],t=[]){this.addOptions(e),I(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var i=this.settings.labelField,s=this.settings.optgroupLabelField;this.settings.render=Object.assign({},{optgroup:e=>{var t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[s])+"</div>",option:(e,t)=>"<div>"+t(e[i])+"</div>",item:(e,t)=>"<div>"+t(e[i])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"},this.settings.render)}setupCallbacks(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)(t=this.settings[i[e]])&&this.on(e,t)}sync(e=!0){var t=this,e=e?pe(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(e.options,e.optgroups),t.setValue(e.items||[],!0),t.lastQuery=null}onClick(){var e=this;0<e.activeItems.length?(e.clearActiveItems(),e.focus()):e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){p(this.input,"input"),p(this.input,"change")}onPaste(e){var t=this;t.isInputHidden||t.isLocked?L(e):t.settings.splitOn&&setTimeout(()=>{var e=t.inputValue();e.match(t.settings.splitOn)&&(e=e.trim().split(t.settings.splitOn),I(e,e=>{C(e)&&(this.options[e]?t.addItem(e):t.createItem(e))}))},0)}onKeyPress(e){var t,i=this;i.isLocked?L(e):(t=String.fromCharCode(e.keyCode||e.which),i.settings.create&&"multi"===i.settings.mode&&t===i.settings.delimiter&&(i.createItem(),L(e)))}onKeyDown(e){var t,i=this;if(i.ignoreHover=!0,i.isLocked)9!==e.keyCode&&L(e);else{switch(e.keyCode){case 65:if(T(y,e)&&""==i.control_input.value)return L(e),void i.selectAll();break;case 27:return i.isOpen&&(L(e,!0),i.close()),void i.clearActiveItems();case 40:return!i.isOpen&&i.hasOptions?i.open():i.activeOption&&(t=i.getAdjacent(i.activeOption,1))&&i.setActiveOption(t),void L(e);case 38:return i.activeOption&&(t=i.getAdjacent(i.activeOption,-1))&&i.setActiveOption(t),void L(e);case 13:return void(i.canSelect(i.activeOption)?(i.onOptionSelect(e,i.activeOption),L(e)):(i.settings.create&&i.createItem()||document.activeElement==i.control_input&&i.isOpen)&&L(e));case 37:return void i.advanceSelection(-1,e);case 39:return void i.advanceSelection(1,e);case 9:return void(i.settings.selectOnTab&&(i.canSelect(i.activeOption)&&(i.onOptionSelect(e,i.activeOption),L(e)),i.settings.create)&&i.createItem()&&L(e));case 8:case 46:return void i.deleteSelection(e)}i.isInputHidden&&!T(y,e)&&L(e)}}onInput(e){var t,i;this.isLocked||(t=this.inputValue(),this.lastValue!==t&&(""==(this.lastValue=t)?this._onInput():(this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=(t=()=>{this.refreshTimeout=null,this._onInput()},0<(i=this.settings.refreshThrottle)?setTimeout(t,i):(t.call(null),null)))))}_onInput(){var e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,i=t.isFocused;t.isDisabled||t.isReadOnly?(t.blur(),L(e)):t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.preload(),i||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){var t,i;!1!==document.hasFocus()&&(t=this).isFocused&&(t.isFocused=!1,t.ignoreFocus=!1,i=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,i):i())}onOptionSelect(e,t){var i,s=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?s.createItem(null,()=>{s.settings.closeAfterSelect&&s.close()}):void 0!==(i=t.dataset.value)&&(s.lastQuery=null,s.addItem(i),s.settings.closeAfterSelect&&s.close(),!s.settings.hideSelected)&&e.type&&/click/.test(e.type)&&s.setActiveOption(t))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){return!this.isLocked&&"multi"===this.settings.mode&&(L(e),this.setActiveItem(t,e),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){var t,i=this;i.canLoad(e)&&(w(i.wrapper,i.settings.loadingClass),i.loading++,t=i.loadCallback.bind(i),i.settings.load.call(i,e,t))}loadCallback(e,t){var i=this;i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(e,t),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||A(i.wrapper,i.settings.loadingClass),i.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input;t.value!==e&&(t.value=e,p(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var i=t?[]:["change"];ce(this,i,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){this.settings.maxItems=e=0===e?null:e,this.refreshState()}setActiveItem(e,t){var i,s,n,o,r,l=this;if("single"!==l.settings.mode)if(e){if("click"===(i=t&&t.type.toLowerCase())&&T("shiftKey",t)&&l.activeItems.length){for(r=l.getLastActive(),r=Array.prototype.indexOf.call(l.control.children,r),(n=Array.prototype.indexOf.call(l.control.children,e))<r&&(o=r,r=n,n=o),s=r;s<=n;s++)e=l.control.children[s],-1===l.activeItems.indexOf(e)&&l.setActiveItemClass(e);L(t)}else"click"===i&&T(y,t)||"keydown"===i&&T("shiftKey",t)?e.classList.contains("active")?l.removeActiveItem(e):l.setActiveItemClass(e):(l.clearActiveItems(),l.setActiveItemClass(e));l.inputState(),l.isFocused||l.focus()}else l.clearActiveItems(),l.isFocused&&l.inputState()}setActiveItemClass(e){var t=this.control.querySelector(".last-active");t&&A(t,"last-active"),w(e,"active last-active"),this.trigger("item_select",e),-1==this.activeItems.indexOf(e)&&this.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),A(e,"active")}clearActiveItems(){A(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e)&&(this.activeOption=e,x(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),x(e,{"aria-selected":"true"}),w(e,"active"),t)&&this.scrollToOption(e)}scrollToOption(e,t){var i,s,n,o;e&&(s=(i=this.dropdown_content).clientHeight,o=e.offsetHeight,s+(n=i.scrollTop||0)<(e=e.getBoundingClientRect().top-i.getBoundingClientRect().top+n)+o?this.scroll(e-s+o,t):e<n&&this.scroll(e,t))}scroll(e,t){var i=this.dropdown_content;t&&(i.style.scrollBehavior=t),i.scrollTop=e,i.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(A(this.activeOption,"active"),x(this.activeOption,{"aria-selected":null})),this.activeOption=null,x(this.focus_node,{"aria-activedescendant":null})}selectAll(){let t=this;var e;"single"!==t.settings.mode&&(e=t.controlChildren()).length&&(t.inputState(),t.close(),t.activeItems=e,I(e,e=>{t.setActiveItemClass(e)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(x(e.control_input,{placeholder:e.settings.placeholder}),0<e.activeItems.length||!e.isFocused&&e.settings.hidePlaceholder&&0<e.items.length?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&0<e.items.length&&x(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,(e.control_input.offsetWidth?e.control_input:e.focus_node).focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return"string"==typeof e.sortField&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,i,s=this,n=this.getSearchOptions();if(s.settings.score&&"function"!=typeof(i=s.settings.score.call(s,e)))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==s.lastQuery?(s.lastQuery=e,t=s.sifter.search(e,Object.assign(n,{score:i})),s.currentResults=t):t=Object.assign({},s.currentResults),s.settings.hideSelected&&(t.items=t.items.filter(e=>{e=C(e.id);return!(e&&-1!==s.items.indexOf(e))})),t}refreshOptions(e=!0){var i,s,t,n,o,r,l,a,d;let c={},u=[];for(var p=this,h=p.inputValue(),g=h===p.lastQuery||""==h&&null==p.lastQuery,v=p.search(h),m=null,f=p.settings.shouldOpen||!1,y=p.dropdown_content,O=(g&&(m=p.activeOption)&&(a=m.closest("[data-group]")),t=v.items.length,0<(t="number"==typeof p.settings.maxOptions?Math.min(t,p.settings.maxOptions):t)&&(f=!0),0);O<t;O++){var b=v.items[O];if(b){var w=b.id,_=p.options[w];if(void 0!==_){b=F(w);let t=p.getOption(b,!0);for(p.settings.hideSelected||t.classList.toggle("selected",p.items.includes(b)),n=_[p.settings.optgroupField]||"",i=0,s=(o=Array.isArray(n)?n:[n])&&o.length;i<s;i++){n=o[i];let e=_.$order;var C=p.optgroups[n],[C,S]=(void 0===C?n="":e=C.$order,((e,t)=>{if(void 0!==(s=c[e])){var i=u[s];if(void 0!==i)return[s,i.fragment]}var i=document.createDocumentFragment(),s=u.length;return u.push({fragment:i,order:t,optgroup:e}),[s,i]})(n,e));0<i&&(t=t.cloneNode(!0),x(t,{id:_.$id+"-clone-"+i,"aria-selected":null}),t.classList.add("ts-cloned"),A(t,"active"),p.activeOption)&&p.activeOption.dataset.value==w&&a&&a.dataset.group===n.toString()&&(m=t),S.appendChild(t),""!=n&&(c[n]=C)}}}}p.settings.lockOptgroupOrder&&u.sort((e,t)=>e.order-t.order),r=document.createDocumentFragment(),I(u,e=>{var t,i,s=e.fragment;s&&s.children.length&&(void 0!==(e=p.optgroups[e.optgroup])?(t=document.createDocumentFragment(),i=p.render("optgroup_header",e),N(t,i),N(t,s),i=p.render("optgroup",{group:e,options:t}),N(r,i)):N(r,s))}),y.innerHTML="",N(y,r),p.settings.highlight&&((e=>{e=e.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()})})(y),v.query.length)&&v.tokens.length&&I(v.tokens,e=>{((e,s)=>{if(null===s)return;if("string"==typeof s){if(!s.length)return;s=new RegExp(s,"i")}let t=e=>{var t,i=e.data.match(s);return i&&0<e.data.length?((t=document.createElement("span")).className="highlight",(e=e.splitText(i.index)).splitText(i[0].length),i=e.cloneNode(!0),t.appendChild(i),k(e,t),1):0},i=e=>{1!==e.nodeType||!e.childNodes||/(script|style)/i.test(e.tagName)||"highlight"===e.className&&"SPAN"===e.tagName||Array.from(e.childNodes).forEach(e=>{n(e)})},n=e=>3===e.nodeType?t(e):(i(e),0);n(e)})(y,e.regex)});g=e=>{e=p.render(e,{input:h});return e&&(f=!0,y.insertBefore(e,y.firstChild)),e};if(p.loading?g("loading"):p.settings.shouldLoad.call(p,h)?0===v.items.length&&g("no_results"):g("not_loading"),(l=p.canCreate(h))&&(d=g("option_create")),p.hasOptions=0<v.items.length||l,f){if(0<v.items.length){if(m||"single"!==p.settings.mode||null==p.items[0]||(m=p.getOption(p.items[0])),!y.contains(m)){let e=0;d&&!p.settings.addPrecedence&&(e=1),m=p.selectable()[e]}}else d&&(m=d);e&&!p.isOpen&&(p.open(),p.scrollToOption(m,"auto")),p.setActiveOption(m)}else p.clearActiveOption(),e&&p.isOpen&&p.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){var i,s=this;return Array.isArray(e)?(s.addOptions(e,t),!1):null!==(i=C(e[s.settings.valueField]))&&!s.options.hasOwnProperty(i)&&(e.$order=e.$order||++s.order,e.$id=s.inputId+"-opt-"+e.$order,s.options[i]=e,s.lastQuery=null,t&&(s.userOptions[i]=t,s.trigger("option_add",i,e)),i)}addOptions(e,t=!1){I(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=C(e[this.settings.optgroupValueField]);return null!==t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){var i=this,e=C(e),s=C(t[i.settings.valueField]);if(null!==e){var n=i.options[e];if(null!=n){if("string"!=typeof s)throw new Error("Value must be set in option data");var o=i.getOption(e),r=i.getItem(e);t.$order=t.$order||n.$order,delete i.options[e],i.uncacheValue(s),i.options[s]=t,o&&(i.dropdown_content.contains(o)&&(n=i._render("option",t),k(o,n),i.activeOption===o)&&i.setActiveOption(n),o.remove()),r&&(-1!==(n=i.items.indexOf(e))&&i.items.splice(n,1,s),o=i._render("item",t),r.classList.contains("active")&&w(o,"active"),k(r,o)),i.lastQuery=null}}}removeOption(e,t){var i=this;e=F(e),i.uncacheValue(e),delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)}clearOptions(e){let i=(e||this.clearFilter).bind(this),s=(this.loadedSearches={},this.userOptions={},this.clearCache(),{});I(this.options,(e,t)=>{i(e,t)&&(s[t]=e)}),this.options=this.sifter.items=s,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return 0<=this.items.indexOf(t)}getOption(e,t=!1){e=C(e);if(null!==e){e=this.options[e];if(null!=e){if(e.$div)return e.$div;if(t)return this._render("option",e)}}return null}getAdjacent(t,i,e="option"){var s;if(t){s="item"==e?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let e=0;e<s.length;e++)if(s[e]==t)return 0<i?s[e+1]:s[e-1]}return null}getItem(e){return"object"==typeof e?e:null!==(e=C(e))?this.control.querySelector(`[data-value="${ue(e)}"]`):null}addItems(e,t){var i=this,e=Array.isArray(e)?e:[e];let s=(e=e.filter(e=>-1===i.items.indexOf(e)))[e.length-1];e.forEach(e=>{i.isPending=e!==s,i.addItem(e,t)})}addItem(r,l){var e=l?[]:["change","dropdown_close"];ce(this,e,()=>{var e,t,i,s=this,n=s.settings.mode,o=C(r);o&&-1!==s.items.indexOf(o)&&("single"===n&&s.close(),"single"===n||!s.settings.duplicates)||null!==o&&s.options.hasOwnProperty(o)&&("single"===n&&s.clear(l),"multi"===n&&s.isFull()||(i=s._render("item",s.options[o]),s.control.contains(i)&&(i=i.cloneNode(!0)),e=s.isFull(),s.items.splice(s.caretPos,0,o),s.insertAtCaret(i),s.isSetup&&(!s.isPending&&s.settings.hideSelected&&(t=s.getOption(o),t=s.getAdjacent(t,1))&&s.setActiveOption(t),s.isPending||s.settings.closeAfterSelect||s.refreshOptions(s.isFocused&&"single"!==n),0!=s.settings.closeAfterSelect&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",o,i),s.isPending||s.updateOriginalInput({silent:l})),s.isPending&&(e||!s.isFull()))||(s.inputState(),s.refreshState()))})}removeItem(e=null,t){var i,s,n,o=this;(e=o.getItem(e))&&(s=e.dataset.value,n=f(e),e.remove(),e.classList.contains("active")&&(i=o.activeItems.indexOf(e),o.activeItems.splice(i,1),A(e,"active")),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(s)&&o.removeOption(s,t),n<o.caretPos&&o.setCaret(o.caretPos-1),o.updateOriginalInput({silent:t}),o.refreshState(),o.positionDropdown(),o.trigger("item_remove",s,e))}createItem(e=null,i=()=>{}){"function"!=typeof(i=3===arguments.length?arguments[2]:i)&&(i=()=>{});var s=this,n=s.caretPos;if(e=e||s.inputValue(),!s.canCreate(e))return i(),!1;s.lock();var o=!1,t=e=>{var t;return s.unlock(),!e||"object"!=typeof e||"string"!=typeof(t=C(e[s.settings.valueField]))?i():(s.setTextboxValue(),s.addOption(e,!0),s.setCaret(n),s.addItem(t),i(e),void(o=!0))},e="function"==typeof s.settings.create?s.settings.create.call(this,e,t):{[s.settings.labelField]:e,[s.settings.valueField]:e};return o||t(e),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){var e=this,t=(e.refreshValidityState(),e.isFull()),i=e.isLocked,s=(e.wrapper.classList.toggle("rtl",e.rtl),e.wrapper.classList);s.toggle("focus",e.isFocused),s.toggle("disabled",e.isDisabled),s.toggle("readonly",e.isReadOnly),s.toggle("required",e.isRequired),s.toggle("invalid",!e.isValid),s.toggle("locked",i),s.toggle("full",t),s.toggle("input-active",e.isFocused&&!e.isInputHidden),s.toggle("dropdown-active",e.isOpen),s.toggle("has-options",(i=e.options,0===Object.keys(i).length)),s.toggle("has-items",0<e.items.length)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){let o=this;var t,i;let r=o.input.querySelector('option[value=""]');if(o.is_select_tag){let s=[],n=o.input.querySelectorAll("option:checked").length;function l(e,t,i){return(e=e||u('<option value="'+S(t)+'">'+S(i)+"</option>"))!=r&&o.input.append(e),s.push(e),(e!=r||0<n)&&(e.selected=!0),e}o.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),0==o.items.length&&"single"==o.settings.mode?l(r,"",""):o.items.forEach(e=>{t=o.options[e],i=t[o.settings.labelField]||"",s.includes(t.$option)?l(o.input.querySelector(`option[value="${ue(e)}"]:not(:checked)`),e,i):t.$option=l(t.$option,e,i)})}else o.input.value=o.getValue();o.isSetup&&!e.silent&&o.trigger("change",o.getValue())}open(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.isOpen=!0,x(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),h(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),h(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,i=t.isOpen;e&&(t.setTextboxValue(),"single"===t.settings.mode)&&t.items.length&&t.inputState(),t.isOpen=!1,x(t.focus_node,{"aria-expanded":"false"}),h(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),i&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){var e,t,i;"body"===this.settings.dropdownParent&&(e=(t=this.control).getBoundingClientRect(),t=t.offsetHeight+e.top+window.scrollY,i=e.left+window.scrollX,h(this.dropdown,{width:e.width+"px",top:t+"px",left:i+"px"}))}clear(e){var t,i=this;i.items.length&&(t=i.controlChildren(),I(t,e=>{i.removeItem(e,!0)}),i.inputState(),e||i.updateOriginalInput(),i.trigger("clear"))}insertAtCaret(e){var t=this.caretPos,i=this.control;i.insertBefore(e,i.children[t]||null),this.setCaret(t+1)}deleteSelection(e){var t,i=this,s=e&&8===e.keyCode?-1:1,n={start:(n=i.control_input).selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)};let o=[];if(i.activeItems.length)t=ae(i.activeItems,s),t=f(t),0<s&&t++,I(i.activeItems,e=>o.push(e));else if((i.isFocused||"single"===i.settings.mode)&&i.items.length){var r=i.controlChildren();let e;s<0&&0===n.start&&0===n.length?e=r[i.caretPos-1]:0<s&&n.start===i.inputValue().length&&(e=r[i.caretPos]),void 0!==e&&o.push(e)}if(!i.shouldDelete(o,e))return!1;for(L(e,!0),void 0!==t&&i.setCaret(t);o.length;)i.removeItem(o.pop());return i.inputState(),i.positionDropdown(),i.refreshOptions(!1),!0}shouldDelete(e,t){e=e.map(e=>e.dataset.value);return!(!e.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete(e,t))}advanceSelection(e,t){var i,s=this;s.rtl&&(e*=-1),s.inputValue().length||(T(y,t)||T("shiftKey",t)?(i=(t=s.getLastActive(e))?t.classList.contains("active")?s.getAdjacent(t,e,"item"):t:0<e?s.control_input.nextElementSibling:s.control_input.previousElementSibling)&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i)):s.moveCaret(e))}moveCaret(e){}getLastActive(e){var t=this.control.querySelector(".last-active");return t||((t=this.control.querySelectorAll(".active"))?ae(t,e):void 0)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,A(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var i,s,n=this;return"function"==typeof this.settings.render[e]&&(i=n.settings.render[e].call(this,t,S))?(i=u(i),"option"===e||"option_create"===e?t[n.settings.disabledField]?x(i,{"aria-disabled":"true"}):x(i,{"data-selectable":""}):"optgroup"===e&&(s=t.group[n.settings.optgroupValueField],x(i,{"data-group":s}),t.group[n.settings.disabledField])&&x(i,{"data-disabled":""}),"option"!==e&&"item"!==e||(s=F(t[n.settings.valueField]),x(i,{"data-value":s}),"item"===e?(w(i,n.settings.itemClass),x(i,{"data-ts-item":""})):(w(i,n.settings.optionClass),x(i,{role:"option",id:t.$id}),t.$div=i,n.options[s]=t)),i):null}_render(e,t){e=this.render(e,t);if(null==e)throw"HTMLElement expected";return e}clearCache(){I(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){e=this.getOption(e);e&&e.remove()}canCreate(e){return this.settings.create&&0<e.length&&this.settings.createFilter.call(this,e)}hook(i,e,s){var n=this,o=n[e];n[e]=function(){var e,t;return"after"===i&&(e=o.apply(n,arguments)),t=s.apply(n,arguments),"instead"===i?t:"before"===i?o.apply(n,arguments):e}}}return e.define("change_listener",function(){E(this.input,"change",()=>{this.sync()})}),e.define("checkbox_options",function(e){var n=this,i=n.onOptionSelect;n.settings.hideSelected=!1;let o=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},e);function s(t){setTimeout(()=>{var e=t.querySelector("input."+o.className);e instanceof HTMLInputElement&&r(e,t.classList.contains("selected"))},1)}var r=function(e,t){t?(e.checked=!0,o.uncheckedClassNames&&e.classList.remove(...o.uncheckedClassNames),o.checkedClassNames&&e.classList.add(...o.checkedClassNames)):(e.checked=!1,o.checkedClassNames&&e.classList.remove(...o.checkedClassNames),o.uncheckedClassNames&&e.classList.add(...o.uncheckedClassNames))};n.hook("after","setupTemplates",()=>{var s=n.settings.render.option;n.settings.render.option=(e,t)=>{var t=u(s.call(n,e,t)),i=document.createElement("input"),e=(o.className&&i.classList.add(o.className),i.addEventListener("click",function(e){L(e)}),i.type="checkbox",C(e[n.settings.valueField]));return r(i,!!(e&&-1<n.items.indexOf(e))),t.prepend(i),t}}),n.on("item_remove",e=>{e=n.getOption(e);e&&(e.classList.remove("selected"),s(e))}),n.on("item_add",e=>{e=n.getOption(e);e&&s(e)}),n.hook("instead","onOptionSelect",(e,t)=>{t.classList.contains("selected")?(t.classList.remove("selected"),n.removeItem(t.dataset.value),n.refreshOptions(),L(e,!0)):(i.call(n,e,t),s(t))})}),e.define("clear_button",function(e){let t=this,i=Object.assign({className:"clear-button",title:"Clear All",html:e=>`<div class="${e.className}" title="${e.title}">&#10799;</div>`},e);t.on("initialize",()=>{var e=u(i.html(i));e.addEventListener("click",e=>{t.isLocked||(t.clear(),"single"===t.settings.mode&&t.settings.allowEmptyOption&&t.addItem(""),e.preventDefault(),e.stopPropagation())}),t.control.appendChild(e)})}),e.define("drag_drop",function(){var l=this;if("multi"===l.settings.mode){var e=l.lock,t=l.unlock;let n=!0,r;l.hook("after","setupTemplates",()=>{var s=l.settings.render.item;l.settings.render.item=(e,t)=>{let o=u(s.call(l,e,t));x(o,{draggable:"true"});e=e=>{e.preventDefault(),o.classList.add("ts-drag-over"),i(o,r)};let i=(e,t)=>{var i,s,n;void 0!==t&&(((e,t)=>{do{if(e==(t=null==t?void 0:t.previousElementSibling))return!0}while(t&&t.previousElementSibling);return!1})(t,o)?(s=t,null!=(n=(i=e).parentNode)&&n.insertBefore(s,i.nextSibling)):(n=t,null!=(i=(s=e).parentNode)&&i.insertBefore(n,s)))};return E(o,"mousedown",e=>{n||L(e),e.stopPropagation()}),E(o,"dragstart",e=>{r=o,setTimeout(()=>{o.classList.add("ts-dragging")},0)}),E(o,"dragenter",e),E(o,"dragover",e),E(o,"dragleave",()=>{o.classList.remove("ts-drag-over")}),E(o,"dragend",()=>{document.querySelectorAll(".ts-drag-over").forEach(e=>e.classList.remove("ts-drag-over")),null!=(e=r)&&e.classList.remove("ts-dragging"),r=void 0;var e,t=[];l.control.querySelectorAll("[data-value]").forEach(e=>{e.dataset.value&&(e=e.dataset.value)&&t.push(e)}),l.setValue(t)}),o}}),l.hook("instead","lock",()=>(n=!1,e.call(l))),l.hook("instead","unlock",()=>(n=!0,t.call(l)))}}),e.define("dropdown_header",function(e){let i=this,s=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:e=>'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a class="'+e.closeClass+'">&times;</a></div></div>'},e);i.on("initialize",()=>{var e=u(s.html(s)),t=e.querySelector("."+s.closeClass);t&&t.addEventListener("click",e=>{L(e,!0),i.close()}),i.dropdown.insertBefore(e,i.dropdown.firstChild)})}),e.define("caret_position",function(){var s=this;s.hook("instead","setCaret",i=>{"single"!==s.settings.mode&&s.control.contains(s.control_input)?(i=Math.max(0,Math.min(s.items.length,i)))==s.caretPos||s.isPending||s.controlChildren().forEach((e,t)=>{t<i?s.control_input.insertAdjacentElement("beforebegin",e):s.control.appendChild(e)}):i=s.items.length,s.caretPos=i}),s.hook("instead","moveCaret",e=>{var t,i;s.isFocused&&((t=s.getLastActive(e))?(i=f(t),s.setCaret(0<e?i+1:i),s.setActiveItem(),A(t,"last-active")):s.setCaret(s.caretPos+e))})}),e.define("dropdown_input",function(){let i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,w(i.control_input,"dropdown-input");var e=u('<div class="dropdown-input-wrap">'),e=(e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild),u('<input class="items-placeholder" tabindex="-1" />'));e.placeholder=i.settings.placeholder||"",i.control.append(e)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",e=>{switch(e.keyCode){case 27:return i.isOpen&&(L(e,!0),i.close()),void i.clearActiveItems();case 9:i.focus_node.tabIndex=-1}return i.onKeyDown.call(i,e)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});let t=i.onBlur;i.hook("instead","onBlur",e=>{if(!e||e.relatedTarget!=i.control_input)return t.call(i)}),E(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}),e.define("input_autogrow",function(){var n=this;n.on("initialize",()=>{var e,t=document.createElement("span"),i=n.control_input;t.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(t);for(e of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])t.style[e]=i.style[e];var s=()=>{t.textContent=i.value,i.style.width=t.clientWidth+"px"};s(),n.on("update item_add item_remove",s),E(i,"input",s),E(i,"keyup",s),E(i,"blur",s),E(i,"update",s)})}),e.define("no_backspace_delete",function(){var t=this,i=t.deleteSelection;this.hook("instead","deleteSelection",e=>!!t.activeItems.length&&i.call(t,e))}),e.define("no_active_items",function(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}),e.define("optgroup_columns",function(){var s=this,n=s.onKeyDown;s.hook("instead","onKeyDown",e=>{var t,i;if(!s.isOpen||37!==e.keyCode&&39!==e.keyCode)return n.call(s,e);s.ignoreHover=!0,i=_(s.activeOption,"[data-group]"),t=f(s.activeOption,"[data-selectable]"),(i=i&&(37===e.keyCode?i.previousSibling:i.nextSibling))&&(i=(e=i.querySelectorAll("[data-selectable]"))[Math.min(e.length-1,t)])&&s.setActiveOption(i)})}),e.define("remove_button",function(e){var n,e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},e),o=this;e.append&&(n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+S(e.title)+'">'+e.label+"</a>",o.hook("after","setupTemplates",()=>{var s=o.settings.render.item;o.settings.render.item=(e,t)=>{var i=u(s.call(o,e,t)),e=u(n);return i.appendChild(e),E(e,"mousedown",e=>{L(e,!0)}),E(e,"click",e=>{o.isLocked||(L(e,!0),o.isLocked)||o.shouldDelete([i],e)&&(o.removeItem(i),o.refreshOptions(!1),o.inputState())}),i}}))}),e.define("restore_on_backspace",function(e){let t=this,i=Object.assign({text:e=>e[t.settings.labelField]},e);t.on("item_remove",function(e){t.isFocused&&""===t.control_input.value.trim()&&(e=t.options[e])&&t.setTextboxValue(i.text.call(t,e))})}),e.define("virtual_scroll",function(){let s=this,t=s.canLoad,e=s.clearActiveOption,n=s.loadCallback;var i,o,r={},l=!1,a=[];if(s.settings.shouldLoadMore||(s.settings.shouldLoadMore=()=>{if(.9<i.clientHeight/(i.scrollHeight-i.scrollTop))return!0;if(s.activeOption){var e=s.selectable();if(Array.from(e).indexOf(s.activeOption)>=e.length-2)return!0}return!1}),!s.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";s.settings.sortField=[{field:"$order"},{field:"$score"}];let d=e=>!("number"==typeof s.settings.maxOptions&&i.children.length>=s.settings.maxOptions||!(e in r&&r[e])),c=(e,t)=>0<=s.items.indexOf(t)||0<=a.indexOf(t);s.setNextUrl=(e,t)=>{r[e]=t},s.getUrl=e=>{var t;return e in r?(t=r[e],r[e]=!1,t):(s.clearPagination(),s.settings.firstUrl.call(s,e))},s.clearPagination=()=>{r={}},s.hook("instead","clearActiveOption",()=>{if(!l)return e.call(s)}),s.hook("instead","canLoad",e=>e in r?d(e):t.call(s,e)),s.hook("instead","loadCallback",(e,t)=>{var i;l?o&&void 0!==(i=e[0])&&(o.dataset.value=i[s.settings.valueField]):s.clearOptions(c),n.call(s,e,t),l=!1}),s.hook("after","refreshOptions",()=>{var e,t=s.lastValue;d(t)?(e=s.render("loading_more",{query:t}))&&(e.setAttribute("data-selectable",""),o=e):t in r&&!i.querySelector(".no-results")&&(e=s.render("no_more_results",{query:t})),e&&(w(e,s.settings.optionClass),i.append(e))}),s.on("initialize",()=>{a=Object.keys(s.options),i=s.dropdown_content,s.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},s.settings.render),i.addEventListener("scroll",()=>{!s.settings.shouldLoadMore.call(s)||d(s.lastValue)&&!l&&(l=!0,s.load.call(s,s.lastValue))})})}),e});var tomSelect=function(e,t){return new TomSelect(e,t)};