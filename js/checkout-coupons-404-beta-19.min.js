!function(e,o){"function"==typeof define&&define.amd?define([],o()):"object"==typeof exports?module.exports=o():e.CheckoutCoupons=o()}("undefined"!=typeof global?global:this.window||this.global,function(e){function n(e,o){o=(o=o?o.closest(p.sectionWrapperSelector):null)?o.querySelector(p.messagesWrapperSelector):document.querySelector(p.generalNoticesSelector),(o="yes"===p.useGeneralNoticesSection?document.querySelector(p.generalNoticesSelector):o)&&(o.innerHTML=e)}function s(){var e=document.querySelector(p.generalNoticesSelector);e&&(e.innerHTML="")}function c(e){var o="";if(!(o=e&&e.hasAttribute(p.couponCodeAttribute)?e.getAttribute(p.couponCodeAttribute):o)||""==o){var t=e.closest(p.couponSectionSelector).querySelector(p.couponFieldSelector);if(!t)return;if(""===t.value.trim())return t.value="",t.focus();o=t.value}o&&""!=o&&d.addCouponCode(o,e)}function o(){if("yes"!==p.useGeneralNoticesSection){var e=document.querySelectorAll(p.errorMessagesWrapperSelector);g=[];for(var o=0;o<e.length;o++){var t=e[o],r=Array.prototype.indexOf.call(t.parentElement.children,t);g.push([r,t])}}}function t(){if("yes"!==p.useGeneralNoticesSection){var e=document.querySelector(p.messagesWrapperSelector);if(e)for(var o=0;o<g.length;o++){var t=g[o],r=t[0],t=t[1],r=e.children[r],c=t.getAttribute(p.couponCodeAttribute),c=p.errorMessagesWrapperSelector+"["+p.couponCodeAttribute+'="'+c+'"]';document.querySelector(c)||e.insertBefore(t,r)}}}function r(e){var o,t,r;e.target.closest(p.addCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(p.addCouponButtonSelector),c(o)):e.target.closest(p.removeCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(p.removeCouponButtonSelector),(t=o)&&(r="",r=t.hasAttribute(p.couponCodeAttribute)?t.getAttribute(p.couponCodeAttribute):r)&&""!=r&&d.removeCouponCode(r,t)):e.target.closest(p.errorMessageDismissButtonSelector)&&(e.preventDefault(),r=(r=e.target.closest(p.errorMessageDismissButtonSelector)).getAttribute(p.couponCodeAttribute),S(r))}function u(e){FCUtils.keyboardKeys.ENTER===e.key&&e.target.closest(p.couponFieldSelector)&&(e.preventDefault(),c(e.target.closest(p.couponFieldSelector)))}var l=jQuery,i=null!=l,a=!1,d={},p={bodyClass:"has-fc-checkout-coupons",uiProcessingClass:"processing",sectionWrapperSelector:".fc-step__substep, .fc-sidebar .coupon-code-form, .fc-cart-coupon-code-form",generalNoticesSelector:".woocommerce-notices-wrapper",messagesWrapperSelector:".fc-coupon-code-messages",errorMessagesWrapperSelector:".fc-coupon-code-messages .woocommerce-error",errorMessageDismissButtonSelector:".fc-coupon-code-message-dismiss",useGeneralNoticesSection:"no",suppressSuccessMessages:"yes",couponAddedSectionSelector:".fc-step__substep-text-content--coupon-codes",couponSectionSelector:".fc-coupon-code-section",couponFieldSelector:'input[name="coupon_code"]',addCouponButtonSelector:".fc-coupon-code__apply",removeCouponButtonSelector:".woocommerce-remove-coupon",couponCodeAttribute:"data-coupon",referenceIdAttribute:"data-reference-id",expansibleCouponSectionKeyAttribute:"data-section-key",expansibleCouponContentSelector:".fc-expansible-form-section__content",expansibleCouponToggleSelector:".fc-expansible-form-section__toggle--###SECTION_KEY###",expansibleCouponToggleButtonSelector:".expansible-section__toggle-plus--###SECTION_KEY###",section_key_placeholder:"###SECTION_KEY###"},g=[],S=function(e){e&&(e=p.errorMessagesWrapperSelector+" > li["+p.couponCodeAttribute+'="'+e+'"]',(e=document.querySelector(e))&&e.parentElement.removeChild(e),e=document.querySelector(p.errorMessagesWrapperSelector))&&0===e.children.length&&e.parentElement.removeChild(e)};return d.blockUI=function(e){i&&e&&l(e).addClass(p.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},d.unblockUI=function(e){i&&l(e).removeClass(p.uiProcessingClass).unblock()},d.addCouponCode=function(e,o){var t,c;e&&""!=e&&("yes"===p.useGeneralNoticesSection&&s(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(p.referenceIdAttribute,t),o=document.querySelector(p.couponAddedSectionSelector),d.blockUI(o),c={security:p.addCouponCodeNonce,coupon_code:e,reference_id:t},l.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_add_coupon_code"),data:c,dataType:"json",success:function(e){var o,t,r;e.reference_id&&(o=document.querySelector("["+p.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==p.suppressSuccessMessages&&n(e.message,o),(t=document.querySelector(p.couponFieldSelector))&&(t.value=""),window.CollapsibleBlock&&(t=o.closest(p.expansibleCouponContentSelector))&&(CollapsibleBlock.collapse(t),t=t.getAttribute(p.expansibleCouponSectionKeyAttribute),r=document.querySelector(p.expansibleCouponToggleSelector.replace(p.section_key_placeholder,t)),t=document.querySelector(p.expansibleCouponToggleButtonSelector.replace(p.section_key_placeholder,t)),r&&CollapsibleBlock.expand(r),t)&&t.focus(),l(document.body).trigger("wc_fragment_refresh"),l(document.body).trigger("applied_coupon_in_checkout",[c.coupon_code]),l(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(n(e.message,o),l(document.body).trigger("checkout_error",[e.message]),r=document.querySelector(p.couponAddedSectionSelector))&&d.unblockUI(r)}}))},d.removeCouponCode=function(e,o){var t,r;e&&""!=e&&("yes"===p.useGeneralNoticesSection&&s(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(p.referenceIdAttribute,t),o=document.querySelector(p.couponAddedSectionSelector),d.blockUI(o),r={security:p.removeCouponCodeNonce,coupon_code:e,reference_id:t},l.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_remove_coupon_code"),data:r,dataType:"json",success:function(e){var o;e.reference_id&&(o=document.querySelector("["+p.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==p.suppressSuccessMessages&&n(e.message,o),l(document.body).trigger("wc_fragment_refresh"),l(document.body).trigger("removed_coupon_in_checkout",[r.coupon_code]),l(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(n(e.message,o),e=document.querySelector(p.couponAddedSectionSelector))&&d.unblockUI(e)}}))},d.init=function(e){a||(p=FCUtils.extendObject(p,e),window.addEventListener("click",r,!0),document.addEventListener("keydown",u,!0),i&&(l(document.body).on("wc_fragment_refresh update_checkout",o),l(document.body).on("wc_fragments_refreshed updated_checkout",t)),document.body.classList.add(p.bodyClass),a=!0)},d});