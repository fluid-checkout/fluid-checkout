{"version":3,"file":"../../klarna-payments-for-woocommerce/klarna-payments-327-beta-4.min.js","sources":["klarna-payments-for-woocommerce/klarna-payments-327-beta-4.js"],"sourcesContent":["/* global console, Klarna */\r\njQuery(function ($) {\r\n\t\"use strict\";\r\n\r\n\tvar klarna_payments = {\r\n\t\tauthorization_response: {},\r\n\t\tiframe_loaded: false,\r\n\t\tshow_form: false,\r\n\t\tklarna_container_selector: \"#klarna_container_2\",\r\n\t\tcheckout_values: {},\r\n\t\taddresses: {},\r\n\r\n\t\tcheck_changes: function () {\r\n\t\t\t$(\r\n\t\t\t\t\".woocommerce-billing-fields input, .woocommerce-billing-fields select, .woocommerce-shipping-fields input, .woocommerce-shipping-fields select\"\r\n\t\t\t).each(function () {\r\n\t\t\t\tvar fieldName = $(this).attr(\"name\");\r\n\t\t\t\tvar fieldValue = $(this).val();\r\n\t\t\t\tif (klarna_payments.checkout_values[fieldName] !== fieldValue) {\r\n\t\t\t\t\tklarna_payments.checkout_values[fieldName] = fieldValue;\r\n\t\t\t\t\t$(this).trigger(\"change\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdebounce_changes: function (func, wait, immediate) {\r\n\t\t\tvar timeout;\r\n\t\t\treturn function () {\r\n\t\t\t\tvar context = this,\r\n\t\t\t\t\targs = arguments;\r\n\t\t\t\tvar later = function () {\r\n\t\t\t\t\ttimeout = null;\r\n\t\t\t\t\tif (!immediate) func.apply(context, args);\r\n\t\t\t\t};\r\n\t\t\t\tvar callNow = immediate && !timeout;\r\n\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\ttimeout = setTimeout(later, wait);\r\n\t\t\t\tif (callNow) func.apply(context, args);\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tstart: function () {\r\n\t\t\t// Store all billing and shipping values.\r\n\t\t\t$(document).ready(function () {\r\n\t\t\t\t$(\"#customer_details input, #customer_details select\").each(\r\n\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\tvar fieldName = $(this).attr(\"name\");\r\n\t\t\t\t\t\tvar fieldValue = $(this).val();\r\n\t\t\t\t\t\tklarna_payments.checkout_values[fieldName] = fieldValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * When WooCommerce updates checkout\r\n\t\t\t * Happens on initial page load, country, state and postal code changes\r\n\t\t\t */\r\n\t\t\t$(\"body\").on(\"updated_checkout\", function () {\r\n\t\t\t\t// Unblock the payments element if blocked\r\n\t\t\t\tvar blocked_el = $(\".woocommerce-checkout-payment\");\r\n\t\t\t\tvar blocked_el_data = blocked_el.data();\r\n\t\t\t\tif (\r\n\t\t\t\t\tblocked_el.length &&\r\n\t\t\t\t\t1 === blocked_el_data[\"blockUI.isBlocked\"]\r\n\t\t\t\t) {\r\n\t\t\t\t\tblocked_el.unblock();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we need to hide the shipping fields\r\n\t\t\t\tklarna_payments.maybeHideShippingAddress();\r\n\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Clear auth token if there's checkout error.\r\n\t\t\t */\r\n\t\t\t$(document.body).on(\"checkout_error\", function () {\r\n\t\t\t\t$('input[name=\"klarna_payments_authorization_token\"]').remove();\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Phone field changes. Has to be 5 characters or longer for KP to work.\r\n\t\t\t */\r\n\t\t\t$(\"form.checkout\").on(\r\n\t\t\t\t\"keyup\",\r\n\t\t\t\t\"#billing_phone\",\r\n\t\t\t\tklarna_payments.debounce_changes(function () {\r\n\t\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t\t//$('#place_order').attr('disabled', true);\r\n\t\t\t\t\t\tif ($(this).val().length > 4) {\r\n\t\t\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\t\t\tklarna_payments\r\n\t\t\t\t\t\t\t\t.load()\r\n\t\t\t\t\t\t\t\t.then(klarna_payments.loadHandler);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 750)\r\n\t\t\t);\r\n\r\n\t\t\t/**\r\n\t\t\t * Email field changes, check if WooCommerce says field is valid.\r\n\t\t\t */\r\n\t\t\t$(\"form.checkout\").on(\r\n\t\t\t\t\"keyup\",\r\n\t\t\t\t\"#billing_email\",\r\n\t\t\t\tklarna_payments.debounce_changes(function () {\r\n\t\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t\t//$('#place_order').attr('disabled', true);\r\n\t\t\t\t\t\tif (!$(this).parent().hasClass(\"woocommerce-invalid\")) {\r\n\t\t\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\t\t\tklarna_payments\r\n\t\t\t\t\t\t\t\t.load()\r\n\t\t\t\t\t\t\t\t.then(klarna_payments.loadHandler);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 750)\r\n\t\t\t);\r\n\r\n\t\t\t/**\r\n\t\t\t * Billing company field changes.\r\n\t\t\t */\r\n\t\t\t$(\"form.checkout\").on(\r\n\t\t\t\t\"keyup\",\r\n\t\t\t\t\"#billing_company\",\r\n\t\t\t\tklarna_payments.debounce_changes(function () {\r\n\t\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\t\tklarna_payments\r\n\t\t\t\t\t\t\t.load()\r\n\t\t\t\t\t\t\t.then(klarna_payments.loadHandler);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 750)\r\n\t\t\t);\r\n\r\n\t\t\t/**\r\n\t\t\t * When changing payment method.\r\n\t\t\t */\r\n\t\t\t$(\"body\").on(\"change\", 'input[name=\"payment_method\"]', function () {\r\n\t\t\t\t// If Klarna Payments is selected and iframe is not loaded yet, disable the form. Also collapse any unselected Klarna Payments gateways.\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t\tklarna_payments.collapseGateways();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Enable the form if any other payment method is selected.\r\n\t\t\t\tif (!klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t$(\"#place_order\").attr(\"disabled\", false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we need to hide the shipping fields\r\n\t\t\t\tklarna_payments.maybeHideShippingAddress();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tload: function () {\r\n\t\t\tvar $defer = $.Deferred();\r\n\r\n\t\t\t// Dont run load during checkout completion.\r\n\t\t\tif ($(\"form.checkout\").hasClass(\"processing\")) {\r\n\t\t\t\treturn $defer.reject();\r\n\t\t\t}\r\n\r\n\t\t\tvar klarna_payments_container_selector_id =\r\n\t\t\t\t\"#\" + klarna_payments.getSelectorContainerID();\r\n\t\t\tconsole.log(klarna_payments_container_selector_id);\r\n\r\n\t\t\tif (klarna_payments_container_selector_id) {\r\n\t\t\t\tvar klarnaLoadedInterval = setInterval(function () {\r\n\t\t\t\t\tvar Klarna = false;\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tKlarna = window.Klarna;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.debug(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (Klarna && Klarna.Payments) {\r\n\t\t\t\t\t\tclearInterval(klarnaLoadedInterval);\r\n\t\t\t\t\t\tclearTimeout(klarnaLoadedTimeout);\r\n\r\n\t\t\t\t\t\tvar options = {\r\n\t\t\t\t\t\t\tcontainer: klarna_payments_container_selector_id,\r\n\t\t\t\t\t\t\tpayment_method_category:\r\n\t\t\t\t\t\t\t\tklarna_payments.getSelectedPaymentCategory() ===\r\n\t\t\t\t\t\t\t\t\"klarna_payments\"\r\n\t\t\t\t\t\t\t\t\t? \"\"\r\n\t\t\t\t\t\t\t\t\t: klarna_payments.getSelectedPaymentCategory(),\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (\"US\" === $(\"#billing_country\").val()) {\r\n\t\t\t\t\t\t\tvar address =\r\n\t\t\t\t\t\t\t\tklarna_payments.get_address_from_checkout_form();\r\n\r\n\t\t\t\t\t\t\tKlarna.Payments.load(\r\n\t\t\t\t\t\t\t\toptions,\r\n\t\t\t\t\t\t\t\taddress,\r\n\t\t\t\t\t\t\t\tfunction (response) {\r\n\t\t\t\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tKlarna.Payments.load(options, function (response) {\r\n\t\t\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\r\n\t\t\t\tvar klarnaLoadedTimeout = setTimeout(function () {\r\n\t\t\t\t\tclearInterval(klarnaLoadedInterval);\r\n\t\t\t\t\t$defer.reject();\r\n\t\t\t\t}, 3000);\r\n\r\n\t\t\t\treturn $defer.promise();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tloadHandler: function (response) {\r\n\t\t\tklarna_payments.iframe_loaded = true;\r\n\r\n\t\t\tif (response.show_form) {\r\n\t\t\t\tklarna_payments.show_form = true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisKlarnaPaymentsSelected: function () {\r\n\t\t\tif ($('input[name=\"payment_method\"]:checked').length) {\r\n\t\t\t\tvar selected_value = $(\r\n\t\t\t\t\t'input[name=\"payment_method\"]:checked'\r\n\t\t\t\t).val();\r\n\t\t\t\treturn selected_value.indexOf(\"klarna_payments\") !== -1;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tsetRadioButtonValues: function () {\r\n\t\t\t$('input[name=\"payment_method\"]').each(function () {\r\n\t\t\t\tif ($(this).val().indexOf(\"klarna_payments\") !== -1) {\r\n\t\t\t\t\t$(this).val(\"klarna_payments\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetSelectorContainerID: function () {\r\n\t\t\tvar containerID = $('input[name=\"payment_method\"]:checked')\r\n\t\t\t\t.attr(\"id\")\r\n\t\t\t\t.replace(\"payment_method_\", \"\");\r\n\r\n\t\t\treturn containerID + \"_container\";\r\n\t\t},\r\n\r\n\t\tgetSelectedPaymentCategory: function () {\r\n\t\t\tvar selected_category = $('input[name=\"payment_method\"]:checked')\r\n\t\t\t\t.attr(\"id\")\r\n\t\t\t\t.replace(\"payment_method_\", \"\");\r\n\t\t\tconsole.log(selected_category);\r\n\t\t\treturn selected_category.replace(\"klarna_payments_\", \"\");\r\n\t\t},\r\n\r\n\t\tauthorize: function () {\r\n\t\t\tvar $defer = $.Deferred();\r\n\t\t\tvar address = klarna_payments.get_address();\r\n\r\n\t\t\tklarna_payments.authorization_response = {};\r\n\r\n\t\t\ttry {\r\n\t\t\t\tKlarna.Payments.authorize(\r\n\t\t\t\t\taddress,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpayment_method_category:\r\n\t\t\t\t\t\t\tklarna_payments.getSelectedPaymentCategory() ===\r\n\t\t\t\t\t\t\t\"klarna_payments\"\r\n\t\t\t\t\t\t\t\t? \"\"\r\n\t\t\t\t\t\t\t\t: klarna_payments.getSelectedPaymentCategory(),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfunction (response) {\r\n\t\t\t\t\t\tklarna_payments.authorization_response = response;\r\n\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t}\r\n\r\n\t\t\treturn $defer.promise();\r\n\t\t},\r\n\r\n\t\tget_address: function () {\r\n\t\t\tvar address = {\r\n\t\t\t\tbilling_address: {\r\n\t\t\t\t\tgiven_name: klarna_payments.addresses.billing.given_name,\r\n\t\t\t\t\tfamily_name: klarna_payments.addresses.billing.family_name,\r\n\t\t\t\t\temail: klarna_payments.addresses.billing.email,\r\n\t\t\t\t\tphone: klarna_payments.addresses.billing.phone,\r\n\t\t\t\t\tcountry: klarna_payments.addresses.billing.country,\r\n\t\t\t\t\tregion: klarna_payments.addresses.billing.region,\r\n\t\t\t\t\tpostal_code: klarna_payments.addresses.billing.postal_code,\r\n\t\t\t\t\tcity: klarna_payments.addresses.billing.city,\r\n\t\t\t\t\tstreet_address:\r\n\t\t\t\t\t\tklarna_payments.addresses.billing.street_address,\r\n\t\t\t\t\tstreet_address2:\r\n\t\t\t\t\t\tklarna_payments.addresses.billing.street_address2,\r\n\t\t\t\t\torganization_name:\r\n\t\t\t\t\t\t\"b2b\" === klarna_payments_params.customer_type\r\n\t\t\t\t\t\t\t? klarna_payments.addresses.billing\r\n\t\t\t\t\t\t\t\t\t.organization_name\r\n\t\t\t\t\t\t\t: \"\",\r\n\t\t\t\t},\r\n\t\t\t\tshipping_address: {},\r\n\t\t\t};\r\n\r\n\t\t\taddress.shipping_address = $.extend({}, address.billing_address);\r\n\r\n\t\t\tif ($(\"#ship-to-different-address\").find(\"input\").is(\":checked\")) {\r\n\t\t\t\taddress.shipping_address.given_name =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.given_name;\r\n\t\t\t\taddress.shipping_address.family_name =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.family_name;\r\n\t\t\t\taddress.shipping_address.country =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.country;\r\n\t\t\t\taddress.shipping_address.region =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.region;\r\n\t\t\t\taddress.shipping_address.postal_code =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.postal_code;\r\n\t\t\t\taddress.shipping_address.city =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.city;\r\n\t\t\t\taddress.shipping_address.street_address =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.street_address;\r\n\t\t\t\taddress.shipping_address.street_address2 =\r\n\t\t\t\t\tklarna_payments.addresses.shipping.street_address2;\r\n\t\t\t}\r\n\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tget_address_from_checkout_form: function () {\r\n\t\t\tvar address = {\r\n\t\t\t\tbilling_address: {\r\n\t\t\t\t\tgiven_name:\r\n\t\t\t\t\t\tklarna_payments.checkout_values.billing_first_name,\r\n\t\t\t\t\tfamily_name:\r\n\t\t\t\t\t\tklarna_payments.checkout_values.billing_last_name,\r\n\t\t\t\t\temail: klarna_payments.checkout_values.billing_email,\r\n\t\t\t\t\tphone: klarna_payments.checkout_values.billing_phone,\r\n\t\t\t\t\tcountry: klarna_payments.checkout_values.billing_country,\r\n\t\t\t\t\tregion: klarna_payments.checkout_values.billing_state,\r\n\t\t\t\t\tpostal_code:\r\n\t\t\t\t\t\tklarna_payments.checkout_values.billing_postcode,\r\n\t\t\t\t\tcity: klarna_payments.checkout_values.billing_city,\r\n\t\t\t\t\tstreet_address:\r\n\t\t\t\t\t\tklarna_payments.checkout_values.billing_address_1,\r\n\t\t\t\t\tstreet_address2:\r\n\t\t\t\t\t\tklarna_payments.checkout_values.billing_address_2,\r\n\t\t\t\t\torganization_name:\r\n\t\t\t\t\t\t\"b2b\" === klarna_payments_params.customer_type\r\n\t\t\t\t\t\t\t? klarna_payments.checkout_values.billing_company\r\n\t\t\t\t\t\t\t: \"\",\r\n\t\t\t\t},\r\n\t\t\t\tshipping_address: {},\r\n\t\t\t};\r\n\r\n\t\t\taddress.shipping_address = $.extend({}, address.billing_address);\r\n\r\n\t\t\tif ($(\"#ship-to-different-address\").find(\"input\").is(\":checked\")) {\r\n\t\t\t\taddress.shipping_address.given_name =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_first_name;\r\n\t\t\t\taddress.shipping_address.family_name =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_last_name;\r\n\t\t\t\taddress.shipping_address.country =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_country;\r\n\t\t\t\taddress.shipping_address.region =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_state;\r\n\t\t\t\taddress.shipping_address.postal_code =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_postcode;\r\n\t\t\t\taddress.shipping_address.city =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_city;\r\n\t\t\t\taddress.shipping_address.street_address =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_address_1;\r\n\t\t\t\taddress.shipping_address.street_address2 =\r\n\t\t\t\t\tklarna_payments.checkout_values.shipping_address_2;\r\n\t\t\t}\r\n\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tcollapseGateways: function () {\r\n\t\t\t$('input[name=\"payment_method\"]').each(function () {\r\n\t\t\t\tif ($(this).is(\":checked\")) {\r\n\t\t\t\t\t$(this).siblings(\"div.payment_box\").show();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(this).siblings(\"div.payment_box\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tmaybeHideShippingAddress: function () {\r\n\t\t\tif (false !== klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\tif (\"b2b\" === klarna_payments_params.customer_type) {\r\n\t\t\t\t\tjQuery(\"#customer_details .col-2\").hide();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjQuery(\"#customer_details .col-2\").show();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitKlarnaCredit: function (client_token) {\r\n\t\t\tvar client_token = klarna_payments.getClientToken();\r\n\t\t\twindow.klarnaInitData = { client_token: client_token };\r\n\t\t\tKlarna.Payments.init(klarnaInitData);\r\n\t\t},\r\n\r\n\t\tprintErrorMessage: function (message) {\r\n\t\t\t$(\"#klarna-payments-error-notice\").remove();\r\n\t\t\t$(\"form.checkout\").prepend(\r\n\t\t\t\t'<div id=\"klarna-payments-error-notice\" class=\"woocommerce-NoticeGroup\"><ul class=\"woocommerce-error\" role=\"alert\"><li>' +\r\n\t\t\t\t\tmessage +\r\n\t\t\t\t\t\"</li></ul></div>\"\r\n\t\t\t);\r\n\t\t\t$.scroll_to_notices($(\"form.checkout\"));\r\n\t\t},\r\n\r\n\t\tauthorizeKlarnaOrder: function (order_id, order_key) {\r\n\t\t\tklarna_payments.authorize().done(function (response) {\r\n\t\t\t\tif (\"authorization_token\" in response) {\r\n\t\t\t\t\t$(\"body\").trigger(\"kp_auth_success\");\r\n\t\t\t\t\t$.ajax(klarna_payments_params.place_order_url, {\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\t\tasync: true,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\torder_key: order_key,\r\n\t\t\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\t\t\tauth_token:\r\n\t\t\t\t\t\t\t\tklarna_payments.authorization_response\r\n\t\t\t\t\t\t\t\t\t.authorization_token,\r\n\t\t\t\t\t\t\tnonce: klarna_payments_params.place_order_nonce,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\t\t// Log the success.\r\n\t\t\t\t\t\t\tconsole.log(\"kp_place_order success\");\r\n\t\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\terror: function (response) {\r\n\t\t\t\t\t\t\t// Log the error.\r\n\t\t\t\t\t\t\tconsole.log(\"kp_place_order error\");\r\n\t\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcomplete: function (response) {\r\n\t\t\t\t\t\t\tif (response.responseJSON.success === true) {\r\n\t\t\t\t\t\t\t\twindow.location.href =\r\n\t\t\t\t\t\t\t\t\tresponse.responseJSON.data;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"form.checkout\")\r\n\t\t\t\t\t\t\t\t\t.removeClass(\"processing\")\r\n\t\t\t\t\t\t\t\t\t.unblock();\r\n\t\t\t\t\t\t\t\t$(\"form.checkout\")\r\n\t\t\t\t\t\t\t\t\t.find(\".input-text, select, input:checkbox\")\r\n\t\t\t\t\t\t\t\t\t.trigger(\"validate\")\r\n\t\t\t\t\t\t\t\t\t.blur();\r\n\t\t\t\t\t\t\t\t$(\"form.checkout\").trigger(\"update_checkout\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"body\").trigger(\"kp_auth_failed\");\r\n\r\n\t\t\t\t\t// Re-enable the form.\r\n\t\t\t\t\t$(\"body\").trigger(\"updated_checkout\");\r\n\t\t\t\t\t$(\"form.checkout\").removeClass(\"processing\");\r\n\t\t\t\t\t$(\"form.checkout\").unblock();\r\n\t\t\t\t\t$(\".woocommerce-checkout-review-order-table\").unblock();\r\n\r\n\t\t\t\t\tconsole.log(\"No authorization_token in response\");\r\n\t\t\t\t\t$(\"form.woocommerce-checkout\")\r\n\t\t\t\t\t\t.removeClass(\"processing\")\r\n\t\t\t\t\t\t.unblock();\r\n\t\t\t\t\t$.ajax(klarna_payments_params.auth_failed_url, {\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\t\tasync: true,\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tshow_form: response.show_form,\r\n\t\t\t\t\t\t\torder_key: order_key,\r\n\t\t\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\t\t\tnonce: klarna_payments_params.auth_failed_nonce,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tklarnaPayForOrder: function (event) {\r\n\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tklarna_payments.addresses = klarna_payments_params.addresses;\r\n\t\t\t\tklarna_payments.authorizeKlarnaOrder(\r\n\t\t\t\t\tklarna_payments_params.order_id,\r\n\t\t\t\t\tklarna_payments_params.order_key\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetClientToken: function () {\r\n\t\t\tif ($(\"#kp_client_token\").length > 0) {\r\n\t\t\t\treturn $(\"#kp_client_token\").val();\r\n\t\t\t} else {\r\n\t\t\t\treturn klarna_payments_params.client_token;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\torderSubmit: function (event) {\r\n\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tif ($(\"form.checkout\").is(\".processing\")) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"form.checkout\").addClass(\"processing\");\r\n\t\t\t\t$(\".woocommerce-checkout-review-order-table\").block({\r\n\t\t\t\t\tmessage: null,\r\n\t\t\t\t\toverlayCSS: {\r\n\t\t\t\t\t\tbackground: \"#fff\",\r\n\t\t\t\t\t\topacity: 0.6,\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\turl: klarna_payments_params.submit_order,\r\n\t\t\t\t\tdata: $(\"form.checkout\").serialize(),\r\n\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif (\"success\" === data.result) {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile(\r\n\t\t\t\t\t\t\t\t\t\"Successfully placed order. Starting authorization with Klarna\"\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tklarna_payments.addresses = data.addresses;\r\n\t\t\t\t\t\t\t\tklarna_payments.authorizeKlarnaOrder(\r\n\t\t\t\t\t\t\t\t\tdata.order_id,\r\n\t\t\t\t\t\t\t\t\tdata.order_key\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow \"Result failed\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tif (data.messages) {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile(\r\n\t\t\t\t\t\t\t\t\t\"Checkout error | \" + data.messages\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tklarna_payments.failOrder(\r\n\t\t\t\t\t\t\t\t\t\"submission\",\r\n\t\t\t\t\t\t\t\t\tdata.messages\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile(\r\n\t\t\t\t\t\t\t\t\t\"Checkout error | \" + err\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tklarna_payments.failOrder(\r\n\t\t\t\t\t\t\t\t\t\"submission\",\r\n\t\t\t\t\t\t\t\t\t'<div class=\"woocommerce-error\">' +\r\n\t\t\t\t\t\t\t\t\t\t\"Checkout error\" +\r\n\t\t\t\t\t\t\t\t\t\t\"</div>\"\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (data) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tklarna_payments.logToFile(\r\n\t\t\t\t\t\t\t\t\"AJAX error | \" + JSON.stringify(data)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tklarna_payments.logToFile(\r\n\t\t\t\t\t\t\t\t\"AJAX error | Failed to parse error message.\"\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tklarna_payments.failOrder(\r\n\t\t\t\t\t\t\t\"ajax-error\",\r\n\t\t\t\t\t\t\t'<div class=\"woocommerce-error\">Internal Server Error</div>'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fails the order with Klarna on a checkout error and timeout.\r\n\t\t * @param {string} event\r\n\t\t */\r\n\t\tfailOrder: function (event, error_message) {\r\n\t\t\t// Re-enable the form.\r\n\t\t\t$(\"body\").trigger(\"updated_checkout\");\r\n\t\t\t$(\"form.checkout\").removeClass(\"processing\");\r\n\t\t\t$(\"form.checkout\").unblock();\r\n\t\t\t$(\".woocommerce-checkout-review-order-table\").unblock();\r\n\r\n\t\t\t// Print error messages, and trigger checkout_error, and scroll to notices.\r\n\t\t\t$(\r\n\t\t\t\t\".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message\"\r\n\t\t\t).remove();\r\n\t\t\t$(\"form.checkout\").prepend(\r\n\t\t\t\t'<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' +\r\n\t\t\t\t\terror_message +\r\n\t\t\t\t\t\"</div>\"\r\n\t\t\t); // eslint-disable-line max-len\r\n\t\t\t$(\"form.checkout\").removeClass(\"processing\").unblock();\r\n\t\t\t$(\"form.checkout\")\r\n\t\t\t\t.find(\".input-text, select, input:checkbox\")\r\n\t\t\t\t.trigger(\"validate\")\r\n\t\t\t\t.blur();\r\n\t\t\t$(document.body).trigger(\"checkout_error\", [error_message]);\r\n\t\t\t$.scroll_to_notices($(\"form.checkout\"));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Logs the message to the klarna payments log in WooCommerce.\r\n\t\t * @param {string} message\r\n\t\t */\r\n\t\tlogToFile: function (message) {\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: klarna_payments_params.log_to_file_url,\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"json\",\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tmessage: message,\r\n\t\t\t\t\tnonce: klarna_payments_params.log_to_file_nonce,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t},\r\n\t};\r\n\tklarna_payments.start();\r\n\t$(\"body\").ready(function () {\r\n\t\tklarna_payments.setRadioButtonValues();\r\n\t});\r\n\r\n\t$(\"body\").ajaxComplete(function () {\r\n\t\tklarna_payments.setRadioButtonValues();\r\n\t});\r\n\r\n\t$(\"body\").on(\r\n\t\t\"click\",\r\n\t\t// CHANGE: Use a class selector for the place order button as more than one place order button might exist on the same page\r\n\t\t\"input#place_order, button#place_order, .fc-place-order-button\",\r\n\t\tfunction (e) {\r\n\t\t\t// No strict comparison: wp_localize_script() converts booleans to strings \"1\", respectively, \"0\".\r\n\t\t\tif (true == klarna_payments_params.pay_for_order) {\r\n\t\t\t\tklarna_payments.klarnaPayForOrder(e);\r\n\t\t\t} else {\r\n\t\t\t\tklarna_payments.orderSubmit(e);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n});\r\n"],"names":["jQuery","$","klarna_payments","authorization_response","iframe_loaded","show_form","klarna_container_selector","checkout_values","addresses","check_changes","each","fieldName","this","attr","fieldValue","val","trigger","debounce_changes","func","wait","immediate","timeout","context","args","arguments","callNow","clearTimeout","setTimeout","apply","start","document","ready","isKlarnaPaymentsSelected","initKlarnaCredit","load","then","loadHandler","on","blocked_el","blocked_el_data","data","length","unblock","maybeHideShippingAddress","body","remove","parent","hasClass","collapseGateways","klarna_payments_container_selector_id","klarnaLoadedInterval","klarnaLoadedTimeout","$defer","Deferred","reject","getSelectorContainerID","console","log","setInterval","options","address","Klarna","window","e","debug","Payments","clearInterval","container","payment_method_category","getSelectedPaymentCategory","get_address_from_checkout_form","response","resolve","promise","indexOf","setRadioButtonValues","replace","selected_category","authorize","get_address","billing_address","given_name","billing","family_name","email","phone","country","region","postal_code","city","street_address","street_address2","organization_name","klarna_payments_params","customer_type","shipping_address","extend","find","is","shipping","billing_first_name","billing_last_name","billing_email","billing_phone","billing_country","billing_state","billing_postcode","billing_city","billing_address_1","billing_address_2","billing_company","shipping_first_name","shipping_last_name","shipping_country","shipping_state","shipping_postcode","shipping_city","shipping_address_1","shipping_address_2","siblings","show","hide","client_token","getClientToken","klarnaInitData","init","printErrorMessage","message","prepend","scroll_to_notices","authorizeKlarnaOrder","order_id","order_key","done","ajax","place_order_url","type","dataType","async","auth_token","authorization_token","nonce","place_order_nonce","success","error","complete","responseJSON","location","href","removeClass","blur","auth_failed_url","auth_failed_nonce","klarnaPayForOrder","event","preventDefault","orderSubmit","addClass","block","overlayCSS","background","opacity","url","submit_order","serialize","result","logToFile","err","messages","failOrder","JSON","stringify","error_message","log_to_file_url","log_to_file_nonce","ajaxComplete","pay_for_order"],"mappings":"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"}