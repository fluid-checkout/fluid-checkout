{"version":3,"file":"../../klarna-payments-for-woocommerce/klarna-payments-310-beta-2.min.js","sources":["klarna-payments-for-woocommerce/klarna-payments-310-beta-2.js"],"sourcesContent":["/* global console, Klarna */\r\njQuery( function($) {\r\n\t'use strict';\r\n\r\n\tvar klarna_payments = {\r\n\t\tauthorization_response: {},\r\n\t\tiframe_loaded: false,\r\n\t\tshow_form: false,\r\n\t\tklarna_container_selector: '#klarna_container_2',\r\n\t\tcheckout_values: {},\r\n\t\taddresses: {},\r\n\r\n\t\tcheck_changes: function() {\r\n\t\t\t$('.woocommerce-billing-fields input, .woocommerce-billing-fields select, .woocommerce-shipping-fields input, .woocommerce-shipping-fields select').each(function() {\r\n\t\t\t\tvar fieldName = $(this).attr('name');\r\n\t\t\t\tvar fieldValue = $(this).val();\r\n\t\t\t\tif ( klarna_payments.checkout_values[ fieldName ] !== fieldValue ) {\r\n\t\t\t\t\tklarna_payments.checkout_values[ fieldName ] = fieldValue;\r\n\t\t\t\t\t$(this).trigger('change');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdebounce_changes: function(func, wait, immediate) {\r\n\t\t\tvar timeout;\r\n\t\t\treturn function() {\r\n\t\t\t\tvar context = this, args = arguments;\r\n\t\t\t\tvar later = function() {\r\n\t\t\t\t\ttimeout = null;\r\n\t\t\t\t\tif (!immediate) func.apply(context, args);\r\n\t\t\t\t};\r\n\t\t\t\tvar callNow = immediate && !timeout;\r\n\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\ttimeout = setTimeout(later, wait);\r\n\t\t\t\tif (callNow) func.apply(context, args);\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tstart: function() {\r\n\t\t\t// Store all billing and shipping values.\r\n\t\t\t$(document).ready(function() {\r\n\t\t\t\t$('#customer_details input, #customer_details select').each(function() {\r\n\t\t\t\t\tvar fieldName = $(this).attr('name');\r\n\t\t\t\t\tvar fieldValue = $(this).val();\r\n\t\t\t\t\tklarna_payments.checkout_values[ fieldName ] = fieldValue;\r\n\t\t\t\t});\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * When WooCommerce updates checkout\r\n\t\t\t * Happens on initial page load, country, state and postal code changes\r\n\t\t\t */\r\n\t\t\t$('body').on('updated_checkout', function() {\r\n\t\t\t\t// Unblock the payments element if blocked\r\n\t\t\t\tvar blocked_el = $('.woocommerce-checkout-payment');\r\n\t\t\t\tvar blocked_el_data = blocked_el.data();\r\n\t\t\t\tif (blocked_el.length && 1 === blocked_el_data['blockUI.isBlocked']) {\r\n\t\t\t\t\tblocked_el.unblock();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we need to hide the shipping fields\r\n\t\t\t\tklarna_payments.maybeHideShippingAddress();\r\n\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Clear auth token if there's checkout error.\r\n\t\t\t */\r\n\t\t\t$( document.body ).on( 'checkout_error', function() {\r\n\t\t\t\t$('input[name=\"klarna_payments_authorization_token\"]').remove();\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Phone field changes. Has to be 5 characters or longer for KP to work.\r\n\t\t\t */\r\n\t\t\t$('form.checkout').on('keyup', '#billing_phone', klarna_payments.debounce_changes(function() {\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t//$('#place_order').attr('disabled', true);\r\n\t\t\t\t\tif ($(this).val().length > 4) {\r\n\t\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 750));\r\n\r\n\t\t\t/**\r\n\t\t\t * Email field changes, check if WooCommerce says field is valid.\r\n\t\t\t */\r\n\t\t\t$('form.checkout').on('keyup', '#billing_email', klarna_payments.debounce_changes(function() {\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t//$('#place_order').attr('disabled', true);\r\n\t\t\t\t\tif (!$(this).parent().hasClass('woocommerce-invalid')) {\r\n\t\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 750));\r\n\r\n\t\t\t/**\r\n\t\t\t * Billing company field changes.\r\n\t\t\t */\r\n\t\t\t$('form.checkout').on('keyup', '#billing_company', klarna_payments.debounce_changes(function() {\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t}\r\n\t\t\t}, 750));\r\n\r\n\t\t\t/**\r\n\t\t\t * When changing payment method.\r\n \t\t\t */\r\n\t\t\t$('body').on('change', 'input[name=\"payment_method\"]', function() {\r\n\t\t\t\t// If Klarna Payments is selected and iframe is not loaded yet, disable the form. Also collapse any unselected Klarna Payments gateways.\r\n\t\t\t\tif (klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\tklarna_payments.initKlarnaCredit();\r\n\t\t\t\t\tklarna_payments.load().then(klarna_payments.loadHandler);\r\n\t\t\t\t\tklarna_payments.collapseGateways();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Enable the form if any other payment method is selected.\r\n\t\t\t\tif (!klarna_payments.isKlarnaPaymentsSelected()) {\r\n\t\t\t\t\t$('#place_order').attr('disabled', false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we need to hide the shipping fields\r\n\t\t\t\tklarna_payments.maybeHideShippingAddress();\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tload: function() {\r\n\t\t\tvar $defer = $.Deferred();\r\n\r\n\t\t\t// Dont run load during checkout completion.\r\n\t\t\tif( $('form.checkout').hasClass('processing') ) {\r\n\t\t\t\treturn $defer.reject();\r\n\t\t\t}\r\n\r\n\t\t\tvar klarna_payments_container_selector_id = '#' + klarna_payments.getSelectorContainerID();\r\n\t\t\tconsole.log(klarna_payments_container_selector_id);\r\n\r\n\t\t\tif (klarna_payments_container_selector_id) {\r\n\r\n\t\t\t\tvar klarnaLoadedInterval = setInterval(function () {\r\n\t\t\t\t\tvar Klarna = false;\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tKlarna = window.Klarna;\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.debug(e);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (Klarna && Klarna.Payments) {\r\n\t\t\t\t\t\tclearInterval(klarnaLoadedInterval);\r\n\t\t\t\t\t\tclearTimeout(klarnaLoadedTimeout);\r\n\r\n\t\t\t\t\t\tvar options = {\r\n\t\t\t\t\t\t\tcontainer: klarna_payments_container_selector_id,\r\n\t\t\t\t\t\t\tpayment_method_category: klarna_payments.getSelectedPaymentCategory() === \"klarna_payments\" ? \"\" : klarna_payments.getSelectedPaymentCategory()\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif ( 'US' === $('#billing_country').val() ) {\r\n\t\t\t\t\t\t\tvar address = klarna_payments.get_address_from_checkout_form();\r\n\r\n\t\t\t\t\t\t\tKlarna.Payments.load(\r\n\t\t\t\t\t\t\t\toptions,\r\n\t\t\t\t\t\t\t\taddress,\r\n\t\t\t\t\t\t\t\tfunction (response) {\r\n\t\t\t\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tKlarna.Payments.load(\r\n\t\t\t\t\t\t\t\toptions,\r\n\t\t\t\t\t\t\t\tfunction (response) {\r\n\t\t\t\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\r\n\t\t\t\tvar klarnaLoadedTimeout = setTimeout(function () {\r\n\t\t\t\t\tclearInterval(klarnaLoadedInterval);\r\n\t\t\t\t\t$defer.reject();\r\n\t\t\t\t}, 3000);\r\n\r\n\t\t\t\treturn $defer.promise();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tloadHandler: function(response) {\r\n\t\t\tklarna_payments.iframe_loaded = true;\r\n\r\n\t\t\tif (response.show_form) {\r\n\t\t\t\tklarna_payments.show_form = true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tisKlarnaPaymentsSelected: function () {\r\n\t\t\tif ($('input[name=\"payment_method\"]:checked').length) {\r\n\t\t\t\tvar selected_value = $('input[name=\"payment_method\"]:checked').val();\r\n\t\t\t\treturn selected_value.indexOf('klarna_payments') !== -1;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tsetRadioButtonValues: function () {\r\n\t\t\t$('input[name=\"payment_method\"]').each( function( ) {\r\n\t\t\t\tif( $(this).val().indexOf( 'klarna_payments' ) !== -1 ) {\r\n\t\t\t\t\t$(this).val( 'klarna_payments' );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\r\n\t\tgetSelectorContainerID: function() {\r\n\t\t\tvar containerID = $('input[name=\"payment_method\"]:checked').attr('id').replace('payment_method_', '');\r\n\r\n\t\t\treturn containerID + '_container';\r\n\t\t},\r\n\r\n\t\tgetSelectedPaymentCategory: function() {\r\n\t\t\tvar selected_category = $('input[name=\"payment_method\"]:checked').attr('id').replace('payment_method_', '');\r\n\t\t\tconsole.log( selected_category );\r\n\t\t\treturn selected_category.replace('klarna_payments_', '');\r\n\t\t},\r\n\r\n\t\tauthorize: function() {\r\n\t\t\tvar $defer = $.Deferred();\r\n\t\t\tvar address = klarna_payments.get_address();\r\n\r\n\t\t\tklarna_payments.authorization_response = {};\r\n\r\n\t\t\ttry {\r\n\t\t\t\tKlarna.Payments.authorize(\r\n\t\t\t\t\taddress,\r\n\t\t\t\t\t{payment_method_category: klarna_payments.getSelectedPaymentCategory() === \"klarna_payments\" ? \"\" : klarna_payments.getSelectedPaymentCategory()},\r\n\t\t\t\t\tfunction (response) {\r\n\t\t\t\t\t\tklarna_payments.authorization_response = response;\r\n\t\t\t\t\t\t$defer.resolve(response);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t}\r\n\r\n\t\t\treturn $defer.promise();\r\n\t\t},\r\n\r\n\t\tget_address: function() {\r\n\t\t\tvar address = {\r\n\t\t\t\tbilling_address: {\r\n\t\t\t\t\tgiven_name : klarna_payments.addresses.billing.given_name,\r\n\t\t\t\t\tfamily_name : klarna_payments.addresses.billing.family_name,\r\n\t\t\t\t\temail : klarna_payments.addresses.billing.email,\r\n\t\t\t\t\tphone : klarna_payments.addresses.billing.phone,\r\n\t\t\t\t\tcountry : klarna_payments.addresses.billing.country,\r\n\t\t\t\t\tregion : klarna_payments.addresses.billing.region,\r\n\t\t\t\t\tpostal_code : klarna_payments.addresses.billing.postal_code,\r\n\t\t\t\t\tcity : klarna_payments.addresses.billing.city,\r\n\t\t\t\t\tstreet_address : klarna_payments.addresses.billing.street_address,\r\n\t\t\t\t\tstreet_address2 : klarna_payments.addresses.billing.street_address2,\r\n\t\t\t\t\torganization_name : ( 'b2b' === klarna_payments_params.customer_type ) ? klarna_payments.addresses.billing.organization_name : '',\r\n\t\t\t\t},\r\n\t\t\t\tshipping_address: {}\r\n\t\t\t};\r\n\r\n\t\t\taddress.shipping_address = $.extend({}, address.billing_address);\r\n\r\n\t\t\tif ( $( '#ship-to-different-address' ).find( 'input' ).is( ':checked' ) ) {\r\n\t\t\t\taddress.shipping_address.given_name = klarna_payments.addresses.shipping.given_name;\r\n\t\t\t\taddress.shipping_address.family_name = klarna_payments.addresses.shipping.family_name;\r\n\t\t\t\taddress.shipping_address.country = klarna_payments.addresses.shipping.country;\r\n\t\t\t\taddress.shipping_address.region = klarna_payments.addresses.shipping.region;\r\n\t\t\t\taddress.shipping_address.postal_code = klarna_payments.addresses.shipping.postal_code;\r\n\t\t\t\taddress.shipping_address.city = klarna_payments.addresses.shipping.city;\r\n\t\t\t\taddress.shipping_address.street_address = klarna_payments.addresses.shipping.street_address;\r\n\t\t\t\taddress.shipping_address.street_address2 = klarna_payments.addresses.shipping.street_address2;\r\n\t\t\t}\r\n\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tget_address_from_checkout_form: function() {\r\n\t\t\tvar address = {\r\n\t\t\t\tbilling_address: {\r\n\t\t\t\t\tgiven_name : klarna_payments.checkout_values.billing_first_name,\r\n\t\t\t\t\tfamily_name : klarna_payments.checkout_values.billing_last_name,\r\n\t\t\t\t\temail : klarna_payments.checkout_values.billing_email,\r\n\t\t\t\t\tphone : klarna_payments.checkout_values.billing_phone,\r\n\t\t\t\t\tcountry : klarna_payments.checkout_values.billing_country,\r\n\t\t\t\t\tregion : klarna_payments.checkout_values.billing_state,\r\n\t\t\t\t\tpostal_code : klarna_payments.checkout_values.billing_postcode,\r\n\t\t\t\t\tcity : klarna_payments.checkout_values.billing_city,\r\n\t\t\t\t\tstreet_address : klarna_payments.checkout_values.billing_address_1,\r\n\t\t\t\t\tstreet_address2 : klarna_payments.checkout_values.billing_address_2,\r\n\t\t\t\t\torganization_name : ( 'b2b' === klarna_payments_params.customer_type ) ? klarna_payments.checkout_values.billing_company : '',\r\n\t\t\t\t},\r\n\t\t\t\tshipping_address: {}\r\n\t\t\t};\r\n\r\n\t\t\taddress.shipping_address = $.extend({}, address.billing_address);\r\n\r\n\t\t\tif ( $( '#ship-to-different-address' ).find( 'input' ).is( ':checked' ) ) {\r\n\t\t\t\taddress.shipping_address.given_name = klarna_payments.checkout_values.shipping_first_name;\r\n\t\t\t\taddress.shipping_address.family_name = klarna_payments.checkout_values.shipping_last_name;\r\n\t\t\t\taddress.shipping_address.country = klarna_payments.checkout_values.shipping_country;\r\n\t\t\t\taddress.shipping_address.region = klarna_payments.checkout_values.shipping_state;\r\n\t\t\t\taddress.shipping_address.postal_code = klarna_payments.checkout_values.shipping_postcode;\r\n\t\t\t\taddress.shipping_address.city = klarna_payments.checkout_values.shipping_city;\r\n\t\t\t\taddress.shipping_address.street_address = klarna_payments.checkout_values.shipping_address_1;\r\n\t\t\t\taddress.shipping_address.street_address2 = klarna_payments.checkout_values.shipping_address_2;\r\n\t\t\t}\r\n\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tcollapseGateways: function() {\r\n\t\t\t$('input[name=\"payment_method\"]').each( function() {\r\n\t\t\t\tif ( $(this).is( ':checked' ) ){\r\n\t\t\t\t\t$(this).siblings(\"div.payment_box\").show();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(this).siblings(\"div.payment_box\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tmaybeHideShippingAddress: function() {\r\n\t\t\tif( false !== klarna_payments.isKlarnaPaymentsSelected() ) {\r\n\t\t\t\tif( 'b2b' === klarna_payments_params.customer_type ) {\r\n\t\t\t\t\tjQuery('#customer_details .col-2').hide();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tjQuery('#customer_details .col-2').show();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitKlarnaCredit: function ( client_token ) {\r\n\t\t\tvar client_token = klarna_payments.getClientToken();\r\n\t\t\twindow.klarnaInitData = {client_token: client_token};\r\n\t\t\tKlarna.Payments.init(klarnaInitData);\r\n\t\t},\r\n\r\n\t\tprintErrorMessage: function( message ) {\r\n\t\t\t$('#klarna-payments-error-notice').remove();\r\n\t\t\t$('form.checkout').prepend( '<div id=\"klarna-payments-error-notice\" class=\"woocommerce-NoticeGroup\"><ul class=\"woocommerce-error\" role=\"alert\"><li>' +  message + '</li></ul></div>' );\r\n\t\t\t\tvar etop = $('form.checkout').offset().top;\r\n\t\t\t\t$('html, body').animate({\r\n\t\t\t\t\tscrollTop: etop\r\n\t\t\t\t}, 1000);\r\n\t\t},\r\n\r\n\t\tauthorizeKlarnaOrder: function( order_id ) {\r\n\t\t\tklarna_payments.authorize().done( function( response ) {\r\n\t\t\t\tif ('authorization_token' in response) {\r\n\t\t\t\t\t$('body').trigger( 'kp_auth_success' );\r\n\t\t\t\t\t$.ajax(\r\n\t\t\t\t\t\tklarna_payments_params.place_order_url,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\t\t\tasync: true,\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\torder_id: order_id,\r\n\t\t\t\t\t\t\t\tauth_token: klarna_payments.authorization_response.authorization_token,\r\n\t\t\t\t\t\t\t\tnonce: klarna_payments_params.place_order_nonce,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\t\t\t\t// Log the success.\r\n\t\t\t\t\t\t\t\tconsole.log('kp_place_order success');\r\n\t\t\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\terror: function (response) {\r\n\t\t\t\t\t\t\t\t// Log the error.\r\n\t\t\t\t\t\t\t\tconsole.log('kp_place_order error');\r\n\t\t\t\t\t\t\t\tconsole.log(response);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete: function (response) {\r\n\t\t\t\t\t\t\t\tif( response.responseJSON.success === true ) {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = response.responseJSON.data;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$('form.checkout').removeClass('processing').unblock();\r\n\t\t\t\t\t\t\t\t\t$('form.checkout').find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\r\n\t\t\t\t\t\t\t\t\t$('form.checkout').trigger('update_checkout');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$('body').trigger( 'kp_auth_failed' );\r\n\r\n\t\t\t\t\t// Re-enable the form.\r\n\t\t\t\t\t$( 'body' ).trigger( 'updated_checkout' );\r\n\t\t\t\t\t$( 'form.checkout' ).removeClass( 'processing' );\r\n\t\t\t\t\t$( 'form.checkout' ).unblock();\r\n\t\t\t\t\t$( '.woocommerce-checkout-review-order-table' ).unblock();\r\n\r\n\t\t\t\t\tconsole.log('No authorization_token in response');\r\n\t\t\t\t\t$('form.woocommerce-checkout').removeClass( 'processing' ).unblock();\r\n\t\t\t\t\t$.ajax(\r\n\t\t\t\t\t\tklarna_payments_params.auth_failed_url,\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdataType: \"json\",\r\n\t\t\t\t\t\t\tasync: true,\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tshow_form: response.show_form,\r\n\t\t\t\t\t\t\t\torder_id: json.order_id,\r\n\t\t\t\t\t\t\t\tnonce: klarna_payments_params.auth_failed_nonce\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tklarnaPayForOrder: function( event ) {\r\n\t\t\tif( klarna_payments.isKlarnaPaymentsSelected() ) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tklarna_payments.addresses = klarna_payments_params.addresses;\r\n\t\t\t\tklarna_payments.authorizeKlarnaOrder( klarna_payments_params.order_id );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetClientToken: function() {\r\n\t\t\tif( $('#kp_client_token').length > 0 ) {\r\n\t\t\t\treturn $('#kp_client_token').val();\r\n\t\t\t} else {\r\n\t\t\t\treturn klarna_payments_params.client_token;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\torderSubmit: function( event ) {\r\n\t\t\tif( klarna_payments.isKlarnaPaymentsSelected() ) {\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tif( $('form.checkout').is('.processing') ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('form.checkout').addClass('processing');\r\n\t\t\t\t$( '.woocommerce-checkout-review-order-table' ).block({\r\n\t\t\t\t\tmessage: null,\r\n\t\t\t\t\toverlayCSS: {\r\n\t\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\t\topacity: 0.6\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\turl: klarna_payments_params.submit_order,\r\n\t\t\t\t\tdata: $('form.checkout').serialize(),\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tsuccess: function( data ) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif ( 'success' === data.result ) {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile( 'Successfully placed order. Starting authorization with Klarna' );\t\r\n\t\t\t\t\t\t\t\tklarna_payments.addresses = data.addresses\r\n\t\t\t\t\t\t\t\tklarna_payments.authorizeKlarnaOrder( data.order_id );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow 'Result failed';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch ( err ) {\r\n\t\t\t\t\t\t\tif ( data.messages )  {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile( 'Checkout error | ' + data.messages );\r\n\t\t\t\t\t\t\t\tklarna_payments.failOrder( 'submission', data.messages );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tklarna_payments.logToFile( 'Checkout error | ' + err );\r\n\t\t\t\t\t\t\t\tklarna_payments.failOrder( 'submission', '<div class=\"woocommerce-error\">' + 'Checkout error' + '</div>' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function( data ) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tklarna_payments.logToFile( 'AJAX error | ' + JSON.stringify(data) );\r\n\t\t\t\t\t\t} catch( e ) {\r\n\t\t\t\t\t\t\tklarna_payments.logToFile( 'AJAX error | Failed to parse error message.' );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tklarna_payments.failOrder( 'ajax-error', '<div class=\"woocommerce-error\">Internal Server Error</div>' );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Fails the order with Klarna on a checkout error and timeout.\r\n\t\t * @param {string} event \r\n\t\t */\r\n\t\tfailOrder: function( event, error_message ) {\r\n\r\n\t\t\t// Re-enable the form.\r\n\t\t\t$( 'body' ).trigger( 'updated_checkout' );\r\n\t\t\t$( 'form.checkout' ).removeClass( 'processing' );\r\n\t\t\t$( 'form.checkout' ).unblock();\r\n\t\t\t$( '.woocommerce-checkout-review-order-table' ).unblock();\r\n\r\n\t\t\t// Print error messages, and trigger checkout_error, and scroll to notices.\r\n\t\t\t$( '.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message' ).remove();\r\n\t\t\t$( 'form.checkout' ).prepend( '<div class=\"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout\">' + error_message + '</div>' ); // eslint-disable-line max-len\r\n\t\t\t$( 'form.checkout' ).removeClass( 'processing' ).unblock();\r\n\t\t\t$( 'form.checkout' ).find( '.input-text, select, input:checkbox' ).trigger( 'validate' ).blur();\r\n\t\t\t$( document.body ).trigger( 'checkout_error' , [ error_message ] );\r\n\t\t\t$( 'html, body' ).animate( {\r\n\t\t\t\tscrollTop: ( $( 'form.checkout' ).offset().top - 100 )\r\n\t\t\t}, 1000 );\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Logs the message to the klarna payments log in WooCommerce.\r\n\t\t * @param {string} message \r\n\t\t */\r\n\t\tlogToFile: function( message ) {\r\n\t\t\t$.ajax(\r\n\t\t\t\t{\r\n\t\t\t\t\turl: klarna_payments_params.log_to_file_url,\r\n\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tmessage: message,\r\n\t\t\t\t\t\tnonce: klarna_payments_params.log_to_file_nonce\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\t\t\r\n\t};\r\n\tklarna_payments.start();\r\n\t$('body').ready( function() {\r\n\t\tklarna_payments.setRadioButtonValues();\r\n\t});\r\n\r\n\t$('body').ajaxComplete( function() {\r\n\t\tklarna_payments.setRadioButtonValues();\r\n\t});\r\n\r\n\t// CHANGE: Use a class selector for the place order button as more than one place order button might exist on the same page\r\n\t$('body').on( 'click', '.fc-place-order-button', function( e ) {\r\n\t\tif( \"true\" === klarna_payments_params.pay_for_order ) {\r\n\t\t\tklarna_payments.klarnaPayForOrder( e );\r\n\t\t} else {\r\n\t\t\tklarna_payments.orderSubmit( e );\r\n\t\t}\r\n\t});\r\n});\r\n"],"names":["jQuery","$","klarna_payments","authorization_response","iframe_loaded","show_form","klarna_container_selector","checkout_values","addresses","check_changes","each","fieldName","this","attr","fieldValue","val","trigger","debounce_changes","func","wait","immediate","timeout","context","args","arguments","callNow","clearTimeout","setTimeout","apply","start","document","ready","isKlarnaPaymentsSelected","initKlarnaCredit","load","then","loadHandler","on","blocked_el","blocked_el_data","data","length","unblock","maybeHideShippingAddress","body","remove","parent","hasClass","collapseGateways","klarna_payments_container_selector_id","klarnaLoadedInterval","klarnaLoadedTimeout","$defer","Deferred","reject","getSelectorContainerID","console","log","setInterval","options","address","Klarna","window","e","debug","Payments","clearInterval","container","payment_method_category","getSelectedPaymentCategory","get_address_from_checkout_form","response","resolve","promise","indexOf","setRadioButtonValues","replace","selected_category","authorize","get_address","billing_address","given_name","billing","family_name","email","phone","country","region","postal_code","city","street_address","street_address2","organization_name","klarna_payments_params","customer_type","shipping_address","extend","find","is","shipping","billing_first_name","billing_last_name","billing_email","billing_phone","billing_country","billing_state","billing_postcode","billing_city","billing_address_1","billing_address_2","billing_company","shipping_first_name","shipping_last_name","shipping_country","shipping_state","shipping_postcode","shipping_city","shipping_address_1","shipping_address_2","siblings","show","hide","client_token","getClientToken","klarnaInitData","init","printErrorMessage","message","prepend","etop","offset","top","animate","scrollTop","authorizeKlarnaOrder","order_id","done","ajax","place_order_url","type","dataType","async","auth_token","authorization_token","nonce","place_order_nonce","success","error","complete","responseJSON","location","href","removeClass","blur","auth_failed_url","json","auth_failed_nonce","klarnaPayForOrder","event","preventDefault","orderSubmit","addClass","block","overlayCSS","background","opacity","url","submit_order","serialize","result","logToFile","err","messages","failOrder","JSON","stringify","error_message","log_to_file_url","log_to_file_nonce","ajaxComplete","pay_for_order"],"mappings":"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"}