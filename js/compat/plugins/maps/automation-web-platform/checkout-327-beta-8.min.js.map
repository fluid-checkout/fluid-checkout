{"version":3,"file":"../../automation-web-platform/checkout-327-beta-8.min.js","sources":["automation-web-platform/checkout-327-beta-8.js"],"sourcesContent":["jQuery(document).ready(function($) {\r\n    var otpSent = false;\r\n    var resendInterval;\r\n    var resendTimer = 5;\r\n    var initialResendTimer = 5;\r\n\r\n    var $awpResendOtpBtn = $('#awp_resend_otp_btn');\r\n    var $awpResendTimer = $('#awp_resend_timer');\r\n    var $billingPhoneField = $('#billing_phone_field');\r\n    var $awpOtpPopup = $('#awp_otp_popup');\r\n    var $userPhoneNumber = $('#user_phone_number');\r\n    var $checkoutForm = $('form.woocommerce-checkout');\r\n    var otpInputs = $('.otp-input');\r\n    var $verificationMessage = $('#verification_message');\r\n    // CHANGE: Add new variable\r\n    var $billingPhoneInput = $('#billing_phone');\r\n\r\n    // Consolidated Functions\r\n    function startResendTimer() {\r\n        $awpResendOtpBtn.prop('disabled', true);\r\n        updateResendTimerText();\r\n        resendInterval = setInterval(function() {\r\n            resendTimer--;\r\n            updateResendTimerText();\r\n            if (resendTimer <= 0) {\r\n                clearInterval(resendInterval);\r\n                $awpResendOtpBtn.prop('disabled', false);\r\n                $awpResendTimer.text('');\r\n                resendTimer = initialResendTimer;\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    function updateResendTimerText() {\r\n        $awpResendTimer.text(' (' + resendTimer + 's)');\r\n    }\r\n\r\n    function showPopupMessage(message, isSuccess) {\r\n        // CHANGE: Change the message class to make it consitent with the rest of the messages\r\n        var messageClass = isSuccess ? 'woocommerce-success' : 'woocommerce-error';\r\n\r\n        // CHANGE: Replace $billingPhoneField variable with $billingPhoneInput and change selector for the message element search\r\n        var messageElement = $billingPhoneInput.next('.fc-wawp-message');\r\n        if (messageElement.length === 0) {\r\n            messageElement = $('<span class=\"fc-wawp-message\"></span>');\r\n            // CHANGE: Replace $billingPhoneField variable with $billingPhoneInput\r\n            $billingPhoneInput.after(messageElement);\r\n        }\r\n        messageElement\r\n            // CHANGE: Replace the custom classes with the default WooCommerce classes\r\n            .removeClass('woocommerce-success woocommerce-error')\r\n            .addClass(messageClass)\r\n            .text(message)\r\n            .show();\r\n\r\n        var popupMessageElement = $awpOtpPopup.find('.awp-popup-message');\r\n        if (popupMessageElement.length === 0) {\r\n            popupMessageElement = $('<div class=\"awp-popup-message\"></div>');\r\n            $awpOtpPopup.find('.awp-otp-content').prepend(popupMessageElement);\r\n        }\r\n        popupMessageElement\r\n            .removeClass('custom-message-success custom-message-error')\r\n            .addClass(messageClass)\r\n            .text(message)\r\n            .show();\r\n    }\r\n\r\n    async function sendOtp(phoneNumber, firstName) {\r\n        try {\r\n            const response = await $.post({\r\n                url: otpAjax.ajaxurl,\r\n                data: {\r\n                    action: 'send_otp',\r\n                    phone_number: phoneNumber,\r\n                    first_name: firstName,\r\n                    security: otpAjax.nonce\r\n                }\r\n            });\r\n            if (response.success) {\r\n                console.log(\"OTP sent successfully\");\r\n                showPopupMessage(awp_translations.otp_sent_success, true);\r\n                $awpOtpPopup.show();\r\n                otpSent = true;\r\n                startResendTimer();\r\n            } else {\r\n                console.log(\"Failed to send OTP\");\r\n                showPopupMessage(awp_translations.otp_sent_failure, false);\r\n            }\r\n        } catch (error) {\r\n            console.log(\"Error in sending OTP\", error);\r\n            showPopupMessage(awp_translations.otp_sent_failure, false);\r\n        }\r\n    }\r\n\r\n    async function verifyOtp() {\r\n        var otp = '';\r\n        otpInputs.each(function() {\r\n            otp += $(this).val();\r\n        });\r\n\r\n        try {\r\n            const response = await $.post({\r\n                url: otpAjax.ajaxurl,\r\n                dataType: 'json',\r\n                data: {\r\n                    action: 'verify_otp',\r\n                    otp: otp,\r\n                    security: otpAjax.nonce\r\n                }\r\n            });\r\n\r\n            if (response.success) {\r\n                console.log(\"OTP verified successfully\");\r\n                showPopupMessage(awp_translations.otp_verified_success, true);\r\n\r\n                // Hide the OTP popup after successful verification\r\n                $awpOtpPopup.hide();\r\n\r\n                // CHANGE: Trigger update checkout event\r\n                $( document.body ).trigger( 'update_checkout' );\r\n\r\n                // CHANGE: Re-add plugin's previosly removed code to update the user's phone number as meta data\r\n                const phoneNumber = $billingPhoneInput.val();\r\n                if ( otpAjax.isLoggedIn ) {\r\n                    await $.post({\r\n                        url: otpAjax.ajaxurl,\r\n                        data: {\r\n                            action: 'update_user_phone_number',\r\n                            phone_number: phoneNumber,\r\n                            security: otpAjax.nonce\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // CHANGE: Replace the checkout form submit event with the default one\r\n                return true;\r\n            } else {\r\n                console.log(\"Incorrect OTP\");\r\n                showPopupMessage(awp_translations.otp_incorrect, false);\r\n            }\r\n        } catch (error) {\r\n            console.log(\"Error in verifying OTP\", error);\r\n            showPopupMessage(awp_translations.otp_incorrect, false);\r\n        }\r\n    }\r\n\r\n    function clearOtpInputs() {\r\n        otpInputs.val('').prop('disabled', true).css({ 'background-color': '#cacaca', 'border': '#cacaca' });\r\n        otpInputs.first().prop('disabled', false).css('background-color', 'white');\r\n    }\r\n\r\n    // Event Handlers\r\n    $(document).on('click', '#fc-wawp-verify-button', async function(e) {\r\n        // CHANGE: Allow repeated OTP verification\r\n        if ($awpOtpPopup.is(':hidden')) {\r\n            e.preventDefault();\r\n            var phoneNumber = $('#billing_phone').val();\r\n            var firstName = $('#billing_first_name').val();\r\n\r\n            // CHANGE: Clear previously entered OTP code\r\n            clearOtpInputs();\r\n\r\n            $userPhoneNumber.text(phoneNumber);\r\n            sendOtp(phoneNumber, firstName);\r\n            $awpOtpPopup.show();\r\n            otpInputs.first().focus(); // Always focus on the first input initially\r\n        }\r\n    });\r\n\r\n    $(document).on('click', '.awp-otp-popup-close', function() {\r\n        $awpOtpPopup.hide();\r\n        otpSent = false;\r\n        clearOtpInputs();\r\n    });\r\n\r\n    // Auto Verify OTP After All Inputs are Filled\r\n    otpInputs.on('input', function() {\r\n        if ($(this).val().length === this.maxLength) {\r\n            $(this).next('.otp-input').prop('disabled', false).css('background-color', 'white').focus();\r\n        }\r\n\r\n        // Style the current and unfilled fields accordingly\r\n        otpInputs.each(function() {\r\n            if ($(this).val() === '') {\r\n                $(this).css({ 'background-color': '#cacaca', 'border': '#cacaca' });\r\n            } else {\r\n                $(this).css({ 'background-color': 'white', 'border': '1px solid #ccc' });\r\n            }\r\n        });\r\n\r\n        // Check if all OTP inputs are filled\r\n        var allFilled = otpInputs.filter(function() {\r\n            return $(this).val() === '';\r\n        }).length === 0;\r\n\r\n        if (allFilled) {\r\n            verifyOtp();\r\n        }\r\n    });\r\n\r\n    otpInputs.on('keydown', function(e) {\r\n        if (e.key === 'Backspace') {\r\n            if ($(this).val().length === 0) {\r\n                $(this).prev('.otp-input').focus();\r\n            }\r\n        }\r\n    });\r\n\r\n    otpInputs.on('paste', function(e) {\r\n        var clipboardData = e.originalEvent.clipboardData.getData('text');\r\n        otpInputs.each(function(index) {\r\n            $(this).val(clipboardData[index] || '');\r\n        });\r\n\r\n        // Automatically verify OTP if all fields are filled\r\n        var allFilled = otpInputs.filter(function() {\r\n            return $(this).val() === '';\r\n        }).length === 0;\r\n\r\n        if (allFilled) {\r\n            verifyOtp();\r\n        }\r\n    });\r\n\r\n    $(document).on('click', '#awp_verify_otp_btn', verifyOtp);\r\n\r\n    $(document).on('click', '#awp_resend_otp_btn', function() {\r\n        var phoneNumber = $('#billing_phone').val();\r\n        var firstName = $('#billing_first_name').val();\r\n        sendOtp(phoneNumber, firstName);\r\n        resendTimer += 5;\r\n        updateResendTimerText();\r\n    });\r\n\r\n    $(document).on('click', '#awp_edit_phone_btn', function() {\r\n        $awpOtpPopup.hide();\r\n        otpSent = false;\r\n        $('#billing_phone').focus();\r\n    });\r\n\r\n    // Initialize OTP Inputs State\r\n    clearOtpInputs(); // Ensures that the first field is ready for entry when the page is loaded\r\n});\r\n"],"names":["jQuery","document","ready","$","resendInterval","resendTimer","initialResendTimer","$awpResendOtpBtn","$awpResendTimer","$awpOtpPopup","$userPhoneNumber","otpInputs","$billingPhoneInput","updateResendTimerText","text","showPopupMessage","message","isSuccess","messageClass","messageElement","next","popupMessageElement","length","after","removeClass","addClass","show","find","prepend","async","sendOtp","phoneNumber","firstName","await","post","url","otpAjax","ajaxurl","data","action","phone_number","first_name","security","nonce","success","console","log","awp_translations","otp_sent_success","prop","setInterval","clearInterval","otp_sent_failure","error","verifyOtp","otp","each","this","val","dataType","otp_verified_success","hide","body","trigger","isLoggedIn","otp_incorrect","clearOtpInputs","css","background-color","border","first","on","e","is","preventDefault","focus","maxLength","filter","key","prev","clipboardData","originalEvent","getData","index"],"mappings":"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"}