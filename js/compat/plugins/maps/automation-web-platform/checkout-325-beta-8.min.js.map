{"version":3,"file":"../../automation-web-platform/checkout-325-beta-8.min.js","sources":["automation-web-platform/checkout-325-beta-8.js"],"sourcesContent":["jQuery(document).ready(function($) {\r\n    var otpSent = false;\r\n    var resendInterval;\r\n    var resendTimer = 5;\r\n    var initialResendTimer = 5;\r\n\r\n    var $awpResendOtpBtn = $('#awp_resend_otp_btn');\r\n    var $awpResendTimer = $('#awp_resend_timer');\r\n    var $billingPhoneField = $('#billing_phone_field');\r\n    var $awpOtpPopup = $('#awp_otp_popup');\r\n    var $userPhoneNumber = $('#user_phone_number');\r\n    var $checkoutForm = $('form.woocommerce-checkout');\r\n\r\n    // CHANGE: Add function to get and format the phone number\r\n    function getPhoneNumber() {\r\n        var phoneNumber = $( '#billing_phone' ).val();\r\n        var fullPhoneNumberField = $( 'input[name=\"billing_phone_full\"]' );\r\n        var addPrefix = false;\r\n\r\n        // Check for the full phone number hidden field generated by the Intl Tel Input to make sure the country code is included\r\n        if ( fullPhoneNumberField.length && fullPhoneNumberField.val() ) {\r\n            phoneNumber = fullPhoneNumberField.val();\r\n        }\r\n        // Format the value when Intl Tel is disabled\r\n        else {\r\n            // Check if the phone number has a + at the beginning\r\n            if ( '+' === phoneNumber.charAt ( 0 ) ) {\r\n                addPrefix = true;\r\n            }\r\n\r\n            // Remove all non-numeric characters from the phone number\r\n            phoneNumber = phoneNumber.replace( /\\D/g, '' );\r\n\r\n            // Add the + prefix back to the phone number\r\n            if ( addPrefix ) {\r\n                phoneNumber = '+' + phoneNumber;\r\n            }\r\n        }\r\n\r\n        return phoneNumber;\r\n    }\r\n\r\n    function startResendTimer() {\r\n        $awpResendOtpBtn.prop('disabled', true);\r\n        updateResendTimerText();\r\n        resendInterval = setInterval(function() {\r\n            resendTimer--;\r\n            updateResendTimerText();\r\n            if (resendTimer <= 0) {\r\n                clearInterval(resendInterval);\r\n                $awpResendOtpBtn.prop('disabled', false);\r\n                $awpResendTimer.text('');\r\n                resendTimer = initialResendTimer;\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    function updateResendTimerText() {\r\n        $awpResendTimer.text(' (' + resendTimer + 's)');\r\n    }\r\n\r\n    function showPopupMessage(message, isSuccess) {\r\n        var messageClass = isSuccess ? 'custom-message-success' : 'custom-message-error';\r\n\r\n        var messageElement = $billingPhoneField.next('.woocommerce-message.custom-message');\r\n        if (messageElement.length === 0) {\r\n            messageElement = $('<div class=\"woocommerce-message custom-message\"></div>');\r\n            $billingPhoneField.after(messageElement);\r\n        }\r\n        messageElement\r\n            .removeClass('custom-message-success custom-message-error')\r\n            .addClass(messageClass)\r\n            .text(message)\r\n            .show();\r\n\r\n        var popupMessageElement = $awpOtpPopup.find('.awp-popup-message');\r\n        if (popupMessageElement.length === 0) {\r\n            popupMessageElement = $('<div class=\"awp-popup-message\"></div>');\r\n            $awpOtpPopup.find('.awp-otp-content').prepend(popupMessageElement);\r\n        }\r\n        popupMessageElement\r\n            .removeClass('custom-message-success custom-message-error')\r\n            .addClass(messageClass)\r\n            .text(message)\r\n            .show();\r\n    }\r\n\r\n    async function sendOtp(phoneNumber, firstName) {\r\n        try {\r\n            const response = await $.post({\r\n                url: otpAjax.ajaxurl,\r\n                data: {\r\n                    action: 'send_otp',\r\n                    phone_number: phoneNumber,\r\n                    first_name: firstName,\r\n                    security: otpAjax.nonce\r\n                }\r\n            });\r\n            if (response.success) {\r\n                console.log(\"OTP sent successfully\");\r\n                showPopupMessage(awp_translations.otp_sent_success, true);\r\n                $awpOtpPopup.show();\r\n                otpSent = true;\r\n                startResendTimer();\r\n            } else {\r\n                console.log(\"Failed to send OTP\");\r\n                showPopupMessage(awp_translations.otp_sent_failure, false);\r\n            }\r\n        } catch (error) {\r\n            console.log(\"Error in sending OTP\", error);\r\n            showPopupMessage(awp_translations.otp_sent_failure, false);\r\n        }\r\n    }\r\n\r\n    async function verifyOtp() {\r\n        var otp = '';\r\n        $('.otp-input').each(function() {\r\n            otp += $(this).val();\r\n        });\r\n\r\n        try {\r\n            const response = await $.post({\r\n                url: otpAjax.ajaxurl,\r\n                dataType: 'json',\r\n                data: {\r\n                    action: 'verify_otp',\r\n                    otp: otp,\r\n                    security: otpAjax.nonce\r\n                }\r\n            });\r\n\r\n            if (response.success) {\r\n                console.log(\"OTP verified successfully\");\r\n                showPopupMessage(awp_translations.otp_verified_success, true);\r\n\r\n                if (!otpAjax.isLoggedIn) {\r\n                    sessionStorage.setItem('otp_verified', 'true');\r\n                }\r\n\r\n                // CHANGE: Replace the variable value with the function call\r\n                const phoneNumber = getPhoneNumber();\r\n                if (otpAjax.isLoggedIn) {\r\n                    await $.post({\r\n                        url: otpAjax.ajaxurl,\r\n                        data: {\r\n                            action: 'update_user_phone_number',\r\n                            phone_number: phoneNumber,\r\n                            security: otpAjax.nonce\r\n                        }\r\n                    });\r\n                }\r\n\r\n                // CHANGE: Trigger update checkout event\r\n                $( document.body ).trigger( 'update_checkout' );\r\n\r\n                setTimeout(function() {\r\n                    $awpOtpPopup.hide();\r\n                    // CHANGE: Replace the checkout form submit event with the default one\r\n                    return true;\r\n                }, 2000);\r\n            } else {\r\n                console.log(\"Incorrect OTP\");\r\n                showPopupMessage(awp_translations.otp_incorrect, false);\r\n            }\r\n        } catch (error) {\r\n            console.log(\"Error in verifying OTP\", error);\r\n            showPopupMessage(awp_translations.otp_incorrect, false);\r\n        }\r\n    }\r\n\r\n    $(document.body).on('checkout_error', function() {\r\n        $awpOtpPopup.hide();\r\n    });\r\n\r\n    // CHANGE: Replace selectors to trigger OTP verification\r\n    $(document).on('click', '.fc-checkout-step .fc-step__substep-save, .fc-checkout-step .fc-step__next-step', async function(e) {\r\n    if (otpAjax.enableForVisitorsOnly === 'yes' && otpAjax.isLoggedIn === 'true') {\r\n        return true;\r\n    }\r\n\r\n    if (!otpSent && $awpOtpPopup.is(':hidden')) {\r\n        e.preventDefault();\r\n        // CHANGE: Replace the variable value with the function call\r\n        var phoneNumber = getPhoneNumber();\r\n        var firstName = $('#billing_first_name').val();\r\n        $userPhoneNumber.text(phoneNumber);\r\n\r\n        try {\r\n            const response = await $.post({\r\n                url: otpAjax.ajaxurl,\r\n                dataType: 'json',\r\n                data: {\r\n                    action: 'verify_phone_number',\r\n                    phone_number: phoneNumber,\r\n                    security: otpAjax.nonce\r\n                }\r\n            });\r\n\r\n            if (response.success) {\r\n                if (response.data.status === 'verified') {\r\n                    // CHANGE: Replace the checkout form submit event with the default one\r\n                    return true;\r\n                } else if (response.data.status === 'not_verified') {\r\n                    sendOtp(phoneNumber, firstName);\r\n                    $awpOtpPopup.show();\r\n                } else if (sessionStorage.getItem('otp_verified') === 'true') {\r\n                    // CHANGE: Replace the checkout form submit event with the default one\r\n                    return true;\r\n                } \r\n                // CHANGE: Check if the hidden field value is empty to avoid repeated verification\r\n                else if ( $('#wawp-is_verified').length && ! $('#wawp-is_verified').val() ) {\r\n                    sendOtp(phoneNumber, firstName);\r\n                    $awpOtpPopup.show();\r\n                }\r\n            } else {\r\n                if (response.data.status === 'not_verified') {\r\n                    sendOtp(phoneNumber, firstName);\r\n                    $awpOtpPopup.show();\r\n                } else {\r\n                    showPopupMessage(response.data.message, false);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            showPopupMessage(awp_translations.phone_registered, false);\r\n        }\r\n    }\r\n});\r\n\r\n\r\n    $(document).on('click', '.awp-otp-popup-close', function() {\r\n        $awpOtpPopup.hide();\r\n        otpSent = false;\r\n    });\r\n\r\n    $(document).on('click', '#awp_verify_otp_btn', verifyOtp);\r\n\r\n    $(document).on('click', '#awp_resend_otp_btn', function() {\r\n        // CHANGE: Replace the variable value with the function call\r\n        var phoneNumber = getPhoneNumber();\r\n        var firstName = $('#billing_first_name').val();\r\n        sendOtp(phoneNumber, firstName);\r\n\r\n        resendTimer += 5;\r\n        updateResendTimerText();\r\n    });\r\n\r\n    $(document).on('click', '#awp_edit_phone_btn', function() {\r\n        $awpOtpPopup.hide();\r\n        otpSent = false;\r\n        $('#billing_phone').focus();\r\n    });\r\n\r\n    $(document).on('input', '.otp-input', function() {\r\n        if ($(this).val().length === this.maxLength) {\r\n            $(this).next('.otp-input').focus();\r\n        }\r\n        var otp = '';\r\n        $('.otp-input').each(function() {\r\n            otp += $(this).val();\r\n        });\r\n        if (otp.length === 6) {\r\n            verifyOtp();\r\n        }\r\n    });\r\n\r\n    $(document).on('keydown', '.otp-input', function(e) {\r\n        if (e.key === 'Backspace' && $(this).val().length === 0) {\r\n            $(this).prev('.otp-input').focus().val('');\r\n        }\r\n    });\r\n\r\n    $(document).on('paste', '.otp-input', function(e) {\r\n        var clipboardData = e.originalEvent.clipboardData.getData('text');\r\n        var otpInputs = $('.otp-input');\r\n        for (var i = 0; i < clipboardData.length; i++) {\r\n            $(otpInputs[i]).val(clipboardData[i]);\r\n        }\r\n        otpInputs[clipboardData.length - 1].focus();\r\n        var otp = '';\r\n        $('.otp-input').each(function() {\r\n            otp += $(this).val();\r\n        });\r\n        if (otp.length === 6) {\r\n            verifyOtp();\r\n        }\r\n    });\r\n});\r\n"],"names":["jQuery","document","ready","$","resendInterval","otpSent","resendTimer","initialResendTimer","$awpResendOtpBtn","$awpResendTimer","$billingPhoneField","$awpOtpPopup","$userPhoneNumber","getPhoneNumber","phoneNumber","val","fullPhoneNumberField","addPrefix","length","charAt","replace","updateResendTimerText","text","showPopupMessage","message","isSuccess","messageClass","messageElement","next","popupMessageElement","after","removeClass","addClass","show","find","prepend","async","sendOtp","firstName","await","post","url","otpAjax","ajaxurl","data","action","phone_number","first_name","security","nonce","success","console","log","awp_translations","otp_sent_success","prop","setInterval","clearInterval","otp_sent_failure","error","verifyOtp","otp","each","this","dataType","otp_verified_success","isLoggedIn","sessionStorage","setItem","body","trigger","setTimeout","hide","otp_incorrect","on","e","enableForVisitorsOnly","is","preventDefault","response","status","getItem","phone_registered","focus","maxLength","key","prev","clipboardData","originalEvent","getData","otpInputs","i"],"mappings":"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"}