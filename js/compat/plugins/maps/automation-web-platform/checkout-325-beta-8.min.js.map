{"version":3,"file":"../../automation-web-platform/checkout-325-beta-8.min.js","sources":["automation-web-platform/checkout-325-beta-8.js"],"sourcesContent":["jQuery(document).ready(function($) {\n    var otpSent = false;\n    var resendInterval;\n    var resendTimer = 5;\n    var initialResendTimer = 5;\n\n    var $awpResendOtpBtn = $('#awp_resend_otp_btn');\n    var $awpResendTimer = $('#awp_resend_timer');\n    var $billingPhoneField = $('#billing_phone_field');\n    var $awpOtpPopup = $('#awp_otp_popup');\n    var $userPhoneNumber = $('#user_phone_number');\n    var $checkoutForm = $('form.woocommerce-checkout');\n    var otpInputs = $('.otp-input');\n    var $verificationMessage = $('#verification_message');\n\n    // Consolidated Functions\n    function startResendTimer() {\n        $awpResendOtpBtn.prop('disabled', true);\n        updateResendTimerText();\n        resendInterval = setInterval(function() {\n            resendTimer--;\n            updateResendTimerText();\n            if (resendTimer <= 0) {\n                clearInterval(resendInterval);\n                $awpResendOtpBtn.prop('disabled', false);\n                $awpResendTimer.text('');\n                resendTimer = initialResendTimer;\n            }\n        }, 1000);\n    }\n\n    function updateResendTimerText() {\n        $awpResendTimer.text(' (' + resendTimer + 's)');\n    }\n\n    function showPopupMessage(message, isSuccess) {\n        var messageClass = isSuccess ? 'custom-message-success' : 'custom-message-error';\n\n        var messageElement = $billingPhoneField.next('.woocommerce-message.custom-message');\n        if (messageElement.length === 0) {\n            messageElement = $('<div class=\"woocommerce-message custom-message\"></div>');\n            $billingPhoneField.after(messageElement);\n        }\n        messageElement\n            .removeClass('custom-message-success custom-message-error')\n            .addClass(messageClass)\n            .text(message)\n            .show();\n\n        var popupMessageElement = $awpOtpPopup.find('.awp-popup-message');\n        if (popupMessageElement.length === 0) {\n            popupMessageElement = $('<div class=\"awp-popup-message\"></div>');\n            $awpOtpPopup.find('.awp-otp-content').prepend(popupMessageElement);\n        }\n        popupMessageElement\n            .removeClass('custom-message-success custom-message-error')\n            .addClass(messageClass)\n            .text(message)\n            .show();\n    }\n\n    async function sendOtp(phoneNumber, firstName) {\n        try {\n            const response = await $.post({\n                url: otpAjax.ajaxurl,\n                data: {\n                    action: 'send_otp',\n                    phone_number: phoneNumber,\n                    first_name: firstName,\n                    security: otpAjax.nonce\n                }\n            });\n            if (response.success) {\n                console.log(\"OTP sent successfully\");\n                showPopupMessage(awp_translations.otp_sent_success, true);\n                $awpOtpPopup.show();\n                otpSent = true;\n                startResendTimer();\n            } else {\n                console.log(\"Failed to send OTP\");\n                showPopupMessage(awp_translations.otp_sent_failure, false);\n            }\n        } catch (error) {\n            console.log(\"Error in sending OTP\", error);\n            showPopupMessage(awp_translations.otp_sent_failure, false);\n        }\n    }\n\n    async function verifyOtp() {\n        var otp = '';\n        otpInputs.each(function() {\n            otp += $(this).val();\n        });\n\n        try {\n            const response = await $.post({\n                url: otpAjax.ajaxurl,\n                dataType: 'json',\n                data: {\n                    action: 'verify_otp',\n                    otp: otp,\n                    security: otpAjax.nonce\n                }\n            });\n\n            if (response.success) {\n                console.log(\"OTP verified successfully\");\n                showPopupMessage(awp_translations.otp_verified_success, true);\n\n                // Hide the OTP popup after successful verification\n                $awpOtpPopup.hide();\n\n\t\t\t\t// CHANGE: Trigger update checkout event\n\t\t\t\t$( document.body ).trigger( 'update_checkout' );\n\n\t\t\t\t// CHANGE: Replace the checkout form submit event with the default one\n\t\t\t\treturn true;\n            } else {\n                console.log(\"Incorrect OTP\");\n                showPopupMessage(awp_translations.otp_incorrect, false);\n            }\n        } catch (error) {\n            console.log(\"Error in verifying OTP\", error);\n            showPopupMessage(awp_translations.otp_incorrect, false);\n        }\n    }\n\n    function clearOtpInputs() {\n        otpInputs.val('').prop('disabled', true).css({ 'background-color': '#cacaca', 'border': '#cacaca' });\n        otpInputs.first().prop('disabled', false).css('background-color', 'white');\n    }\n\n    // Event Handlers\n    $(document).on('click', '#fc-wawp-verify-button', async function(e) {\n        if (!otpSent && $awpOtpPopup.is(':hidden')) {\n            e.preventDefault();\n            var phoneNumber = $('#billing_phone').val();\n            var firstName = $('#billing_first_name').val();\n            $userPhoneNumber.text(phoneNumber);\n            sendOtp(phoneNumber, firstName);\n            $awpOtpPopup.show();\n            otpInputs.first().focus(); // Always focus on the first input initially\n        }\n    });\n\n    $(document).on('click', '.awp-otp-popup-close', function() {\n        $awpOtpPopup.hide();\n        otpSent = false;\n        clearOtpInputs();\n    });\n\n    // Auto Verify OTP After All Inputs are Filled\n    otpInputs.on('input', function() {\n        if ($(this).val().length === this.maxLength) {\n            $(this).next('.otp-input').prop('disabled', false).css('background-color', 'white').focus();\n        }\n\n        // Style the current and unfilled fields accordingly\n        otpInputs.each(function() {\n            if ($(this).val() === '') {\n                $(this).css({ 'background-color': '#cacaca', 'border': '#cacaca' });\n            } else {\n                $(this).css({ 'background-color': 'white', 'border': '1px solid #ccc' });\n            }\n        });\n\n        // Check if all OTP inputs are filled\n        var allFilled = otpInputs.filter(function() {\n            return $(this).val() === '';\n        }).length === 0;\n\n        if (allFilled) {\n            verifyOtp();\n        }\n    });\n\n    otpInputs.on('keydown', function(e) {\n        if (e.key === 'Backspace') {\n            if ($(this).val().length === 0) {\n                $(this).prev('.otp-input').focus();\n            }\n        }\n    });\n\n    otpInputs.on('paste', function(e) {\n        var clipboardData = e.originalEvent.clipboardData.getData('text');\n        otpInputs.each(function(index) {\n            $(this).val(clipboardData[index] || '');\n        });\n\n        // Automatically verify OTP if all fields are filled\n        var allFilled = otpInputs.filter(function() {\n            return $(this).val() === '';\n        }).length === 0;\n\n        if (allFilled) {\n            verifyOtp();\n        }\n    });\n\n    $(document).on('click', '#awp_verify_otp_btn', verifyOtp);\n\n    $(document).on('click', '#awp_resend_otp_btn', function() {\n        var phoneNumber = $('#billing_phone').val();\n        var firstName = $('#billing_first_name').val();\n        sendOtp(phoneNumber, firstName);\n        resendTimer += 5;\n        updateResendTimerText();\n    });\n\n    $(document).on('click', '#awp_edit_phone_btn', function() {\n        $awpOtpPopup.hide();\n        otpSent = false;\n        $('#billing_phone').focus();\n    });\n\n    // Initialize OTP Inputs State\n    clearOtpInputs(); // Ensures that the first field is ready for entry when the page is loaded\n});\n"],"names":["jQuery","document","ready","$","resendInterval","otpSent","resendTimer","initialResendTimer","$awpResendOtpBtn","$awpResendTimer","$billingPhoneField","$awpOtpPopup","$userPhoneNumber","otpInputs","updateResendTimerText","text","showPopupMessage","message","isSuccess","messageClass","messageElement","next","popupMessageElement","length","after","removeClass","addClass","show","find","prepend","async","sendOtp","phoneNumber","firstName","await","post","url","otpAjax","ajaxurl","data","action","phone_number","first_name","security","nonce","success","console","log","awp_translations","otp_sent_success","prop","setInterval","clearInterval","otp_sent_failure","error","verifyOtp","otp","each","this","val","dataType","otp_verified_success","hide","body","trigger","otp_incorrect","clearOtpInputs","css","background-color","border","first","on","e","is","preventDefault","focus","maxLength","filter","key","prev","clipboardData","originalEvent","getData","index"],"mappings":"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"}