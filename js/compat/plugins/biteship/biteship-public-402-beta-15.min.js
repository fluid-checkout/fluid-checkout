function getKeyByValue(i,t){return Object.keys(i).find(e=>i[e].toUpperCase()===t.toUpperCase())}function getAreasV2(i,t){var a,e;null!==document.getElementById(t+"_biteship_province")&&null!==(a=i(`#${t}_biteship_province`).val())&&0<a.length&&(e=phpVars.biteshipBaseUrl||"",i(".overlay").css("display","block"),i.ajax({url:e+"/v1/woocommerce/maps/administrative_division_levels",data:{level:"2",area_id:a},type:"POST",headers:{authorization:"Bearer "+(phpVars.biteshipLicenseKey||"")},success:function(e){e.success||alert("API Biteship sedang bermasalah."),0<e.areas.length&&(localStorage.setItem(t+"_areas",JSON.stringify(e.areas)),setMapAreas(i,e.areas,t+"_biteship_city","administrative_division_level_2_name"),setMapAreas(i,e.areas,t+"_biteship_district","administrative_division_level_3_name"),setMapAreas(i,e.areas,t+"_biteship_zipcode","postal_code"),i(`#${t}_state`).val(getStateID(e.areas[0].administrative_division_level_1_name)).change(),getListMultiOrigin(i,a,t),setCountryState(i,"billing"),setCountryState(i,"shipping"),clearMap(),i("body").trigger("update_checkout"),i(".overlay").css("display","none"))},error:function(e){console.log("Gagal mencari lokasi berdasarkan provinsi, kota & kecamatan."),i(".overlay").css("display","none")}}))}function setMapAreas(i,e,t,a){let n="",o=(t.includes("city")?n="Pilih Kota":t.includes("district")?n="Pilih Kecamatan":t.includes("zipcode")&&(n="Pilih Kode Pos"),i("#"+t).empty().prop("disabled",!1),[]);e.map(function(e){o.includes(e[a])||(0==o.length&&i("#"+t).append('<option value="" selected>'+n+"</option>"),o.push(e[a]),i("#"+t).append('<option value="'+e[a]+'">'+e[a]+"</option>"))})}function setPosition(e,i,t,a,n){e.setPosition(a),e.setMap(t),i.setContent("<p class='select-location'>Pilih titik ini</p>"),i.setPosition(a),i.open(t,e);i=a.lat()+","+a.lng();n("#position").val(i),n("#billing_biteship_location_coordinate").val(i),n("#shipping_biteship_location_coordinate").val(i),getAddress(n,i),n(document.body).on("input","#billing_biteship_location_coordinate",function(){n("body").trigger("update_checkout",{update_shipping_method:!0})}),n(document.body).on("input","#shipping_biteship_location_coordinate",function(){n("body").trigger("update_checkout",{update_shipping_method:!0})})}function getAddress(t,a){var e=((e,i)=>{for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)^i);return unescape(t)})(phpVars.apiKey,window.location.host.replace("www.","").length)||"";t.ajax({url:`https://maps.googleapis.com/maps/api/geocode/json?latlng=${a}&sensor=true&key=`+e,type:"GET",success:function(e){var i;"OK"===e.status?(i=e.results[0].formatted_address,t("#billing_biteship_location").val(i).addClass("valid"),t("#shipping_biteship_location").val(i).addClass("valid"),110<=i.length?(t("#billing_biteship_location").css({"padding-left":"29px",background:'url("'+window.location.protocol+"//"+window.location.host.replace("www.","")+'/wp-content/plugins/biteship/public/images/pin.svg") no-repeat left',"background-size":"13px","background-position":"7px",height:"66px"}),t("#shipping_biteship_location").css({"padding-left":"29px",background:'url("'+window.location.protocol+"//"+window.location.host.replace("www.","")+'/wp-content/plugins/biteship/public/images/pin.svg") no-repeat left',"background-size":"13px","background-position":"7px",height:"66px"})):(t("#billing_biteship_location").css({"padding-left":"29px",background:'url("'+window.location.protocol+"//"+window.location.host.replace("www.","")+'/wp-content/plugins/biteship/public/images/pin.svg") no-repeat left',"background-size":"13px","background-position":"7px",height:"48px"}),t("#shipping_biteship_location").css({"padding-left":"29px",background:'url("'+window.location.protocol+"//"+window.location.host.replace("www.","")+'/wp-content/plugins/biteship/public/images/pin.svg") no-repeat left',"background-size":"13px","background-position":"7px",height:"48px"})),saveState("billing_biteship_location",i),saveState("shipping_biteship_location",i),saveState("billing_biteship_location_coordinate",a),saveState("shipping_biteship_location_coordinate",a)):alert(e.status)}})}function customShippingText(e){void 0!==e("[data-title=Shipping]").html()&&(e("[data-title=Shipping]").html().includes("options")||e("[data-title=Shipping]").html().includes("invalid"))&&e("[data-title=Shipping]").text("Masukkan alamat lengkap untuk menghitung ongkos kirim.")}function clearComponent(e,i,t){e(`#${i}_city`).val(""),e(`#${i}_postcode`).val(""),e(`#${i}_state`).prop("selected",!1),e(`#${i}_biteship_new_district`).val(""),e(`#${i}_biteship_multi_origins`).val(""),t&&e(`#${i}_biteship_location`).val(""),t&&getAreasV2(e,i),customShippingText(e)}function getProvinces(){return{Bali:"IDNP1","Bangka Belitung":"IDNP2",Banten:"IDNP3",Bengkulu:"IDNP4","DI Yogyakarta":"IDNP5","DKI Jakarta":"IDNP6",Gorontalo:"IDNP7",Jambi:"IDNP8","Jawa Barat":"IDNP9","Jawa Tengah":"IDNP10","Jawa Timur":"IDNP11","Kalimantan Barat":"IDNP12","Kalimantan Selatan":"IDNP13","Kalimantan Tengah":"IDNP14","Kalimantan Timur":"IDNP15","Kalimantan Utara":"IDNP16","Kepulauan Riau":"IDNP17",Lampung:"IDNP18",Maluku:"IDNP19","Maluku Utara":"IDNP20","Nanggroe Aceh Darussalam (NAD)":"IDNP21","Nusa Tenggara Barat (NTB)":"IDNP22","Nusa Tenggara Timur (NTT)":"IDNP23",Papua:"IDNP24","Papua Barat":"IDNP25",Riau:"IDNP26","Sulawesi Barat":"IDNP27","Sulawesi Selatan":"IDNP28","Sulawesi Tengah":"IDNP29","Sulawesi Tenggara":"IDNP30","Sulawesi Utara":"IDNP31","Sumatera Barat":"IDNP32","Sumatera Selatan":"IDNP33","Sumatera Utara":"IDNP34"}}function getStateID(e){return getProvinces()[e]}function setZipcode(t,a,n){if(null!==localStorage.getItem(n+"_areas")){let i=1;var o=[];t(`#${n}_biteship_zipcode`).empty(),t(`#${n}_biteship_multi_origins`).val(""),JSON.parse(localStorage.getItem(n+"_areas")).map(function(e){a!=e.administrative_division_level_3_name||o.includes(e.postal_code)||(1===i&&t(`#${n}_biteship_zipcode`).append('<option value="" selected>Pilih Kode Pos</option>'),t(`#${n}_biteship_zipcode`).append('<option value="'+e.postal_code+'">'+e.postal_code+"</option>"),i+=1,o.push(e.postal_code))})}}function setDistrict(i,t,a){if(null!==localStorage.getItem(a+"_areas")){let e=JSON.parse(localStorage.getItem(a+"_areas"));var n=[];i(`#${a}_biteship_district`).empty(),i(`#${a}_biteship_zipcode`).empty(),e.map(function(e){t!=e.administrative_division_level_2_name||n.includes(e.administrative_division_level_3_name)||(i(`#${a}_biteship_district`).append('<option value="" selected>Pilih Kecamatan</option>'),i(`#${a}_biteship_district`).append('<option value="'+e.administrative_division_level_3_name+'">'+e.administrative_division_level_3_name+"</option>"),n.push(e.administrative_division_level_3_name))})}}function closeModal(e){e.css("display","none")}function modifyComponent(i,t){i("#billing_phone_field>label").html('No Tlp <abbr class="required" title="required">*</abbr>'),i("#billing_email_field>label").html('Alamat Email <abbr class="required" title="required">*</abbr>'),i(document.body).on("change",`#${t}_biteship_address`,function(){var e=i(`#${t}_biteship_address`).val();i(`#${t}_address_1`).val(e),saveState(t+"_address_1",e)}),i(document.body).on("click",`#${t}_biteship_location`,function(){i("#myModal").show(),i("#placeSearch").val("")}),i(document.body).on("change",`#${t}_biteship_province`,function(){clearComponent(i,t,!1),getAreasV2(i,t),saveState(t+"_biteship_province",i(`#${t}_biteship_province`).val()),i("body").trigger("update_checkout")}),i(document.body).on("change",`#${t}_biteship_city`,function(){clearComponent(i,t,!1);var e=i(`#${t}_biteship_city`).val();i(`#${t}_city`).val(e),setDistrict(i,e,t),saveState(t+"_biteship_city",i(`#${t}_biteship_city`).val()),i("body").trigger("update_checkout")}),i(document.body).on("change",`#${t}_biteship_district`,function(){var e=i(`#${t}_biteship_district`).val();saveState(t+"_biteship_district",i(`#${t}_biteship_district`).val()),setZipcode(i,e,t)}),i(document.body).on("change",`#${t}_biteship_zipcode`,function(){var e=i(`#${t}_biteship_zipcode`).val();i(`#${t}_postcode`).val(e).change(),i("body").trigger("update_checkout"),saveState(t+"_biteship_zipcode",i(`#${t}_biteship_zipcode`).val())}),i(document.body).on("change",`#${t}_biteship_new_district`,function(){0===i(`#${t}_biteship_new_district`).val().length&&(i(`#${t}_biteship_district_info`).val(""),i(`#${t}_biteship_district_info_field`).hide(),i("body").trigger("update_checkout",{update_shipping_method:!0}),clearComponent(i,"billing",!0),clearComponent(i,"shipping",!0))})}function saveState(e,i){localStorage.setItem(e,i)}function loadState(e){return localStorage.getItem(e)}function removeState(e){return localStorage.removeItem(e)}function preventDefault(e){e.preventDefault()}function preventDefaultForScrollKeys(e){if({37:1,38:1,39:1,40:1}[e.keyCode])return preventDefault(e),!1}(t=>{t(function(){createTracker(t),loadProvince(t),setTimeout(function(){["billing","shipping"].forEach(e=>{[e+"_country_field",e+"_company_field",e+"_address_1_field",e+"_address_2_field",e+"_state_field",e+"_city_field",e+"_postcode_field",e+"biteship_district",e+"_biteship_district_info_field"].forEach(e=>{(!window.location.href.toString().includes("edit-address")||e.includes("country"))&&window.location.href.toString().includes("edit-address")||t("#"+e).hide()}),t(`#${e}_biteship_location`).css({"padding-left":"29px",background:'url("'+window.location.protocol+"//"+window.location.host.replace("www.","")+'/wp-content/plugins/biteship/public/images/pin.svg") no-repeat left',"background-size":"13px","background-position":"7px",height:"48px","min-height":"45px"})}),t("#myModal").hide(),customShippingText(t),parseInt(phpVars.userSession.clearCache)?(clearComponent(t,"billing",!0),clearComponent(t,"shipping",!0),t("[data-title=Shipping]").text("Masukkan alamat lengkap untuk menghitung ongkos kirim"),console.log("CLEAR CACHE")):("dropdown"!==phpVars.checkoutType||location.href.includes("edit-address")||(removeState("billing_areas"),removeState("shipping_areas"),null==localStorage.getItem("billing_areas")&&getAreasV2(t,"billing"),null==localStorage.getItem("shipping_areas")&&getAreasV2(t,"shipping")),t("#billing_postcode").val(phpVars.userSession.postcode),t("body").trigger("update_checkout",{update_shipping_method:!0}))},1800),modifyComponent(t,"billing"),modifyComponent(t,"shipping"),t("body").append(`
    <div id="myModal">
      <div class="modal-content">
        <div>
          <span style="font-size: 25px;">Pin Alamat .</span>
          <span id="closemyModal" class="close">&times;</span>
        </div>
        <form id="mapSearchForm" style="margin-top: 10px;font-size:13px;">
          <input style="width: 100%" type="text" id="placeSearch" placeholder="Masukkan alamat lengkap yang ada atau pilih pin"> 
        </form>
        <div id="mapCheckout" class="map-order-review"></div>
      </div>
    </div>`),phpVars=phpVars||{},t("#placeSearch").click(function(){500<=screen.width&&disableScroll()}),gmapView(t);var e=t("#myModal"),i=t("#closemyModal");0<i.length&&i[0].addEventListener("click",function(){closeModal(e)}),t(document).on("click",".select-location",function(){closeModal(e),t(document.body).trigger("update_checkout")}),smartSearchV2(t,phpVars),t(document.body).on("updated_checkout",function(){smartSearchV2(t,phpVars)}),t("form.checkout").on("change",'input[name="payment_method"]',function(){t(document.body).trigger("update_checkout")}),t("form.checkout").on("change",'input[name="is_insurance_active"]',function(){t(document.body).trigger("update_checkout")}),refreshMultiOrigin(t,"billing"),refreshMultiOrigin(t,"shipping")})})(jQuery);var supportsPassive=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}}))}catch(e){}var wheelOpt=!!supportsPassive&&{passive:!1},wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel";function disableScroll(){window.addEventListener("DOMMouseScroll",preventDefault,!1),window.addEventListener(wheelEvent,preventDefault,wheelOpt),window.addEventListener("touchmove",preventDefault,wheelOpt),window.addEventListener("keydown",preventDefaultForScrollKeys,!1)}function enableScroll(){window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.removeEventListener(wheelEvent,preventDefault,wheelOpt),window.removeEventListener("touchmove",preventDefault,wheelOpt),window.removeEventListener("keydown",preventDefaultForScrollKeys,!1)}function loadProvince(a){let n=0;var o=getProvinces();["billing","shipping"].forEach(e=>{if(null!==document.getElementById(e+"_biteship_province")&&!document.getElementById(e+"_biteship_province").innerHTML.includes("IDNP1"))for(var[i,t]of Object.entries(o))0==n&&(a(`#${e}_biteship_province`).empty(),a(`#${e}_biteship_province`).append('<option value="" selected>Pilih Provinsi</option>'),a(`#${e}_biteship_city`).empty(),a(`#${e}_biteship_city`).append('<option value="" selected>Pilih Kota</option>'),a(`#${e}_biteship_district`).empty(),a(`#${e}_biteship_district`).append('<option value="" selected>Pilih Kecamatan</option>'),a(`#${e}_biteship_zipcode`).empty(),a(`#${e}_biteship_zipcode`).append('<option value="" selected>Pilih Kode Pos</option>'),a(`#${e}_biteship_multi_origins`).empty(),a(`#${e}_biteship_multi_origins`).append('<option value="" selected>Pilih province dulu</option>')),a(`#${e}_biteship_province`).append('<option value="'+t+'">'+i+"</option>"),n+=1})}function createTracker(o){0<phpVars.trackingPageUrl.length&&parseInt(phpVars.trackingPageIsactive)&&o("body").html().includes('data-title="Actions"')&&o("tr.woocommerce-orders-table__row").each(function(e){var i,t=o(this).find("td.woocommerce-orders-table__cell.woocommerce-orders-table__cell-order-actions a"),a=o(this).find("td.woocommerce-orders-table__cell.woocommerce-orders-table__cell-order-actions"),n=new URL(t.attr("href")).searchParams.get("view-order");void 0!==(n=null===n&&3<(i=t.attr("href").split("/")).length?i[i.length-2]:n)&&(i={action:"get_order_detail",orderId:n,dataType:"json"},o.post("/wp-admin/admin-ajax.php",i,function(e){e.success?0<e.data.waybill_id.length&&a.append(`<a href="${phpVars.trackingPageUrl}?waybill_id=${e.data.waybill_id}" target="_blank" class="woocommerce-button wp-element-button button view">TRACK</a>`,[t]):console.log("ERROR!!!",n)}))})}function smartSearchV2(t,i){if(i!=={}&&"smartsearch"===i.checkoutType)try{t(".init-select2 select").select2(),t(".select2-ajax select").each(function(){var e=i.biteshipBaseUrl||"";t(this).select2({ajax:{url:e+"/v1/woocommerce/maps/areas",dataType:"json",headers:{authorization:"Bearer "+(i.biteshipLicenseKey||"")},type:"POST",delay:250,data:function(e){return{countries:"ID",input:e.term,type:"single"}},processResults:function(e,i){var t=[];return 0<e.areas.length&&(t=e.areas.map(function(e){return{id:e.id,text:e.postal_code+`, ${e.administrative_division_level_3_name}, ${e.administrative_division_level_2_name}, `+e.administrative_division_level_1_name,name:e.name,provice:e.administrative_division_level_1_name,district:e.administrative_division_level_3_name,city:e.administrative_division_level_2_name,state:e.administrative_division_level_1_name,zipcode:e.postal_code}})),saveState("smartsearch_area",JSON.stringify(t)),{results:t}},cache:!0},minimumInputLength:3,language:{inputTooShort:function(e){return"Input minimal 3 karakter"}},placeholder:t(this).attr("placeholder")})}),["billing","shipping"].forEach(i=>{t(document.body).on("change",`#${i}_biteship_new_district`,function(){setTimeout(function(){var e=localStorage.getItem("smartsearch_area");void 0!==e&&JSON.parse(e).map(function(e){e.text===document.getElementById(`select2-${i}_biteship_new_district-container`).title&&(1<e.id.split("IDNC").length&&getListMultiOrigin(t,e.id.split("IDNC")[0],i),t(`#${i}_state`).val(e.state).change(),t(`#${i}_city`).val(e.city),t(`#${i}_postcode`).val(e.zipcode),t(`#${i}_biteship_district`).val(e.district),t("body").trigger("update_checkout"),clearMap(),customShippingText(t))})},1200)})})}catch(e){console.log(e)}}function getListMultiOrigin(i,e,t){parseInt(phpVars.multipleOriginsIsactive)?(e={action:"biteship_public_get_multiple_origin",areaID:e,security:phpVars.biteshipNonce,dataType:"json"},i.post(woocommerce_params.ajax_url,e,function(e){e.success?setMultiOrigin(i,e.data,t):window.alert("ERROR!!!")})):console.log("multiple origin not active")}function setMultiOrigin(i,e,t){i(`#${t}_biteship_multi_origins`).empty(),0===e.multiple_addresses.length?(i(`#${t}_biteship_multi_origins`).removeAttr("disabled"),e.default_address.map(function(e){i(`#${t}_biteship_multi_origins`).append('<option value="'+e.id+'">'+e.shopname+" - "+e.address+"</option>")})):(i(`#${t}_biteship_multi_origins`).removeAttr("disabled"),i(`#${t}_biteship_multi_origins`).append('<option value="none" selected>Pilih Toko</option>'),e.multiple_addresses.map(function(e){i(`#${t}_biteship_multi_origins`).append('<option value="'+e.id+'">'+e.shopname+" - "+e.address+"</option>")}))}function gmapView(n){var o,s=null,e=((e,i)=>{for(var t="",a=0;a<e.length;a++)t+=String.fromCharCode(e.charCodeAt(a)^i);return unescape(t)})(phpVars.apiKey,window.location.host.replace("www.","").length)||"";n.getScript(`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=places`,function(){var i={lat:-6.1753871,lng:106.8249641},t=(5<phpVars.userSession.coordinate.length&&(e=phpVars.userSession.coordinate.split(","),i.lat=parseFloat(e[0]),i.lng=parseFloat(e[1])),new google.maps.Map(document.getElementById("mapCheckout"),{zoom:15,center:i,disableDefaultUI:!0,fullscreenControl:!0})),e=(s=new google.maps.Marker({position:null,map:null,title:"Location"}),o=new google.maps.InfoWindow({}),t.addListener("click",function(e){e=e.latLng;setPosition(s,o,t,e,n)}),document.getElementById("placeSearch")),a=new google.maps.places.Autocomplete(e);a.setComponentRestrictions({country:["id"]}),a.addListener("place_changed",function(){var e=a.getPlace();e.geometry&&(i={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},t.setCenter(e.geometry.location),s.setPosition(e.geometry.location),s.setMap(t),setPosition(s,o,t,e.geometry.location,n),n("#position-input").val(e.geometry.location.lat()+","+e.geometry.location.lng()),500<=screen.width)&&enableScroll()})})}function refreshMultiOrigin(e,i){e(document.body).on("change",`#${i}_biteship_multi_origins`,function(){"none"===this.value?alert("Pastikan anda sudah pilih toko"):("woocommerceFree"===phpVars.biteshipLicenseKeyType&&"woocommerceEssentials"===phpVars.biteshipLicenseKeyType||clearMap(),e("body").trigger("update_checkout",{update_shipping_method:!0}),gmapView(e))})}function clearMap(){null!==document.getElementById("position")&&(document.getElementById("position").value=""),null!==document.getElementById("billing_biteship_location")&&(document.getElementById("billing_biteship_location").value=""),null!==document.getElementById("shipping_biteship_location")&&(document.getElementById("shipping_biteship_location").value=""),null!==document.getElementById("billing_biteship_location_coordinate")&&(document.getElementById("billing_biteship_location_coordinate").value=""),null!==document.getElementById("shipping_biteship_location_coordinate")&&(document.getElementById("shipping_biteship_location_coordinate").value="")}function setCountryState(e,i){if(!location.href.includes("edit-address")){var t="#"+i+"_state";if(null!==document.getElementById(i+"_state")){i=getProvinces();if(e(t).val().includes("IDN"))for(var[a,n]of Object.entries(i))if(n===e(t).val()){document.getElementById("billing_state").value=a,console.log("yohohoohoh");break}}}}