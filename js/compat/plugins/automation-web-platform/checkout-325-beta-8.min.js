jQuery(document).ready(function(n){var t,a=!1,c=5,s=5,i=n("#awp_resend_otp_btn"),r=n("#awp_resend_timer"),l=(n("#billing_phone_field"),n("#awp_otp_popup")),p=n("#user_phone_number"),u=(n("form.woocommerce-checkout"),n(".otp-input")),d=(n("#verification_message"),n("#billing_phone"));function _(){r.text(" ("+c+"s)")}function f(o,e){var e=e?"woocommerce-success":"woocommerce-error",t=d.next(".fc-wawp-message"),t=(0===t.length&&(t=n('<span class="fc-wawp-message"></span>'),d.after(t)),t.removeClass("woocommerce-success woocommerce-error").addClass(e).text(o).show(),l.find(".awp-popup-message"));0===t.length&&(t=n('<div class="awp-popup-message"></div>'),l.find(".awp-otp-content").prepend(t)),t.removeClass("custom-message-success custom-message-error").addClass(e).text(o).show()}async function h(o,e){try{(await n.post({url:otpAjax.ajaxurl,data:{action:"send_otp",phone_number:o,first_name:e,security:otpAjax.nonce}})).success?(console.log("OTP sent successfully"),f(awp_translations.otp_sent_success,!0),l.show(),a=!0,i.prop("disabled",!0),_(),t=setInterval(function(){c--,_(),c<=0&&(clearInterval(t),i.prop("disabled",!1),r.text(""),c=s)},1e3)):(console.log("Failed to send OTP"),f(awp_translations.otp_sent_failure,!1))}catch(o){console.log("Error in sending OTP",o),f(awp_translations.otp_sent_failure,!1)}}async function g(){var o,e="";u.each(function(){e+=n(this).val()});try{if((await n.post({url:otpAjax.ajaxurl,dataType:"json",data:{action:"verify_otp",otp:e,security:otpAjax.nonce}})).success)return console.log("OTP verified successfully"),f(awp_translations.otp_verified_success,!0),l.hide(),n(document.body).trigger("update_checkout"),o=d.val(),otpAjax.isLoggedIn&&await n.post({url:otpAjax.ajaxurl,data:{action:"update_user_phone_number",phone_number:o,security:otpAjax.nonce}}),!0;console.log("Incorrect OTP"),f(awp_translations.otp_incorrect,!1)}catch(o){console.log("Error in verifying OTP",o),f(awp_translations.otp_incorrect,!1)}}function o(){u.val("").prop("disabled",!0).css({"background-color":"#cacaca",border:"#cacaca"}),u.first().prop("disabled",!1).css("background-color","white")}n(document).on("click","#fc-wawp-verify-button",async function(o){var e;!a&&l.is(":hidden")&&(o.preventDefault(),o=n("#billing_phone").val(),e=n("#billing_first_name").val(),p.text(o),h(o,e),l.show(),u.first().focus())}),n(document).on("click",".awp-otp-popup-close",function(){l.hide(),a=!1,o()}),u.on("input",function(){n(this).val().length===this.maxLength&&n(this).next(".otp-input").prop("disabled",!1).css("background-color","white").focus(),u.each(function(){""===n(this).val()?n(this).css({"background-color":"#cacaca",border:"#cacaca"}):n(this).css({"background-color":"white",border:"1px solid #ccc"})}),0===u.filter(function(){return""===n(this).val()}).length&&g()}),u.on("keydown",function(o){"Backspace"===o.key&&0===n(this).val().length&&n(this).prev(".otp-input").focus()}),u.on("paste",function(o){var e=o.originalEvent.clipboardData.getData("text");u.each(function(o){n(this).val(e[o]||"")}),0===u.filter(function(){return""===n(this).val()}).length&&g()}),n(document).on("click","#awp_verify_otp_btn",g),n(document).on("click","#awp_resend_otp_btn",function(){h(n("#billing_phone").val(),n("#billing_first_name").val()),c+=5,_()}),n(document).on("click","#awp_edit_phone_btn",function(){l.hide(),a=!1,n("#billing_phone").focus()}),o()});
//# sourceMappingURL=../maps/automation-web-platform/checkout-325-beta-8.min.js.map
