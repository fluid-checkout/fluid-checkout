jQuery(document).ready(function(a){var o,n=!1,s=5,c=5,i=a("#awp_resend_otp_btn"),r=a("#awp_resend_timer"),p=a("#billing_phone_field"),u=a("#awp_otp_popup"),l=a("#user_phone_number");a("form.woocommerce-checkout");function _(){r.text(" ("+s+"s)")}function d(e,t){var t=t?"custom-message-success":"custom-message-error",o=p.next(".woocommerce-message.custom-message"),o=(0===o.length&&(o=a('<div class="woocommerce-message custom-message"></div>'),p.after(o)),o.removeClass("custom-message-success custom-message-error").addClass(t).text(e).show(),u.find(".awp-popup-message"));0===o.length&&(o=a('<div class="awp-popup-message"></div>'),u.find(".awp-otp-content").prepend(o)),o.removeClass("custom-message-success custom-message-error").addClass(t).text(e).show()}async function f(e,t){try{(await a.post({url:otpAjax.ajaxurl,data:{action:"send_otp",phone_number:e,first_name:t,security:otpAjax.nonce}})).success?(console.log("OTP sent successfully"),d(awp_translations.otp_sent_success,!0),u.show(),n=!0,i.prop("disabled",!0),_(),o=setInterval(function(){s--,_(),s<=0&&(clearInterval(o),i.prop("disabled",!1),r.text(""),s=c)},1e3)):(console.log("Failed to send OTP"),d(awp_translations.otp_sent_failure,!1))}catch(e){console.log("Error in sending OTP",e),d(awp_translations.otp_sent_failure,!1)}}async function m(){var e,t="";a(".otp-input").each(function(){t+=a(this).val()});try{(await a.post({url:otpAjax.ajaxurl,dataType:"json",data:{action:"verify_otp",otp:t,security:otpAjax.nonce}})).success?(console.log("OTP verified successfully"),d(awp_translations.otp_verified_success,!0),otpAjax.isLoggedIn||sessionStorage.setItem("otp_verified","true"),e=a("#billing_phone").val(),otpAjax.isLoggedIn&&await a.post({url:otpAjax.ajaxurl,data:{action:"update_user_phone_number",phone_number:e,security:otpAjax.nonce}}),a(document.body).trigger("update_checkout"),setTimeout(function(){u.hide()},2e3)):(console.log("Incorrect OTP"),d(awp_translations.otp_incorrect,!1))}catch(e){console.log("Error in verifying OTP",e),d(awp_translations.otp_incorrect,!1)}}a(document.body).on("checkout_error",function(){u.hide()}),a(document).on("click","#place_order, .fc-checkout-step .fc-step__substep-save, .fc-checkout-step .fc-step__next-step",async function(e){if("yes"===otpAjax.enableForVisitorsOnly&&"true"===otpAjax.isLoggedIn)return!0;if(!n&&u.is(":hidden")){e.preventDefault();var t=a("#billing_phone").val(),o=a("#billing_first_name").val();l.text(t);try{var s=await a.post({url:otpAjax.ajaxurl,dataType:"json",data:{action:"verify_phone_number",phone_number:t,security:otpAjax.nonce}});if(s.success)if("verified"===s.data.status){if(e.target.matches(".fc-checkout-step .fc-step__substep-save"))return!0}else if("not_verified"===s.data.status)f(t,o),u.show();else if("true"===sessionStorage.getItem("otp_verified")){if(e.target.matches(".fc-checkout-step .fc-step__substep-save"))return!0}else f(t,o),u.show();else"not_verified"===s.data.status?(f(t,o),u.show()):d(s.data.message,!1)}catch(e){d(awp_translations.phone_registered,!1)}}}),a(document).on("click",".awp-otp-popup-close",function(){u.hide(),n=!1}),a(document).on("click","#awp_verify_otp_btn",m),a(document).on("click","#awp_resend_otp_btn",function(){f(a("#billing_phone").val(),a("#billing_first_name").val()),s+=5,_()}),a(document).on("click","#awp_edit_phone_btn",function(){u.hide(),n=!1,a("#billing_phone").focus()}),a(document).on("input",".otp-input",function(){a(this).val().length===this.maxLength&&a(this).next(".otp-input").focus();var e="";a(".otp-input").each(function(){e+=a(this).val()}),6===e.length&&m()}),a(document).on("keydown",".otp-input",function(e){"Backspace"===e.key&&0===a(this).val().length&&a(this).prev(".otp-input").focus().val("")}),a(document).on("paste",".otp-input",function(e){for(var t=e.originalEvent.clipboardData.getData("text"),o=a(".otp-input"),s=0;s<t.length;s++)a(o[s]).val(t[s]);o[t.length-1].focus();var n="";a(".otp-input").each(function(){n+=a(this).val()}),6===n.length&&m()})});
//# sourceMappingURL=../maps/automation-web-platform/checkout-325-beta-5.min.js.map
