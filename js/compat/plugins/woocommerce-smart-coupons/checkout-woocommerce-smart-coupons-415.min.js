console.log("[FC SmartCoupons Debug] checkout-woocommerce-smart-coupons compat script file loaded."),jQuery(function(n){var a,c,r;"undefined"==typeof fcSmartCoupons?window&&window.console&&console.warn&&console.warn("[FC SmartCoupons Debug] fcSmartCoupons is undefined, aborting Smart Coupons compatibility script."):((a=function(){var o;window&&window.console&&console.log&&((o=Array.prototype.slice.call(arguments)).unshift("[FC SmartCoupons Debug]"),console.log.apply(console,o))})("Script initialized.",{fcSmartCoupons:fcSmartCoupons,hasApplyButtons:!!n(".apply_coupons_credits").length}),c=function(){var o=n(".fc-checkout-notices");return(o=o.length?o:n(".woocommerce-notices-wrapper:first")).length||(o=n("form.woocommerce-checkout")),a("getNoticesWrapper resolved.",{isForm:o.is("form"),selector:o.selector,length:o.length}),o},r=function(o){var e,t,r=c();r.length?(a("insertNotices: raw message.",o),t=(e=n("<div>").html(o).find(".woocommerce-notices-wrapper")).length?e.html():o,a("insertNotices: parsed content.",{hasInnerWrapper:!!e.length,targetIsForm:r.is("form")}),r.is("form")?r.prepend(t):r.empty().append(t)):a("insertNotices: no wrapper found, message dropped.",o)},document.addEventListener("click",function(o){var e,t=o.target;a("captureHandler fired for click.",{target:t,targetClassName:t&&t.className}),t&&t.closest?(t=t.closest(".apply_coupons_credits"),a('captureHandler: closest(".apply_coupons_credits") result.',{button:t}),t&&(o.preventDefault(),o.stopImmediatePropagation(),a("captureHandler: intercepted click on apply button, calling applySmartCouponForButton."),e=n(t),o=e.data("coupon_code")||e.data("coupon")||e.attr("name")||e.find(".code").text().trim(),a("applySmartCouponForButton called.",{button:e.get(0),couponCode:o,referenceId:e.data("reference_id"),ajaxUrl:fcSmartCoupons.applyUrl}),o?(e.css("opacity","0.5"),n.ajax({type:"POST",url:fcSmartCoupons.applyUrl,data:{coupon_code:o,reference_id:e.data("reference_id")||"",security:fcSmartCoupons.applyNonce},dataType:"json",success:function(o){a("applySmartCouponForButton: AJAX success.",o),o&&o.message?(r(o.message),a("applySmartCouponForButton: triggering update_checkout."),n(document.body).trigger("update_checkout",{update_shipping_method:!1})):a("applySmartCouponForButton: missing response.message, nothing to insert.")},error:function(o,e,t){a("applySmartCouponForButton: AJAX error.",{textStatus:e,errorThrown:t,responseText:o&&o.responseText})},complete:function(){a("applySmartCouponForButton: AJAX complete, restoring button opacity."),e.css("opacity","")}})):a("applySmartCouponForButton: no coupon code found on button (checked data-coupon_code, data-coupon, name, and .code text), aborting."))):a("captureHandler: target has no closest method, aborting.")},!0),document.addEventListener("click",function(o){var e=o.target;a("remove coupon click handler fired.",{target:e,targetClassName:e&&e.className}),e&&e.closest?(e=e.closest("a.woocommerce-remove-coupon"),a('remove coupon handler: closest("a.woocommerce-remove-coupon") result.',{link:e}),e&&(o.preventDefault(),o.stopImmediatePropagation(),a("remove coupon handler: intercepted click on remove link, calling removeSmartCouponForLink."),o=n(e),e=o.data("coupon"),a("removeSmartCouponForLink called.",{link:o.get(0),couponCode:e,referenceId:o.data("reference_id"),ajaxUrl:fcSmartCoupons.removeUrl}),e?n.ajax({type:"POST",url:fcSmartCoupons.removeUrl,data:{coupon_code:e,reference_id:o.data("reference_id")||"",security:fcSmartCoupons.removeNonce},dataType:"json",success:function(o){a("removeSmartCouponForLink: AJAX success.",o),o&&o.message?(r(o.message),a("removeSmartCouponForLink: triggering update_checkout."),n(document.body).trigger("update_checkout",{update_shipping_method:!1})):a("removeSmartCouponForLink: missing response.message, nothing to insert.")},error:function(o,e,t){a("removeSmartCouponForLink: AJAX error.",{textStatus:e,errorThrown:t,responseText:o&&o.responseText})}}):a("removeSmartCouponForLink: no coupon data attribute on link, aborting."))):a("remove coupon handler: target has no closest method, aborting.")},!0))});