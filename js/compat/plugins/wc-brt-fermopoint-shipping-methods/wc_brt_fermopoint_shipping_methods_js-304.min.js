jQuery(document).ready(function(){}),jQuery(window).on("load",function(){0<jQuery('input[name^="shipping_method"]').length&&(isSelectedBrtFermopointShippingMethod()?checkPudableCartNew():(enablePudoShippingMethodNew(),enableCodPayment(),hideMap(),updateShippingAddressWithPudo(null)))}),jQuery("body").on("change",'input[name^="shipping_method"]',function(){jQuery(this).val().startsWith("wc_brt_fermopoint_shipping_methods_custom")?checkPudableCartNew():(enablePudoShippingMethodNew(),enableCodPayment(),hideMap(),updateShippingAddressWithPudo(null))}),jQuery("body").on("click","img.updatePudo",function(){isSelectedBrtFermopointShippingMethod()&&checkPudableCartNew()}),jQuery("body").on("focusout","input#billing_city, input#billing_postcode, input#shipping_city, input#shipping_postcode",function(){isSelectedBrtFermopointShippingMethod()&&checkPudableCartNew()}),jQuery("body").on("change","select#billing_country, select#shipping_country",function(){isSelectedBrtFermopointShippingMethod()&&checkPudableCartNew()}),jQuery("body").on("focusout","input#billing_phone, input#billing_email",function(){isSelectedBrtFermopointShippingMethod()&&checkPudableCartNew()}),jQuery("body").on("change","input#ship-to-different-address-checkbox",function(){isSelectedBrtFermopointShippingMethod()&&checkPudableCartNew()});var map,markers=[],listaPudo=[];function initMap(){"yes"==ajax_object.use_google_map&&(map=new google.maps.Map(document.getElementById("wc_brt_fermopoint_shipping_methods_custom-map"),{center:{lat:44.493977,lng:11.3430258},zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1}))}function loading(e){e?jQuery("#wc_brt_fermopoint_shipping_methods_custom-list_container, #wc_brt_fermopoint_shipping_methods_custom-map_container").addClass("loading"):jQuery("#wc_brt_fermopoint_shipping_methods_custom-list_container, #wc_brt_fermopoint_shipping_methods_custom-map_container").removeClass("loading")}function disableCodPayment(){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){jQuery(".wc_payment_method.payment_method_cod")&&(jQuery(".wc_payment_method.payment_method_cod").css("opacity","0.5").find("input").attr("disabled","disabled"),isSelectedBrtFermopointShippingMethod())&&jQuery(".wc_payment_method.payment_method_cod input").prop("checked",!1)})})}function enableCodPayment(){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){jQuery(".wc_payment_method.payment_method_cod")&&jQuery(".wc_payment_method.payment_method_cod").css("opacity","1").find("input").removeAttr("disabled")})})}function disableCheckShippingAddress(){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){0<jQuery(".woocommerce-shipping-fields").length&&jQuery(".woocommerce-shipping-fields").hide().find("input[name=ship_to_different_address]").attr("disabled","disabled")})})}function enableCheckShippingAddress(){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){0<jQuery(".woocommerce-shipping-fields").length&&jQuery(".woocommerce-shipping-fields").show().find("input[name=ship_to_different_address]").removeAttr("disabled")})})}function showMapOrList(){isSelectedBrtFermopointShippingMethod()&&jQuery(document).ajaxComplete(function(){jQuery("#wc_brt_fermopoint_shipping_methods_custom-tr_container, #wc_brt_fermopoint_shipping_methods_custom-div_container").show()})}function hideMap(){jQuery(document).ajaxComplete(function(){jQuery("#wc_brt_fermopoint_shipping_methods_custom-tr_container, #wc_brt_fermopoint_shipping_methods_custom-div_container").hide()})}function isSelectedBrtFermopointShippingMethod(){return!!(0<jQuery('input[name^="shipping_method"]:checked').length&&jQuery('input[name^="shipping_method"]:checked').val().startsWith("wc_brt_fermopoint_shipping_methods_custom"))||!(1!=jQuery('input[name^="shipping_method"]').length||!jQuery('input[name^="shipping_method"]').val().startsWith("wc_brt_fermopoint_shipping_methods_custom"))}function isShippingDifferentAddressChecked(){var e=jQuery("input[name=ship_to_different_address]").prop("checked");return console.log("checkShipToDifferentAddress",e),!!e}function checkGeolocation(){("yes"==ajax_object.use_geolocation?getCoordsFromGeolocation:getPudoFromAddress)()}function getCoordsFromGeolocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{var o;"yes"==ajax_object.use_google_map&&(o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map.panTo(o)),getPudoFromCoords(e.coords)},e=>{console.log("err: "+e),getPudoFromAddress()}):(console.log("Geolocation is not supported by this browser."),getPudoFromAddress())}function getShippingAddress(){var e={};return isShippingDifferentAddressChecked()?(e.city=jQuery("form .woocommerce-shipping-fields #shipping_city").val(),e.country=jQuery("form .woocommerce-shipping-fields #shipping_country").val(),e.cap=jQuery("form .woocommerce-shipping-fields #shipping_postcode").val()):(e.city=jQuery("form .woocommerce-billing-fields #billing_city").val(),e.country=jQuery("form .woocommerce-billing-fields #billing_country").val(),e.cap=jQuery("form .woocommerce-billing-fields #billing_postcode").val()),e}function getPudoFromCoords(e){isSelectedBrtFermopointShippingMethod()?(loading(!0),jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"get_pudo_by_lat_lng",security:ajax_object.security,coords:e},success:function(e,o,t){var i;e.pudo&&0<e.pudo.length?(("yes"==ajax_object.use_google_map?addPudoToMap:(listaPudo=e.pudo,addPudoToList))(e.pudo),enablePudoShippingMethodNew(),showMapOrList()):(i="no_pudo_found",disablePudoShippingMethodNew(i=e.why_not_pudable?e.why_not_pudable:i),hideMap(),updateShippingAddressWithPudo(null)),loading(!1)},error:function(e,o,t){console.log("err"),console.log(o),console.log(t),disablePudoShippingMethodNew("generic_error"),enableCodPayment(),updateShippingAddressWithPudo(null),loading(!1)}})):(hideMap(),enableCodPayment(),updateShippingAddressWithPudo(null))}function getPudoFromAddress(){var e;isSelectedBrtFermopointShippingMethod()?(loading(!0),e=getShippingAddress(),jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"get_pudo_by_address",security:ajax_object.security,shipping_address:e},success:function(e,o,t){var i;e.pudo&&0<e.pudo.length?(("yes"==ajax_object.use_google_map?addPudoToMap:(listaPudo=e.pudo,addPudoToList))(e.pudo),enablePudoShippingMethodNew(),showMapOrList()):(i="no_pudo_found",disablePudoShippingMethodNew(i=e.why_not_pudable?e.why_not_pudable:i),hideMap(),updateShippingAddressWithPudo(null)),loading(!1)},error:function(e,o,t){console.log("err"),console.log(o),console.log(t),disablePudoShippingMethodNew("generic_error"),enableCodPayment(),updateShippingAddressWithPudo(null),loading(!1)}})):(hideMap(),enableCodPayment(),updateShippingAddressWithPudo(null))}function addPudoToMap(e){clearMarkers();for(var o=new google.maps.LatLngBounds,t=new google.maps.InfoWindow,i=0;i<e.length;i++){var n=new google.maps.Marker({position:new google.maps.LatLng(e[i].latitude,e[i].longitude),icon:ajax_object.plugin_url+"/includes/images/icon-gmap.png",map:map});const r=getInfoWindowContent(e[i]),d=e[i];google.maps.event.addListener(n,"click",function(e){t.setContent(r),t.open(map,this),updateShippingAddressWithPudo(d),jQuery("#wc_brt_fermopoint_shipping_methods_custom-tr_container h3.pudo-label, #wc_brt_fermopoint_shipping_methods_custom-div_container h3.pudo-label").text("Hai selezionato il punto di ritiro: "+d.pointName)}),o.extend(new google.maps.LatLng(e[i].latitude,e[i].longitude)),markers.push(n)}map.fitBounds(o)}function clearMarkers(){if(0<markers.length){for(var e=0;e<markers.length;e++)markers[e].setMap(null);markers=[]}}function getInfoWindowContent(e){var o,t=["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],i=(e.pudoId,e.pointName?"<p><strong class='title'>"+e.pointName+"</strong></p>":""),n=e.fullAddress?"<p class='address'>"+e.fullAddress+"</p>":"",r="",r="<ul class='orari'>";for(o in e.orariOk)r=(r=r+"<li><strong>"+t[o]+"</strong>: ")+e.orariOk[o].filter(Boolean).join(" / ")+"</li>";return"<div class='infowindow-brt-fermopoint'>"+i+n+(r+="</ul>")+"</div>"}function updateShippingAddressWithPudo(e){jQuery(document).ready(function(){jQuery("form #wc_brt_fermopoint-custom_checkout_fields")&&(null!=e?"object"==typeof e?(jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-selected_pudo").val(JSON.stringify(e)),jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-pudo_id").val(e.pudoId)):"number"==typeof e?(jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-selected_pudo").val(JSON.stringify(listaPudo[e])),jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-pudo_id").val(listaPudo[e].pudoId)):(jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-selected_pudo").val(""),jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-pudo_id").val("")):(jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-selected_pudo").val(""),jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-pudo_id").val("")))})}function addPudoToList(l){jQuery(document).ajaxComplete(function(){var e=jQuery("#wc_brt_fermopoint_shipping_methods_custom-list_container .pudo-list-scrollable"),o="",t=["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],i=jQuery("form #wc_brt_fermopoint-custom_checkout_fields #wc_brt_fermopoint-pudo_id").val();if(0<l.length){o+="<ul class='lista_pudo'>";for(var n=0;n<l.length;n++){var r,d=l[n],p=d.pudoId,c=d.pointName?"<h3>"+d.pointName+"</h3>":"",a=d.fullAddress?"<h5>"+d.fullAddress+"</h5>":"",s=d.distanceFromPoint?"<h5>"+d.distanceFromPoint/1e3+" Km</h5>":"",u="",u="<ul>";for(r in d.orariOk)u=(u=u+"<li><strong>"+t[r]+"</strong>: ")+d.orariOk[r].filter(Boolean).join(" / ")+"</li>";u+="</ul>",o=(o=(o=(o=(o=(o=(o=o+('<li class="pudo '+(i==p?"selected":"")+'" onclick="selectPudo(this, '+n+')">')+'<div class="row m-0">')+("<div class='d-none d-lg-block col-lg-1 p-0 icona'><img src='"+ajax_object.plugin_url+"/includes/images/icon-gmap.png' /></div>"))+("<div class='col-9 col-sm-10 col-md-7 titolo'>"+c+a+"</div>")+"<div class='col-3 col-sm-2 col-lg-1 p-0 info'>")+("<img width='25' height='25' src='"+ajax_object.plugin_url+"/includes/images/icon-info.png' />"))+("<div class='popup orari'>"+u+"</div>")+"</div>")+("<div class='col-12 col-md-3 distanza'>"+s+"</div>")+"</div>")+"<div class='clear'>\x3c!-- vuoto --\x3e</div>"+"</li>"}o+="</ul>"}e.html(o);e=jQuery("#wc_brt_fermopoint_shipping_methods_custom-list_container li.pudo.selected");e&&0!==e.length||updateShippingAddressWithPudo(null)})}function selectPudo(e,o){jQuery("#wc_brt_fermopoint_shipping_methods_custom-list_container .pudo-list-scrollable ul.lista_pudo li.pudo").removeClass("selected"),jQuery(e).addClass("selected"),updateShippingAddressWithPudo(o)}function getShippingData(){var e={};return e.country=jQuery("form .woocommerce-billing-fields #billing_country").val(),e.email=jQuery("form .woocommerce-billing-fields #billing_email").val(),e.phone=jQuery("form .woocommerce-billing-fields #billing_phone").val(),e}function checkPudableCartNew(){var e;isSelectedBrtFermopointShippingMethod()?(e=getShippingData(),jQuery.ajax({type:"POST",url:ajax_object.ajaxurl,data:{action:"check_pudable_cart",security:ajax_object.security,shipping_data:e},success:function(e,o,t){var i;e.pudable?(enablePudoShippingMethodNew(),disableCodPayment(),showMapOrList(),checkGeolocation()):(i="generic_error",disablePudoShippingMethodNew(i=e.why_not_pudable?e.why_not_pudable:i),hideMap(),enableCodPayment(),updateShippingAddressWithPudo(null))},error:function(e,o,t){console.log("err"),console.log(o),console.log(t),disablePudoShippingMethodNew("generic_error"),hideMap(),enableCodPayment(),updateShippingAddressWithPudo(null)}})):(hideMap(),enableCodPayment(),updateShippingAddressWithPudo(null))}function disablePudoShippingMethodNew(e){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){0<jQuery('.woocommerce-shipping-methods input[id*="wc_brt_fermopoint_shipping_methods_custom"]').length&&(0<jQuery("#wc_brt_fermopoint_shipping_methods_custom-tr_alert-"+e).length&&(jQuery(".wc_brt_tr_alert").hide(),jQuery("#wc_brt_fermopoint_shipping_methods_custom-tr_alert-"+e).show()),0<jQuery("#wc_brt_fermopoint_shipping_methods_custom-div_alert-"+e).length)&&(jQuery(".wc_brt_div_alert").hide(),jQuery("#wc_brt_fermopoint_shipping_methods_custom-div_alert-"+e).show())})})}function enablePudoShippingMethodNew(){jQuery(document).ajaxComplete(function(){jQuery(document).ready(function(){0<jQuery('.woocommerce-shipping-methods input[id*="wc_brt_fermopoint_shipping_methods_custom"]').length&&(0<jQuery(".wc_brt_tr_alert").length&&jQuery(".wc_brt_tr_alert").hide(),0<jQuery(".wc_brt_div_alert").length)&&jQuery(".wc_brt_div_alert").hide()})})}jQuery("body").on("updated_checkout",checkPudableCartNew);
//# sourceMappingURL=../maps/wc-brt-fermopoint-shipping-methods/wc_brt_fermopoint_shipping_methods_js-304.min.js.map
