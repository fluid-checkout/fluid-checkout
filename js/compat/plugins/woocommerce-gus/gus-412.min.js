function decodeHtml(e){var a=document.createElement("textarea");return a.innerHTML=e,a.value}function check_lenght(e){if(10!=(e=e.replace(/[^0-9\.]+/g,"")).length)return!1;try{return!0}catch(e){return!1}}function nip_type(){var e=jQuery('[data-gus="numer_nip"]');return 0<e.length?e.attr("id"):"wlasne"==gus_data.nip_type?gus_data.wlasny_id:gus_data.nip_type}function show_nip_alert(){alert(gus_data.wprowadz_poprawny_nip),jQuery(".open_gus").html(gus_data.pobierz_dane_nip),jQuery(".ladowanie_danych").hide()}function getgus(){var e={action:"get_gusdata",numernip:nip=jQuery("#"+nip_type()).val().replace(/[^0-9\.]+/g,""),security:gus_data.security};check_lenght(nip)?jQuery.ajax({url:gus_data.ajax_url,type:"POST",data:e}).done(function(e){if(""==e)alert("Serwer GUS nie odpowiada, prosimy spróbować ponownie później");else{e=JSON.parse(e);if("error"==e.type)alert(e.message);else try{fillFields(e),sendNipAjax(nip),jQuery(document.body).trigger("update_checkout")}catch(e){show_nip_alert()}}}):show_nip_alert()}function sendNipAjax(e){e&&jQuery.ajax({url:gus_data.ajax_url,type:"POST",data:{action:"save_nip_to_session",gus_nip_value:e},success:function(e){},error:function(e){}})}function fillFields(n){function t(e,a){e.val(a);a=new Event("input",{bubbles:!0,cancelable:!0}),e[0].dispatchEvent(a),a=new Event("change",{bubbles:!0,cancelable:!0});e[0].dispatchEvent(a),e[0].focus(),e[0].blur()}if(jQuery.each({regon:"Regon",nazwa_firmy:"Nazwa",ulica:"Ulica",miasto:"Miejscowosc",kod_pocztowy:"KodPocztowy",budynek:"NrNieruchomosci",lokal:"NrLokalu",full_ulica:null,full_numer:null},function(e,a){a&&n[a]&&(a=decodeHtml(n[a]),(e=jQuery('[data-gus="'+e+'"]')).length)&&t(e,a)}),0<jQuery('[data-gus="full_ulica"]').length){var a=decodeHtml(n.Ulica).replace("ul. ",""),u=decodeHtml(n.NrNieruchomosci);let e=decodeHtml(n.NrLokalu);e=e&&"/"+e,t(jQuery('[data-gus="full_ulica"]'),a+" "+u+e)}if(0<jQuery('[data-gus="full_numer"]').length){a=decodeHtml(n.NrNieruchomosci);let e=decodeHtml(n.NrLokalu);e=e&&"/"+e,t(jQuery('[data-gus="full_numer"]'),a+e)}}jQuery(document).ready(function(e){e(document.body).on("updated_checkout",function(){0===e(".get_gus").length&&e("#"+nip_type()).after('<div class="get_gus"><a class="open_gus" onClick="getgus();">'+gus_data.pobierz_dane_nip+'</a> </div><div id="response"></div>'),"PL"!==jQuery("#billing_country").val()&&jQuery(".get_gus").hide()})}),jQuery(document).on("change","#billing_country",function(){"PL"!==this.value?jQuery(".get_gus").hide():jQuery(".get_gus").show()});