((e,o)=>{"function"==typeof define&&define.amd?define([],o()):"object"==typeof exports?module.exports=o():e.CheckoutCoupons=o()})("undefined"!=typeof global?global:this.window||this.global,function(e){function u(e,o){o=(o=o?o.closest(m.sectionWrapperSelector):null)?o.querySelector(m.messagesWrapperSelector):document.querySelector(m.generalNoticesSelector),(o="yes"===m.useGeneralNoticesSection?document.querySelector(m.generalNoticesSelector):o)&&(o.innerHTML=e)}function l(e){(e=(e=e?e.closest(m.sectionWrapperSelector):null)?e.querySelector(m.messagesWrapperSelector):document.querySelector(m.generalNoticesSelector))&&(e.innerHTML="")}function a(){var e=document.querySelector(m.generalNoticesSelector);e&&(e.innerHTML="")}function o(){if(S&&0!==S.length)for(var e=0;e<S.length;e++){var o=S[e],t=document.querySelectorAll(m.appliedCouponCodeSelectorTemplate.replace(/###COUPON_CODE###/g,o));if(t)for(var r=0;r<t.length;r++)((t,r)=>{t.addEventListener(FCUtils.animationEndEvent,function e(o){o.animationName===m.couponAnimationName&&(-1<(o=S.indexOf(r))&&S.splice(o,1),t.classList.remove(m.couponAnimationClass),t.removeEventListener(FCUtils.animationEndEvent,e))}),t.classList.add(m.couponAnimationClass)})(t[r],o)}}function c(e){var o="";if(!(o=e&&e.hasAttribute(m.couponCodeAttribute)?e.getAttribute(m.couponCodeAttribute):o)||""==o){var t=e.closest(m.couponSectionSelector).querySelector(m.couponFieldSelector);if(!t)return;if(""===t.value.trim())return t.value="",t.focus();o=t.value}o&&""!=o&&g.addCouponCode(o,e)}function t(){if("yes"!==m.useGeneralNoticesSection){var e=document.querySelectorAll(m.errorMessagesWrapperSelector);f=[];for(var o=0;o<e.length;o++){var t=e[o],r=Array.prototype.indexOf.call(t.parentElement.children,t);f.push([r,t])}}}function r(){if("yes"!==m.useGeneralNoticesSection){var e=document.querySelector(m.messagesWrapperSelector);if(e)for(var o=0;o<f.length;o++){var t=f[o],r=t[0],t=t[1],r=e.children[r],c=t.getAttribute(m.couponCodeAttribute),c=m.errorMessagesWrapperSelector+"["+m.couponCodeAttribute+'="'+c+'"]';document.querySelector(c)||e.insertBefore(t,r)}}}function n(e){var o,t,r;e.target.closest(m.addCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(m.addCouponButtonSelector),c(o)):e.target.closest(m.removeCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(m.removeCouponButtonSelector),(t=o)&&(r="",r=t.hasAttribute(m.couponCodeAttribute)?t.getAttribute(m.couponCodeAttribute):r)&&""!=r&&g.removeCouponCode(r,t)):e.target.closest(m.errorMessageDismissButtonSelector)&&(e.preventDefault(),r=(r=e.target.closest(m.errorMessageDismissButtonSelector)).getAttribute(m.couponCodeAttribute),C(r))}function s(e){FCUtils.keyboardKeys.ENTER===e.key&&e.target.closest(m.couponFieldSelector)&&(e.preventDefault(),c(e.target.closest(m.couponFieldSelector)))}var i=jQuery,d=null!=i,p=!1,g={},m={bodyClass:"has-fc-checkout-coupons",uiProcessingClass:"processing",loadingClass:"fc-loading",sectionWrapperSelector:".fc-step__substep, .fc-sidebar .coupon-code-form, .fc-cart-coupon-code-form, .fc-discount-section",generalNoticesSelector:".woocommerce-notices-wrapper",messagesWrapperSelector:".fc-coupon-code-messages",errorMessagesWrapperSelector:".fc-coupon-code-messages .woocommerce-error",errorMessagesWrapperSingleSelector:'.fc-coupon-code-messages .woocommerce-error li[data-coupon="###COUPON_CODE###"], .fc-coupon-code-messages .is-error[data-coupon="###COUPON_CODE###"]',useGeneralNoticesSection:"no",suppressSuccessMessages:"yes",couponAddedSectionSelector:".fc-step__substep-text-content--coupon-codes",couponSectionSelector:".fc-coupon-code-section",couponFieldSelector:'input[name="coupon_code"]',addCouponButtonSelector:".fc-coupon-code__apply",removeCouponButtonSelector:".woocommerce-remove-coupon",errorMessageDismissButtonSelector:".fc-coupon-code-message-dismiss",appliedCouponCodeSelectorTemplate:".fc-coupon-codes__coupon.coupon-###COUPON_CODE###, tr.cart-discount.coupon-###COUPON_CODE###",couponCodeAttribute:"data-coupon",referenceIdAttribute:"data-reference-id",expansibleCouponSectionKeyAttribute:"data-section-key",expansibleCouponContentSelector:".fc-expansible-form-section__content",expansibleCouponToggleSelector:".fc-expansible-form-section__toggle--###SECTION_KEY###",expansibleCouponToggleButtonSelector:".expansible-section__toggle-plus--###SECTION_KEY###",section_key_placeholder:"###SECTION_KEY###",couponAnimationEndEvent:"transitionend",couponAnimationProperty:"background-color",couponAnimationClass:"background-highlight-success",couponAnimationName:"background-highlight-success"},f=[],S=[],C=function(e){e&&(e=m.errorMessagesWrapperSingleSelector.replace(/###COUPON_CODE###/g,e),(e=document.querySelector(e))&&e.parentElement.removeChild(e),e=document.querySelector(m.errorMessagesWrapperSelector))&&0===e.children.length&&e.parentElement.removeChild(e)};return g.blockUI=function(e){d&&e&&i(e).addClass(m.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},g.unblockUI=function(e){d&&i(e).removeClass(m.uiProcessingClass).unblock()},g.addCouponCode=function(c,e){if(c&&""!=c){"yes"===m.useGeneralNoticesSection&&a();var o=Math.floor(1e3*Math.random()),e=(e&&e.setAttribute(m.referenceIdAttribute,o),document.querySelector(m.couponAddedSectionSelector)),t=(e&&0<e.children.length&&g.blockUI(e),document.querySelectorAll(m.addCouponButtonSelector));if(t)for(var r=0;r<t.length;r++){var n=t[r];n.classList.add(m.loadingClass),n.setAttribute("disabled","disabled")}var s={security:m.addCouponCodeNonce,coupon_code:c,reference_id:o};i.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_add_coupon_code"),data:s,dataType:"json",success:function(e){var o,t,r;e.reference_id&&(o=document.querySelector("["+m.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(l(o),e.message&&"yes"!==m.suppressSuccessMessages&&u(e.message,o),(t=document.querySelector(m.couponFieldSelector))&&(t.value=""),-1===S.indexOf(c)&&S.push(c),window.CollapsibleBlock&&(t=o.closest(m.expansibleCouponContentSelector))&&(CollapsibleBlock.collapse(t),t=t.getAttribute(m.expansibleCouponSectionKeyAttribute),r=document.querySelector(m.expansibleCouponToggleSelector.replace(m.section_key_placeholder,t)),t=document.querySelector(m.expansibleCouponToggleButtonSelector.replace(m.section_key_placeholder,t)),r&&CollapsibleBlock.expand(r),t)&&t.focus(),i(document.body).trigger("wc_fragment_refresh"),i(document.body).trigger("applied_coupon_in_checkout",[s.coupon_code]),i(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(u(e.message,o),i(document.body).trigger("checkout_error",[e.message]),r=document.querySelector(m.couponAddedSectionSelector))&&g.unblockUI(r)},complete:function(){var e=document.querySelectorAll(m.addCouponButtonSelector);if(e)for(var o=0;o<e.length;o++){var t=e[o];t.classList.remove(m.loadingClass),t.removeAttribute("disabled")}}})}},g.removeCouponCode=function(e,o){var t,r;e&&""!=e&&("yes"===m.useGeneralNoticesSection&&a(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(m.referenceIdAttribute,t),o=document.querySelector(m.couponAddedSectionSelector),g.blockUI(o),r={security:m.removeCouponCodeNonce,coupon_code:e,reference_id:t},i.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_remove_coupon_code"),data:r,dataType:"json",success:function(e){var o;e.reference_id&&(o=document.querySelector("["+m.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(l(o),e.message&&"yes"!==m.suppressSuccessMessages&&u(e.message,o),i(document.body).trigger("wc_fragment_refresh"),i(document.body).trigger("removed_coupon_in_checkout",[r.coupon_code]),i(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(u(e.message,o),e=document.querySelector(m.couponAddedSectionSelector))&&g.unblockUI(e)}}))},g.init=function(e){p||(m=FCUtils.extendObject(m,e),window.addEventListener("click",n,!0),document.addEventListener("keydown",s,!0),d&&(i(document.body).on("wc_fragment_refresh update_checkout",t),i(document.body).on("wc_fragments_refreshed updated_checkout",r),i(document.body).on("wc_fragments_refreshed updated_checkout",o)),document.body.classList.add(m.bodyClass),p=!0)},g});