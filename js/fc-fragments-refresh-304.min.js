!function(e,t){"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.FCFragmentsRefresh=t()}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function t(e,t){for(var o=document.querySelectorAll(d.sectionSelector),r=0;r<o.length;r++){var s=o[r],n=s.querySelector(d.sectionVisibleStateFieldSelector);n&&"no"===n.value?s.setAttribute(d.sectionVisibleStateAttribute,n.value):s.removeAttribute(d.sectionVisibleStateAttribute)}}function o(e){e.target&&e.target.matches(d.loadingInputSelector)&&(e=e.target.closest(d.formRowSelector))&&e.classList.add(d.loadingClass)}function r(e){o(e),e.target.matches(d.updateFieldsSelector)&&n()}function s(e){e.defaultPrevented||FCUtils.keyboardKeys.ESC!==e.key&&FCUtils.keyboardKeys.ENTER!==e.key&&FCUtils.keyboardKeys.TAB!==e.key&&FCUtils.keyboardKeys.CAPS!==e.key&&FCUtils.keyboardKeys.SHIFT!==e.key&&FCUtils.keyboardKeys.FUNCTION!==e.key&&FCUtils.keyboardKeys.CONTROL!==e.key&&FCUtils.keyboardKeys.COMMAND_OR_WINDOWS!==e.key&&FCUtils.keyboardKeys.ALT!==e.key&&FCUtils.keyboardKeys.ARROW_LEFT!==e.key&&FCUtils.keyboardKeys.ARROW_RIGHT!==e.key&&FCUtils.keyboardKeys.ARROW_UP!==e.key&&FCUtils.keyboardKeys.ARROW_DOWN!==e.key&&(o(e),e.target.matches(d.updateFieldsSelector))&&n()}var n,a=jQuery,l=null!=a,i=!1,c={},d={bodyClass:"has-fc-fragments-refresh",dataFormSelector:"div.woocommerce form",sectionSelector:".fc-section",messagesWrapperSelector:".woocommerce-notices-wrapper",formRowSelector:".form-row",updateFieldsSelector:".update_totals_on_change input.input-text, .update_totals_on_change select",loadingInputSelector:".loading_indicator_on_change input.input-text",sectionVisibleStateFieldSelector:'.fc-section-visible-state[type="hidden"]',sectionVisibleStateAttribute:"data-section-visible",loadingClass:"fc-loading",uiProcessingClass:"processing",scrollOffsetSelector:".fc-checkout-header",scrollBehavior:"smooth",scrollOffset:0,updateFragmentsNonce:"",updateWaitTime:500},u=!1,f={};c.updateFragments=function(){u&&u.abort();var e=FCUtils.extendObject(void 0,{security:d.updateFragmentsNonce,post_data:a(d.dataFormSelector).serialize()});u=a.ajax({type:"POST",url:fcSettings.wcAjaxUrl.toString().replace("%%endpoint%%","fc_update_fragments"),data:e,success:function(e){if(e&&!0===e.reload)window.location.reload();else{var o,r,t=document.activeElement,s=document.activeElement.value;e&&e.fragments&&(a.each(e.fragments,function(e,t){document.querySelector(e);var o=!0;!(o=t&&-1!==t.toString().indexOf("fc-fragment-always-replace")?!0:o)||f&&f[e]===t||(fcSettings.debugMode&&console.log("Replacing fragment: "+e),a(e).replaceWith(t)),a(e).unblock()}),f=e.fragments),r=s,null!==(o=t)&&requestAnimationFrame(function(){var e,t;o.id?e=document.getElementById(o.id):o.getAttribute("name")?(t=o.getAttribute("name"),e=document.querySelector('[name="'+t+'"]')):o.closest(".form-row")&&(t=o.closest(".form-row")).id&&(e=document.querySelector('.form-row[id="'+t.id+'"] .select2-selection')),e&&(e.focus(),null!==r&&r!==e.value&&(e.value=r),setTimeout(function(){if(null!==e.selectionStart&&null!==e.selectionEnd)o.selectionStart&&o.selectionEnd?(e.selectionStart=o.selectionStart,e.selectionEnd=o.selectionEnd):e.selectionStart=e.selectionEnd=Number.MAX_SAFE_INTEGER||1e4;else try{e.select()}catch{}},0))});for(var n=document.querySelectorAll(d.loadingInputSelector),l=0;l<n.length;l++){var i=n[l].closest(d.formRowSelector);i&&i.classList.remove(d.loadingClass)}e=document.querySelector(d.messagesWrapperSelector);e&&0<e.children.length&&c.scrollToNotices(e),a(document.body).trigger("fc_fragments_refreshed")}}})},c.scrollToNotices=function(){var e=document.querySelector(d.messagesWrapperSelector),t=0;if(window.StickyStates){var o=document.querySelectorAll(d.scrollOffsetSelector);if(o&&0<o.length)for(var r=0;r<o.length;r++){var s=o[r];StickyStates.isStickyPosition(s)&&(t+=s.getBoundingClientRect().height)}}var n=function(e,t){for(var o=0;e&&(!t||t!=e);)o+=e.offsetTop,e=e.offsetParent;return o}(e)+-1*d.scrollOffset+-1*t;requestAnimationFrame(function(){window.scrollTo({top:n,behavior:d.scrollBehavior})})},c.blockUI=function(e){a(e).addClass(d.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},c.unblockUI=function(e){a(e).removeClass(d.uiProcessingClass).unblock()};return c.init=function(e){i||(d=FCUtils.extendObject(d,e),n=FCUtils.debounce(c.updateFragments,d.updateWaitTime),l&&(a(document.body).on("fc_fragment_refresh",n),a(document.body).on("fc_fragments_refreshed",t)),window.addEventListener("change",r),document.addEventListener("keydown",s,!0),document.body.classList.add(d.bodyClass),i=!0)},c});
//# sourceMappingURL=maps/fc-fragments-refresh-304.min.js.map
