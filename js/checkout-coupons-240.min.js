!function(e,o){"function"==typeof define&&define.amd?define([],o()):"object"==typeof exports?module.exports=o():e.CheckoutCoupons=o()}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function n(e,o){(o=(o=o?o.closest(d.sectionWrapperSelector):null)?o.querySelector(d.messagesWrapperSelector):document.querySelector(d.generalNoticesSelector))&&(o.innerHTML=e)}function u(){var e=document.querySelector(d.generalNoticesSelector);e&&(e.innerHTML=""),(e=document.querySelector(d.messagesWrapperSelector))&&(e.innerHTML="")}function c(e){var o="";if(!(o=e&&e.hasAttribute(d.couponCodeAttribute)?e.getAttribute(d.couponCodeAttribute):o)||""==o){var t=e.closest(".fc-coupon-code-section").querySelector(d.couponFieldSelector);if(!t)return;if(""===t.value.trim())return t.value="",t.focus();o=t.value}o&&""!=o&&l.addCouponCode(o,e)}function o(e){var o,t;e.target.closest(d.addCouponButtonSelector)?(e.preventDefault(),o=e.target.closest(d.addCouponButtonSelector),c(o)):e.target.closest(d.removeCouponButtonSelector)&&(e.preventDefault(),(e=o=e.target.closest(d.removeCouponButtonSelector))&&(t="",(t=e.hasAttribute(d.couponCodeAttribute)?e.getAttribute(d.couponCodeAttribute):t)&&""!=t&&l.removeCouponCode(t,e)))}function t(e){FCUtils.keyboardKeys.ENTER===e.key&&e.target.closest(d.couponFieldSelector)&&(e.preventDefault(),c(e.target.closest(d.couponFieldSelector)))}var s=jQuery,r=!1,l={},d={bodyClass:"has-fc-checkout-coupons",uiProcessingClass:"processing",sectionWrapperSelector:".fc-step__substep",generalNoticesSelector:".woocommerce-notices-wrapper",messagesWrapperSelector:".fc-coupon-code-messages",suppressSuccessMessages:"no",couponAddedSectionSelector:".fc-step__substep-text-content--coupon-codes",couponFieldSelector:'input[name="coupon_code"]',addCouponButtonSelector:".fc-coupon-code__apply",removeCouponButtonSelector:".woocommerce-remove-coupon",couponCodeAttribute:"data-coupon",referenceIdAttribute:"data-reference-id",expansibleCouponSectionKeyAttribute:"data-section-key",expansibleCouponContentSelector:".fc-expansible-form-section__content",expansibleCouponToggleSelector:".fc-expansible-form-section__toggle--###SECTION_KEY###",expansibleCouponToggleButtonSelector:".expansible-section__toggle-plus--###SECTION_KEY###",section_key_placeholder:"###SECTION_KEY###"};return l.blockUI=function(e){e&&s(e).addClass(d.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},l.unblockUI=function(e){s(e).removeClass(d.uiProcessingClass).unblock()},l.addCouponCode=function(e,o){var t,r;e&&""!=e&&(u(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(d.referenceIdAttribute,t),o=document.querySelector(d.couponAddedSectionSelector),l.blockUI(o),r={security:d.addCouponCodeNonce,coupon_code:e,reference_id:t},s.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_add_coupon_code"),data:r,dataType:"json",success:function(e){var o,t,c;e.reference_id&&(o=document.querySelector("["+d.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==d.suppressSuccessMessages&&n(e.message,o),(t=document.querySelector(d.couponFieldSelector))&&(t.value=""),window.CollapsibleBlock&&(t=o.closest(d.expansibleCouponContentSelector))&&(CollapsibleBlock.collapse(t),t=t.getAttribute(d.expansibleCouponSectionKeyAttribute),c=document.querySelector(d.expansibleCouponToggleSelector.replace(d.section_key_placeholder,t)),t=document.querySelector(d.expansibleCouponToggleButtonSelector.replace(d.section_key_placeholder,t)),c&&CollapsibleBlock.expand(c),t&&t.focus()),s(document.body).trigger("wc_fragment_refresh"),s(document.body).trigger("applied_coupon_in_checkout",[r.coupon_code]),s(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(n(e.message,o),(c=document.querySelector(d.couponAddedSectionSelector))&&l.unblockUI(c))}}))},l.removeCouponCode=function(e,o){var t,c;e&&""!=e&&(u(),t=Math.floor(1e3*Math.random()),o&&o.setAttribute(d.referenceIdAttribute,t),o=document.querySelector(d.couponAddedSectionSelector),l.blockUI(o),c={security:d.removeCouponCodeNonce,coupon_code:e,reference_id:t},s.ajax({type:"POST",url:fcSettings.wcAjaxUrl.replace("%%endpoint%%","fc_remove_coupon_code"),data:c,dataType:"json",success:function(e){var o;e.reference_id&&(o=document.querySelector("["+d.referenceIdAttribute+'="'+e.reference_id+'"]')),e.result&&"success"===e.result?(e.message&&"yes"!==d.suppressSuccessMessages&&n(e.message,o),s(document.body).trigger("wc_fragment_refresh"),s(document.body).trigger("removed_coupon_in_checkout",[c.coupon_code]),s(document.body).trigger("update_checkout",{update_shipping_method:!1})):e.result&&"error"===e.result&&(n(e.message,o),(e=document.querySelector(d.couponAddedSectionSelector))&&l.unblockUI(e))}}))},l.init=function(e){r||(d=FCUtils.extendObject(d,e),window.addEventListener("click",o),document.addEventListener("keydown",t,!0),document.body.classList.add(d.bodyClass),r=!0)},l});
//# sourceMappingURL=maps/checkout-coupons-240.min.js.map
