!function(e,t){"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.FCEnhancedSelect=t()}("undefined"!=typeof global?global:this.window||this.global,function(e){function t(){return s(this).each(function(e,t){d.enhanceFields(t)}),this}function r(e){if(e&&e.options){for(var t,n=[],l=e.options,o=0;o<l.length;o++)(t=l[o]).selected&&n.push(t.value||t.text);return n=1===n.length?n[0]:n}}function a(){this.focus_node.setAttribute("autocomplete","off-"+Date.now())}function u(){var e;FCUtils.isCurrentBreakpointOrSmaller("phablet")&&(e=this.focus_node.closest(f.formRowSelector))&&FCUtils.scrollToElement(e,null,30)}function n(e){e.target.closest(f.inputFieldSelector)&&(e=e.target.closest(f.wrapperElementSelector).parentNode.querySelector("select"),p(e))}function l(e){e.target.closest(f.inputFieldSelector)&&(e=e.target.closest(f.wrapperElementSelector).parentNode.querySelector("select"),m(e))}function o(e){e.target.closest(f.wrapperElementSelector)&&(e=e.target.closest(f.wrapperElementSelector).parentNode.querySelector("select")).tomselect&&d.syncField(e)}function c(e){var t,n;e.target.closest(f.wrapperElementSelector)&&(e=e.target.closest(f.wrapperElementSelector).parentNode.querySelector("select"),t=e)&&t.tomselect&&(n=t.tomselect.isOpen,requestAnimationFrame(function(){(n?m:p)(t)}))}var s=jQuery,i=!1,d={},f={bodyClass:"has-fc-enhanced-select",formRowSelector:".form-row.fc-select2-field",selectFieldSelector:".fc-select2-field select",wrapperElementSelector:".ts-wrapper",inputFieldSelector:".ts-control > input",fieldSettings:{maxOptions:999999,create:!1,diacritics:!0,openOnFocus:!1},fieldPluginsSingle:[],fieldPluginsMulti:["remove_button"]},p=(null!=s&&(s.fn.select2=t,s.fn.selectWoo=t),d.syncSelectedValue=function(e){var t;e&&e.tomselect&&(t=r(e),e.tomselect.setValue(t,!0))},d.syncDisabledState=function(e){e&&e.tomselect&&e.tomselect.setDisabled(e.disabled)},d.syncOptions=function(e){e&&e.tomselect&&e.tomselect.sync()},d.syncField=function(e){e&&e.tomselect&&(d.syncSelectedValue(e),d.syncDisabledState(e),d.syncOptions(e))},function(e){e&&e.tomselect&&!(e=e.tomselect).isOpen&&e.open()}),m=function(e){e&&e.tomselect&&(e=e.tomselect).isOpen&&e.close()};d.enhanceFields=function(e,t){if(void 0!==window.TomSelect&&("string"==typeof(e=null==e?f.selectFieldSelector:e)||"object"==typeof e&&e.matches("select"))){null==t&&(t=f.fieldSettings);var n=[e];if("string"==typeof e)try{n=document.querySelectorAll(e)}catch(e){return void console.warn("Enhanced select: "+e.message)}for(var l=0;l<n.length;l++){var o=n[l],c=r(o),s=o.hasAttribute("multiple"),i=o.tomselect;i?d.syncField(o):(t.plugins=s?f.fieldPluginsMulti:f.fieldPluginsSingle,(i=new TomSelect(o,t)).setValue(c,!0),i.on("focus",a),i.on("blur",a),i.on("dropdown_open",u))}}},d.enhanceField=function(e,t){d.enhanceFields(e,t)};return d.init=function(e){i||(f=FCUtils.extendObject(f,e),document.addEventListener("click",c,!0),document.addEventListener("change",o,!0),document.addEventListener("focus",n,!0),document.addEventListener("blur",l,!0),d.enhanceFields(),document.body.classList.add(f.bodyClass),i=!0)},d});