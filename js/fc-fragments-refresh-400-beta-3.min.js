((e,t)=>{"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.FCFragmentsRefresh=t()})("undefined"!=typeof global?global:this.window||this.global,function(e){function t(e,t){for(var o=document.querySelectorAll(f.sectionSelector),n=0;n<o.length;n++){var s=o[n],l=s.querySelector(f.sectionVisibleStateFieldSelector);l&&"no"===l.value?s.setAttribute(f.sectionVisibleStateAttribute,l.value):s.removeAttribute(f.sectionVisibleStateAttribute)}}function o(){window.FCEnhancedSelect&&FCEnhancedSelect.enhanceFields()}function n(){window.CollapsibleBlock&&requestAnimationFrame(function(){for(var e=document.activeElement,t=document.querySelectorAll("[data-collapsible]"),o=0;o<t.length;o++){var n=t[o];CollapsibleBlock.getInstance(n)||CollapsibleBlock.initializeElement(n),n.contains(e)&&(CollapsibleBlock.expand(n,!1,!0),!1!==(n=!!(n=e.closest(".fc-expansible-form-section"))&&n.querySelector(".fc-expansible-form-section__toggle")))&&CollapsibleBlock.collapse(n,!1)}})}function s(e){e.target&&e.target.matches(f.loadingInputSelector)&&(e=e.target.closest(f.formRowSelector))&&e.classList.add(f.loadingClass)}function l(e){s(e),e.target.matches(f.updateFieldsSelector)&&r()}function a(e){e.defaultPrevented||FCUtils.keyboardKeys.ESC!==e.key&&FCUtils.keyboardKeys.ENTER!==e.key&&FCUtils.keyboardKeys.TAB!==e.key&&FCUtils.keyboardKeys.CAPS!==e.key&&FCUtils.keyboardKeys.SHIFT!==e.key&&FCUtils.keyboardKeys.FUNCTION!==e.key&&FCUtils.keyboardKeys.CONTROL!==e.key&&FCUtils.keyboardKeys.COMMAND_OR_WINDOWS!==e.key&&FCUtils.keyboardKeys.ALT!==e.key&&FCUtils.keyboardKeys.ARROW_LEFT!==e.key&&FCUtils.keyboardKeys.ARROW_RIGHT!==e.key&&FCUtils.keyboardKeys.ARROW_UP!==e.key&&FCUtils.keyboardKeys.ARROW_DOWN!==e.key&&(s(e),e.target.matches(f.updateFieldsSelector))&&r()}var r,i=jQuery,c=null!=i,d=!1,u={},f={bodyClass:"has-fc-fragments-refresh",dataFormSelector:"div.woocommerce form",sectionSelector:".fc-section",messagesWrapperSelector:".woocommerce-notices-wrapper",formRowSelector:".form-row",updateFieldsSelector:".update_totals_on_change input.input-text, .update_totals_on_change select",loadingInputSelector:".loading_indicator_on_change input.input-text",sectionVisibleStateFieldSelector:'.fc-section-visible-state[type="hidden"]',sectionVisibleStateAttribute:"data-section-visible",loadingClass:"fc-loading",uiProcessingClass:"processing",updateFragmentsNonce:"",updateWaitTime:500},y=!1,m={};u.updateFragments=function(){y&&y.abort();var e=FCUtils.extendObject(void 0,{security:f.updateFragmentsNonce,post_data:i(f.dataFormSelector).serialize()});y=i.ajax({type:"POST",url:fcSettings.wcAjaxUrl.toString().replace("%%endpoint%%","fc_update_fragments"),data:e,success:function(e){if(e&&!0===e.reload)window.location.reload();else{FCUtils.setCurrentFocusedElementGlobalVariables(),e&&e.fragments&&(i.each(e.fragments,function(e,t){document.querySelector(e);var o=!0;!(o=t&&-1!==t.toString().indexOf("fc-fragment-always-replace")?!0:o)||m&&m[e]===t||("yes"===fcSettings.debugMode&&console.log("Replacing fragment: "+e),i(e).replaceWith(t)),i(e).unblock()}),m=e.fragments),FCUtils.maybeRefocusElement(window.fcCurrentFocusedElement,window.fcCurrentFocusedElementValue);for(var t=document.querySelectorAll(f.loadingInputSelector),o=0;o<t.length;o++){var n=t[o].closest(f.formRowSelector);n&&n.classList.remove(f.loadingClass)}e=document.querySelector(f.messagesWrapperSelector);e&&0<e.children.length&&window.FCUtils&&"function"==typeof FCUtils.scrollToElement&&FCUtils.scrollToElement(e),i(document.body).trigger("fc_fragments_refreshed")}}})},u.blockUI=function(e){i(e).addClass(f.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},u.unblockUI=function(e){i(e).removeClass(f.uiProcessingClass).unblock()};return u.init=function(e){d||(f=FCUtils.extendObject(f,e),r=FCUtils.debounce(u.updateFragments,f.updateWaitTime),c&&(i(document.body).on("fc_fragments_refresh",r),i(document.body).on("fc_fragments_refreshed",n),i(document.body).on("fc_fragments_refreshed",t),i(document.body).on("fc_fragments_refreshed",o)),window.addEventListener("change",l),document.addEventListener("keydown",a,!0),document.body.classList.add(f.bodyClass),d=!0)},u});