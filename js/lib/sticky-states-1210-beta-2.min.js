!function(t,e){"function"==typeof define&&define.amd?define([],e()):"object"==typeof exports?module.exports=e():t.StickyStates=e()}("undefined"!=typeof global?global:this.window||this.global,function(t){"use strict";function c(t,e){for(var i=0;t&&(!e||e!=t);)i+=t.offsetTop,t=t.offsetParent;return i}var l,a=!1,m={managers:[]},g={},y={elementSelector:"[data-sticky-states]",innerElementSelector:"[data-sticky-states-inner]",isEndPositionClass:"is-end-position",isStickyClass:"is-sticky",isStickyTopClass:"is-sticky--top",isStickyBottomClass:"is-sticky--bottom",isActivatedClass:"is-activated",positionAttribute:"data-sticky-position",thresholdAttribute:"data-sticky-threshold",stickyRelativeToAttribute:"data-sticky-relative-to",staticAtEndAttribute:"data-sticky-static-at-end",containerAttribute:"data-sticky-container",position:"top",threshold:0},d=function(){var i={},n=!1,t=0;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],t++);for(;t<arguments.length;t++)!function(t){for(var e in t)t.hasOwnProperty(e)&&(n&&"[object Object]"===Object.prototype.toString.call(t[e])?i[e]=d(i[e],t[e]):i[e]=t[e])}(arguments[t]);return i};m.isStickyPosition=function(t){if(t.matches("."+g.isStickyClass))return!0;t=window.getComputedStyle(t).position;return"fixed"==t||"sticky"==t};function h(){for(var t=0;t<m.managers.length;t++){var e=m.managers[t];e&&m.resetStickyLimits(e)}}var n,s,o,r,u,e=(n=function(){for(var t,e=window.pageYOffset||document.body.scrollTop,i=0;i<m.managers.length;i++){var n,s=m.managers[i],o=e>=s.settings.threshold,r=0,l=e>=s.settings.endThreshold,a=s.stickyElement.hasAttribute(s.settings.staticAtEndAttribute);s.relativeElement&&!!((t=s.relativeElement).offsetWidth||t.offsetHeight||t.getClientRects().length)&&m.isStickyPosition(s.relativeElement)&&(r=s.relativeElement.getBoundingClientRect().height,o=e>=s.settings.threshold-r,l=e>=s.settings.endThreshold-r),o&&!l?(o=window.getComputedStyle(s.innerElement).width,n=window.getComputedStyle(s.stickyElement).height,s.innerElement.style.top=0<r?r+"px":"",s.innerElement.style.width=o,s.stickyElement.style.height=n,s.stickyElement.style.position="",s.stickyElement.classList.add(s.settings.isStickyClass,"top"==s.settings.position?s.settings.isStickyTopClass:s.settings.isStickyBottomClass),s.stickyElement.classList.remove(s.settings.isEndPositionClass)):l&&!a?(n=parseInt(window.getComputedStyle(s.containerElement).height.replace("px")),l=parseInt(window.getComputedStyle(s.stickyElement).height.replace("px")),a=c(s.stickyElement)-c(s.containerElement),s.innerElement.style.top=n-l-a+"px",s.stickyElement.classList.remove(s.settings.isStickyClass,s.settings.isStickyTopClass,s.settings.isStickyBottomClass),s.stickyElement.classList.add(s.settings.isEndPositionClass)):(s.stickyElement.classList.remove(s.settings.isStickyClass,s.settings.isStickyTopClass,s.settings.isStickyBottomClass,s.settings.isEndPositionClass),s.stickyElement.style.height="",s.innerElement.style.width="",s.innerElement.style.top="")}},s=(s=50)||250,function(){var t=o||this,e=+new Date,i=arguments;r&&e<r+s?(clearTimeout(u),u=setTimeout(function(){r=e,n.apply(t,i)},s)):(r=e,n.apply(t,i))}),p=function(){e(),window.requestAnimationFrame(p)};return m.resetStickyLimits=function(t){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=t.stickyElement.getAttribute(t.settings.thresholdAttribute),n=t.stickyElement.getBoundingClientRect(),s=c(t.stickyElement);t.settings.threshold=isNaN(parseInt(i))?s:parseInt(i),"bottom"==t.settings.position&&(t.settings.threshold=Math.max(t.settings.threshold-e+n.height,0));var o=t.stickyElement.getAttribute(t.settings.stickyRelativeToAttribute);null!=o&&""!=o&&(t.relativeElement=document.querySelector(o)),t.containerElement=t.stickyElement.parentNode;s=t.stickyElement.getAttribute(t.settings.containerAttribute);null!=s&&""!=s&&(t.containerElement=t.stickyElement.closest(s),t.containerElement||(t.containerElement=document.querySelector(s))),t.containerElement&&(i=parseInt(window.getComputedStyle(t.containerElement).height.replace("px")),o=parseInt(window.getComputedStyle(t.stickyElement).height.replace("px")),s=c(t.stickyElement)-c(t.containerElement),t.settings.endThreshold=t.settings.threshold+i-o-s,"bottom"!=t.settings.position||(n=c(t.stickyElement)-e+n.height)>t.settings.threshold&&(t.settings.endThreshold=n))},m.getInstance=function(t){for(var e,i=0;i<m.managers.length;i++){var n=m.managers[i];if(n.stickyElement==t){e=n;break}}return e=(e=e||m.getInstanceFromInner(t))||m.getInstanceFromContainer(t)},m.getInstanceFromContainer=function(t){for(var e,i=0;i<m.managers.length;i++){var n=m.managers[i];if(n.containerElement==t){e=n;break}}return e},m.getInstanceFromInner=function(t){for(var e,i=0;i<m.managers.length;i++){var n=m.managers[i];if(n.innerElement==t){e=n;break}}return e},m.initializeElement=function(t){var e={};e.settings=d(g),e.stickyElement=t,e.innerElement=e.stickyElement.querySelector(e.settings.innerElementSelector);t=e.stickyElement.getAttribute(e.settings.positionAttribute);e.settings.position="top"==t||"bottom"==t?t:g.position,m.resetStickyLimits(e),l&&(l.observe(e.containerElement),l.observe(e.stickyElement),l.observe(e.innerElement)),e.isActivated=!0,e.stickyElement.classList.add(e.settings.isActivatedClass),m.managers.push(e)},m.init=function(t){if(!a){var n,s,o,r;g=d(y,t),window.ResizeObserver&&(l=new ResizeObserver((n=h,s=50,function(){var t=this,e=arguments,i=o&&!r;clearTimeout(r),r=setTimeout(function(){r=null,o||n.apply(t,e)},s),i&&n.apply(t,e)})));for(var e=document.querySelectorAll(g.elementSelector),i=0;i<e.length;i++)m.initializeElement(e[i]);requestAnimationFrame(p),a=!0}},m});