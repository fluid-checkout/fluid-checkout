!function(e,t){"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.FCFragmentsRefresh=t()}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function t(e,t){for(var o=document.querySelectorAll(d.sectionSelector),n=0;n<o.length;n++){var r=o[n],c=r.querySelector(d.sectionVisibleStateFieldSelector);c&&"no"===c.value?r.setAttribute(d.sectionVisibleStateAttribute,c.value):r.removeAttribute(d.sectionVisibleStateAttribute)}}function o(e){e.target&&e.target.matches(d.loadingInputSelector)&&(e=e.target.closest(d.formRowSelector))&&e.classList.add(d.loadingClass)}function n(e){o(e),e.target.matches(d.updateFieldsSelector)&&c()}function r(e){e.defaultPrevented||(o(e),e.target.matches(d.updateFieldsSelector)&&c())}var c,i=jQuery,l=null!=i,s=!1,a={},d={bodyClass:"has-fc-fragments-refresh",dataFormSelector:"div.woocommerce form",sectionSelector:".fc-section",messagesWrapperSelector:".woocommerce-notices-wrapper",formRowSelector:".form-row",updateFieldsSelector:".update_totals_on_change input.input-text, .update_totals_on_change select",loadingInputSelector:".loading_indicator_on_change input.input-text",sectionVisibleStateFieldSelector:'.fc-section-visible-state[type="hidden"]',sectionVisibleStateAttribute:"data-section-visible",loadingClass:"fc-loading",uiProcessingClass:"processing",scrollOffsetSelector:".fc-checkout-header",scrollBehavior:"smooth",scrollOffset:0,updateFragmentsNonce:"",updateWaitTime:500},u=!1,f={};a.updateFragments=function(){u&&u.abort();var e=FCUtils.extendObject(void 0,{security:d.updateFragmentsNonce,post_data:i(d.dataFormSelector).serialize()});u=i.ajax({type:"POST",url:fcSettings.wcAjaxUrl.toString().replace("%%endpoint%%","fc_update_fragments"),data:e,success:function(e){if(e&&!0===e.reload)window.location.reload();else{var o,n,t=document.activeElement,r=document.activeElement.value;e&&e.fragments&&(i.each(e.fragments,function(e,t){document.querySelector(e);var o=!0;!(o=t&&-1!==t.toString().indexOf("fc-fragment-always-replace")?!0:o)||f&&f[e]===t||(fcSettings.debugMode&&console.log("Replacing fragment: "+e),i(e).replaceWith(t)),i(e).unblock()}),f=e.fragments),n=r,null!==(o=t)&&requestAnimationFrame(function(){var e,t;o.id?e=document.getElementById(o.id):o.getAttribute("name")?(t=o.getAttribute("name"),e=document.querySelector('[name="'+t+'"]')):o.closest(".form-row")&&(t=o.closest(".form-row")).id&&(e=document.querySelector('.form-row[id="'+t.id+'"] .select2-selection')),e&&(e.focus(),null!==n&&n!==e.value&&(e.value=n),setTimeout(function(){if(null!==e.selectionStart&&null!==e.selectionEnd)o.selectionStart&&o.selectionEnd?(e.selectionStart=o.selectionStart,e.selectionEnd=o.selectionEnd):e.selectionStart=e.selectionEnd=Number.MAX_SAFE_INTEGER||1e4;else try{e.select()}catch{}},0))});for(var c=document.querySelectorAll(d.loadingInputSelector),l=0;l<c.length;l++){var s=c[l].closest(d.formRowSelector);s&&s.classList.remove(d.loadingClass)}e=document.querySelector(d.messagesWrapperSelector);e&&0<e.children.length&&a.scrollToNotices(e),i(document.body).trigger("fc_fragments_refreshed")}}})},a.scrollToNotices=function(){var e=document.querySelector(d.messagesWrapperSelector),t=0;if(window.StickyStates){var o=document.querySelectorAll(d.scrollOffsetSelector);if(o&&0<o.length)for(var n=0;n<o.length;n++){var r=o[n];StickyStates.isStickyPosition(r)&&(t+=r.getBoundingClientRect().height)}}var c=function(e,t){for(var o=0;e&&(!t||t!=e);)o+=e.offsetTop,e=e.offsetParent;return o}(e)+-1*d.scrollOffset+-1*t;requestAnimationFrame(function(){window.scrollTo({top:c,behavior:d.scrollBehavior})})},a.blockUI=function(e){i(e).addClass(d.uiProcessingClass).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},a.unblockUI=function(e){i(e).removeClass(d.uiProcessingClass).unblock()};return a.init=function(e){s||(d=FCUtils.extendObject(d,e),c=FCUtils.debounce(a.updateFragments,d.updateWaitTime),l&&(i(document.body).on("fc_fragment_refresh",c),i(document.body).on("fc_fragments_refreshed",t)),window.addEventListener("change",n),document.addEventListener("keydown",r,!0),document.body.classList.add(d.bodyClass),s=!0)},a});
//# sourceMappingURL=maps/fc-fragments-refresh-304-beta-9.min.js.map
