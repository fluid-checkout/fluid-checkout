((e,t)=>{"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.CheckoutSteps=t()})("undefined"!=typeof global?global:this.window||this.global,function(e){function d(e,t,r){var o,s;e&&(o=e.querySelector(b.substepFieldsSelector),s=e.querySelector(b.substepTextSelector),CollapsibleBlock.expand(o,t,r),CollapsibleBlock.collapse(s,t),e.classList.add(b.isEditingClass))}function r(e,t){if(t&&t.fragments)for(var r in t.fragments){r=document.querySelector(r);r&&r.classList.remove(b.isLoadingClass)}}function o(e,t){if("yes"===b.maybeDisablePlaceOrderButton&&"yes"===b.isMultistepLayout){for(var r=y(),o=0;o<r.length;o++){var s=r[o].getAttribute(b.stepIdAttribute),l=b.currentStepClassTemplate.replace("##STEP_ID##",s);document.body.classList.remove(l)}var a=document.querySelector(b.currentStepSelector),c=document.querySelector(b.lastStepSelector);a&&(s=a.getAttribute(b.stepIdAttribute),l=b.currentStepClassTemplate.replace("##STEP_ID##",s),document.body.classList.add(l),c)&&(a=a.getAttribute(b.stepIdAttribute),c.getAttribute(b.stepIdAttribute)===a)&&document.body.classList.add(b.currentLastStepClass)}if("yes"===b.maybeDisablePlaceOrderButton&&"yes"===b.isMultistepLayout){c=document.querySelector(b.currentStepSelector),a=document.querySelector(b.lastStepSelector);if(c&&a)for(var i=c.getAttribute(b.stepIdAttribute)!==a.getAttribute(b.stepIdAttribute),n=document.querySelectorAll(b.placeOrderButtonSelector),u=0;u<n.length;u++)n[u].disabled=i}}function s(e,t){for(var r=document.querySelectorAll(b.substepSelector),o=0;o<r.length;o++){var s,l=r[o],a=l.querySelector(b.substepEditableStateFieldSelector),a=(a&&("no"===a.value?l.setAttribute(b.substepEditableStateAttribute,a.value):l.removeAttribute(b.substepEditableStateAttribute),a.parentNode.removeChild(a)),l.querySelector(b.substepExpandedStateFieldSelector)),a=(a&&((s=a&&"yes"===a.value)&&d(l,!0,!1),a.parentNode.removeChild(a)),l.querySelector(b.substepVisibleStateFieldSelector));a&&(l.setAttribute(b.substepVisibleStateAttribute,a.value),"no"!==a.value||s||null===l.closest(b.stepCompleteSelector)||f(l,!0,!1),a.parentNode.removeChild(a))}}function l(){var e,t,r,o;document.body.matches(b.placeOrderSkipMoveSelector)||(e=window.innerWidth,t=document.querySelector(b.placeOrderSectionMainSelector),r=document.querySelector(b.placeOrderPlaceholderMainSelector),o=document.querySelector(b.placeOrderPlaceholderSidebarSelector),t&&r&&o&&(e<1e3&&o.parentNode!==t.parentNode?o.parentNode.insertBefore(t,o.nextSibling):1e3<=e&&r.parentNode!==t.parentNode&&r.parentNode.insertBefore(t,r.nextSibling)))}function a(){var e,t,r,o;document.body.matches(b.orderSummaryTableSkipMoveSelector)||(e=window.innerWidth,t=document.querySelector(b.orderSummaryTableSelector),r=document.querySelector(b.orderSummaryTablePlaceholderMainSelector),o=document.querySelector(b.orderSummaryTablePlaceholderExtraSelector),t&&r&&o&&(e<1e3&&o.parentNode!==t.parentNode?o.parentNode.insertBefore(t,o.nextSibling):1e3<=e&&r.parentNode!==t.parentNode&&r.parentNode.insertBefore(t,r.nextSibling)))}function c(e){if(e.target.closest(b.nextStepButtonSelector)){e.preventDefault();var t=e.target.closest(b.stepSelector);if(t)if(window.CheckoutValidation&&!CheckoutValidation.validateAllFields(t))(a=t.querySelector(b.invalidFieldRowSelector))&&a.focus();else{t.setAttribute(b.stepCompleteAttribute,"");for(var r=t.querySelectorAll(b.substepSelector),o=0;o<r.length;o++){var s=r[o],l=s.querySelector(b.substepTextContentSelector);l&&(l.classList.add(b.isLoadingClass),h(l)),f(s)}for(var a=t.parentElement.querySelector(b.nextStepSelector),c=(a.setAttribute(b.stepCurrentAttribute,""),t.removeAttribute(b.stepCurrentAttribute),y()),i=c.indexOf(t),o=0;o<c.length;o++)o<i&&c[o].classList.remove(b.stepNextIncompleteClass);C(),v(a),m(t),S&&p(document.body).trigger("update_checkout")}}else{var n;e.target.closest(b.substepEditButtonSelector)?(e.preventDefault(),n=e.target.closest(b.substepSelector),d(n)):e.target.closest(b.substepSaveButtonSelector)&&(e.preventDefault(),n=e.target.closest(b.substepSelector),a=n)&&(window.CheckoutValidation&&!CheckoutValidation.validateAllFields(a)?(u=a.querySelector(b.invalidFieldRowSelector))&&u.focus():(f(a),S&&(u=a.querySelector(b.substepTextContentSelector),h(u),p(".woocommerce-error, .woocommerce-message").remove(),p(document.body).trigger("update_checkout"))))}var u}function i(e){var t;e.defaultPrevented||(FCUtils.keyboardKeys.ENTER!==e.key&&FCUtils.keyboardKeys.SPACE!==e.key||!e.target.closest(b.substepEditButtonSelector)&&!e.target.closest(b.substepSaveButtonSelector)?FCUtils.keyboardKeys.ENTER===e.key&&e.target.closest(b.checkoutFormSelector)&&e.target.closest(b.fieldSubmitFormSelector)&&(e.preventDefault(),window.CheckoutValidation)&&(t=e.target.closest(b.fieldSubmitFormSelector),CheckoutValidation.validateField(t,"step-validation")):c(e))}var p=jQuery,S=null!=p,n=!1,t={},b={bodyClass:"has-fc-checkout-steps",bodyClassActiveStepPattern:"fc-checkout-step--active-{ID}",isMultistepLayout:"yes",maybeDisablePlaceOrderButton:"yes",wrapperSelector:".fc-wrapper",progressBarSelector:".fc-progress-bar",progressBarCurrentSelector:".fc-progress-bar__current-step",progressBarItemSelector:".fc-progress-bar__step",stepsWrapperSelector:".fc-checkout-steps",stepSelector:".fc-checkout-step",currentStepSelector:"[data-step-current]",lastStepSelector:"[data-step-last]",nextStepSelector:"[data-step-current] ~ .fc-checkout-step",nextStepButtonSelector:"[data-step-next]",checkoutFormSelector:"form.checkout",fieldSubmitFormSelector:'input[type="text"], input[type="checkbox"], input[type="color"], input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="email"], input[type="file"], input[type="image"], input[type="month"], input[type="number"], input[type="password"], input[type="radio"], input[type="search"], input[type="tel"], input[type="time"], input[type="url"], input[type="week"]',substepSelector:".fc-step__substep",substepTextContentSelector:".fc-step__substep-text-content",substepFieldsSelector:".fc-step__substep-fields",substepTextSelector:".fc-step__substep-text",substepEditButtonSelector:"[data-step-edit]",substepSaveButtonSelector:"[data-step-save]",stepCompleteSelector:"[data-step-complete]",stepCompleteAttribute:"data-step-complete",stepCurrentAttribute:"data-step-current",stepIndexAttribute:"data-step-index",stepIdAttribute:"data-step-id",isEditingClass:"is-editing",isLoadingClass:"is-loading",isCurrentClass:"is-current",isCompleteClass:"is-complete",stepNextIncompleteClass:"fc-checkout-step--next-step-incomplete",currentStepClassTemplate:"fc-checkout-step-current--##STEP_ID##",currentLastStepClass:"fc-checkout-step-current-last",substepEditableStateFieldSelector:'.fc-substep-editable-state[type="hidden"]',substepEditableStateAttribute:"data-substep-editable",substepVisibleStateFieldSelector:'.fc-substep-visible-state[type="hidden"]',substepVisibleStateAttribute:"data-substep-visible",substepExpandedStateFieldSelector:'.fc-substep-expanded-state[type="hidden"]',invalidFieldRowSelector:".woocommerce-invalid .input-text, .woocommerce-invalid select",enablePlaceOrderMove:"yes",placeOrderButtonSelector:".fc-place-order-button",placeOrderSkipMoveSelector:".has-place-order--below_order_summary",placeOrderSectionMainSelector:".fc-place-order__section--main",placeOrderPlaceholderMainSelector:".fc-inside .fc-place-order__section-placeholder",placeOrderPlaceholderSidebarSelector:".fc-sidebar .fc-place-order__section-placeholder",placeOrderRefreshRate:50,enableOrderSummaryTableMove:"yes",orderSummaryTableSelector:"#order_review",orderSummaryTableSkipMoveSelector:".has-order-summary-position--site_header",orderSummaryTablePlaceholderMainSelector:".fc-order-review-table__placeholder--main",orderSummaryTablePlaceholderExtraSelector:".fc-order-review-table__placeholder--extra",orderSummaryTableRefreshRate:50},u=[],m=function(e){!e||!window.FCUtils&&"function"==typeof FCUtils.scrollToElement||FCUtils.scrollToElement(e,b.progressBarSelector)},y=function(){var e=document.querySelector(b.stepsWrapperSelector);return e?Array.from(e.querySelectorAll(b.stepSelector)):[]},f=function(e,t,r){var o,s,l;e&&(o=!0,e.classList.contains(b.isEditingClass)||(o=!1),l=e.querySelector(b.substepFieldsSelector),s=e.querySelector(b.substepTextSelector),CollapsibleBlock.collapse(l,t),CollapsibleBlock.expand(s,t,r),e.classList.remove(b.isEditingClass),(l=e.querySelector(b.substepEditButtonSelector))&&l.focus(),o)&&m(e)},v=function(e){for(var t=null,r=window.FCUtils&&Array.from(FCUtils.getFocusableElements(e)),o=0;o<r.length;o++){var s=r[o];if(FCUtils.isElementVisible(s)){t=s;break}}t&&t.focus()},h=function(e){S&&p(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},C=function(){var e=document.querySelector(b.currentStepSelector);if(e){var t=parseInt(e.getAttribute(b.stepIndexAttribute)),t=isNaN(t)?-1:t,e=document.querySelector(b.progressBarSelector);if(e){for(var r=e.querySelectorAll(b.progressBarItemSelector),o=r.length,s=0;s<r.length;s++){var l=r[s],a=parseInt(l.getAttribute(b.stepIndexAttribute));(a=isNaN(a)?-1:a)==t?l.classList.add(b.isCurrentClass):l.classList.remove(b.isCurrentClass),a<t?l.classList.add(b.isCompleteClass):l.classList.remove(b.isCompleteClass)}var c=(c=t+1)<=o?c:o,o=e.querySelector(b.progressBarCurrentSelector);o&&(o.innerText=c)}}};return t.init=function(e){if(!n){b=FCUtils.extendObject(b,e),window.addEventListener("click",c,!0),document.addEventListener("keydown",i,!0),S&&(p(document.body).on("updated_checkout",o),p(document.body).on("updated_checkout",s),p(document.body).on("updated_checkout",r)),"yes"===b.enablePlaceOrderMove&&(l(),window.ResizeObserver)&&u.push(new ResizeObserver(FCUtils.debounce(l,b.placeOrderRefreshRate))),"yes"===b.enableOrderSummaryTableMove&&(a(),window.ResizeObserver)&&u.push(new ResizeObserver(FCUtils.debounce(a,b.orderSummaryTableRefreshRate)));for(var t=0;t<u.length;t++)u[t].observe(document.body);document.body.classList.add(b.bodyClass),n=!0}},t});