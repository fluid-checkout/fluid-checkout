{"version":3,"file":"../checkout-steps-327-beta-4.min.js","sources":["checkout-steps-327-beta-4.js"],"sourcesContent":["/**\r\n * Manage checkout steps state.\r\n *\r\n * DEPENDS ON:\r\n * - jQuery // Interact with WooCommerce events\r\n */\r\n(function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.CheckoutSteps = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _hasJQuery = ( $ != null );\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = {};\r\n\tvar _settings = {\r\n\t\tbodyClass: 'has-fc-checkout-steps',\r\n\t\tbodyClassActiveStepPattern: 'fc-checkout-step--active-{ID}',\r\n\r\n\t\tisMultistepLayout: 'yes',\r\n\t\tmaybeDisablePlaceOrderButton: 'yes',\r\n\r\n\t\twrapperSelector: '.fc-wrapper',\r\n\r\n\t\tprogressBarSelector: '.fc-progress-bar',\r\n\t\tprogressBarCurrentSelector: '.fc-progress-bar__current-step',\r\n\t\tprogressBarItemSelector: '.fc-progress-bar__bar',\r\n\r\n\t\tstepsWrapperSelector: '.fc-checkout-steps',\r\n\t\tstepSelector: '.fc-checkout-step',\r\n\t\tcurrentStepSelector: '[data-step-current]',\r\n\t\tlastStepSelector: '[data-step-last]',\r\n\t\tnextStepSelector: '[data-step-current] ~ .fc-checkout-step',\r\n\t\tnextStepButtonSelector: '[data-step-next]',\r\n\r\n\t\tcheckoutFormSelector: 'form.checkout',\r\n\t\tfieldSubmitFormSelector: 'input[type=\"text\"], input[type=\"checkbox\"], input[type=\"color\"], input[type=\"date\"], input[type=\"datetime\"], input[type=\"datetime-local\"], input[type=\"email\"], input[type=\"file\"], input[type=\"image\"], input[type=\"month\"], input[type=\"number\"], input[type=\"password\"], input[type=\"radio\"], input[type=\"search\"], input[type=\"tel\"], input[type=\"time\"], input[type=\"url\"], input[type=\"week\"]',\r\n\r\n\t\tsubstepSelector: '.fc-step__substep',\r\n\t\tsubstepTextContentSelector: '.fc-step__substep-text-content',\r\n\t\tsubstepFieldsSelector: '.fc-step__substep-fields',\r\n\t\tsubstepTextSelector: '.fc-step__substep-text',\r\n\t\tsubstepEditButtonSelector: '[data-step-edit]',\r\n\t\tsubstepSaveButtonSelector: '[data-step-save]',\r\n\r\n\t\tstepCompleteSelector: '[data-step-complete]',\r\n\t\tstepCompleteAttribute: 'data-step-complete',\r\n\t\tstepCurrentAttribute: 'data-step-current',\r\n\t\tstepIndexAttribute: 'data-step-index',\r\n\t\tstepIdAttribute: 'data-step-id',\r\n\r\n\t\tisEditingClass: 'is-editing',\r\n\t\tisLoadingClass: 'is-loading',\r\n\t\tisCurrentClass: 'is-current',\r\n\t\tisCompleteClass: 'is-complete',\r\n\t\tstepNextIncompleteClass: 'fc-checkout-step--next-step-incomplete',\r\n\t\tcurrentStepClassTemplate: 'fc-checkout-step-current--##STEP_ID##',\r\n\t\tcurrentLastStepClass: 'fc-checkout-step-current-last',\r\n\r\n\t\tsubstepEditableStateFieldSelector: '.fc-substep-editable-state[type=\"hidden\"]',\r\n\t\tsubstepEditableStateAttribute: 'data-substep-editable',\r\n\t\tsubstepVisibleStateFieldSelector: '.fc-substep-visible-state[type=\"hidden\"]',\r\n\t\tsubstepVisibleStateAttribute: 'data-substep-visible',\r\n\t\tsubstepExpandedStateFieldSelector: '.fc-substep-expanded-state[type=\"hidden\"]',\r\n\r\n\t\tinvalidFieldRowSelector: '.woocommerce-invalid .input-text, .woocommerce-invalid select',\r\n\r\n\t\tplaceOrderButtonSelector: '.fc-place-order-button',\r\n\t\tplaceOrderSkipMoveSelector: '.has-place-order--below_order_summary',\r\n\t\tplaceOrderSectionMainSelector: '.fc-place-order__section--main',\r\n\t\tplaceOrderPlaceholderMainSelector: '.fc-inside .fc-place-order__section-placeholder',\r\n\t\tplaceOrderPlaceholderSidebarSelector: '.fc-sidebar .fc-place-order__section-placeholder',\r\n\t\tplaceOrderRefreshRate: 50,\r\n\t}\r\n\tvar _resizeObserver;\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\r\n\t/**\r\n\t * Change scroll position to top of the element after the sticky elements.\r\n\t *\r\n\t * @param   HTMLElement  element      The element of to scroll to.\r\n\t */\r\n\tvar scrollToElement = function( element ) {\r\n\t\t// Bail if step element not provided\r\n\t\tif ( ! element ) { return; }\r\n\r\n\t\t// Bail if FCUtils is not available\r\n\t\tif ( ! window.FCUtils && 'function' === typeof FCUtils.scrollToElement ) { return; }\r\n\r\n\t\tFCUtils.scrollToElement( element, _settings.progressBarSelector );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get all step elements.\r\n\t *\r\n\t * @return  Array  List of step elements.\r\n\t */\r\n\tvar getAllSteps = function() {\r\n\t\tvar stepsWrapper = document.querySelector( _settings.stepsWrapperSelector );\r\n\r\n\t\t// Bail if steps wrapper not found, returns empty `Array`.\r\n\t\tif ( ! stepsWrapper ) { return []; }\r\n\r\n\t\treturn Array.from( stepsWrapper.querySelectorAll( _settings.stepSelector ) );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Check whether the step related to the element is complete.\r\n\t * \r\n\t * @param  {HTMLElement}  element   Element to check. It can the the step element, a substep element or any child of the step.\r\n\t * \r\n\t * @return {Boolean}                Whether the step is complete.\r\n\t */\r\n\tvar isStepComplete = function( element ) {\r\n\t\treturn null !== element.closest( _settings.stepCompleteSelector );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Expand the substep fields for edition, and collapse the substep values in text format.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t * @param   Boolean      withTransition  Whether to use transitions between states. Defaults to `true`.\r\n\t * @param   Boolean      withFocus       Whether to set the focus to the field when expanding. Cannot be used with `withTransition = true`. Defaults to `true`.\r\n\t */\r\n\tvar expandSubstepEdit = function( substepElement, withTransition, withFocus ) {\r\n\t\t// Bail if substep element not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\t// Get substep collapsible elements\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.expand( substepFieldsElement, withTransition, withFocus );\r\n\t\tCollapsibleBlock.collapse( substepTextElement, withTransition );\r\n\r\n\t\t// Add editing class to the substep element\r\n\t\tsubstepElement.classList.add( _settings.isEditingClass );\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t * @param   Boolean      withTransition  Whether to use transitions between states. Defaults to `true`.\r\n\t * @param   Boolean      withFocus       Whether to set the focus to the field when expanding. Cannot be used with `withTransition = true`. Defaults to `true`.\r\n\t */\r\n\tvar collapseSubstepEdit = function( substepElement, withTransition, withFocus ) {\r\n\t\t// Bail if substep element not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\t// Maybe set to skip scrolling to the substep element\r\n\t\t// if the substep is already collapsed.\r\n\t\tvar shouldScroll = true;\r\n\t\tif ( ! substepElement.classList.contains( _settings.isEditingClass ) ) {\r\n\t\t\tshouldScroll = false;\r\n\t\t}\r\n\r\n\t\t// Get substep collapsible elements\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.collapse( substepFieldsElement, withTransition );\r\n\t\tCollapsibleBlock.expand( substepTextElement, withTransition, withFocus );\r\n\r\n\t\t// Remove editing class from the substep element\r\n\t\tsubstepElement.classList.remove( _settings.isEditingClass );\r\n\r\n\t\t// Focus on the substep edit button\r\n\t\tvar editbutton = substepElement.querySelector( _settings.substepEditButtonSelector );\r\n\t\tif ( editbutton ) {\r\n\t\t\teditbutton.focus();\r\n\t\t}\r\n\r\n\t\t// Maybe change scroll position after collapsing substep\r\n\t\tif ( shouldScroll ) {\r\n\t\t\tscrollToElement( substepElement );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe set focus to the first focusable element that is visible inside the provided element.\r\n\t *\r\n\t * @param   {[type]}  element  [element description]\r\n\t *\r\n\t * @return  {[type]}           [return description]\r\n\t */\r\n\tvar maybeFocusFirstElement = function( element ) {\r\n\t\t// Get first focusable element that is visible\r\n\t\tvar focusElement = null;\r\n\t\tvar focusableElements = window.FCUtils && Array.from( FCUtils.getFocusableElements( element ) );\r\n\t\tfor ( var i = 0; i < focusableElements.length; i++ ) {\r\n\t\t\tvar focusableElement = focusableElements[i];\r\n\t\t\tif ( FCUtils.isElementVisible( focusableElement ) ) {\r\n\t\t\t\tfocusElement = focusableElement;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set focus\r\n\t\tif ( focusElement ) {\r\n\t\t\tfocusElement.focus();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Use the same method that WooCommerce uses to block other parts of the checkout form while updating.\r\n\t * The UI is unblocked by the WooCommerce `checkout.js` script (which is replaced with a modified version but keeps the same behavior)\r\n\t * using the checkout fragment selector, then unblocking after the checkout update is completed.\r\n\t *\r\n\t * @param   HTMLElement  element  Element to block the UI and show the loading indicator.\r\n\t */\r\n\tvar blockUI = function( element ) {\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( element ).block( {\r\n\t\t\t\tmessage: null,\r\n\t\t\t\toverlayCSS: {\r\n\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\topacity: 0.6\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe remove `is-loading` class from fragments after checkout update.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeRemoveFragmentsLoadingClass = function( _event, data ) {\r\n\t\t// Iterate fragments\r\n\t\tif ( data && data.fragments ) {\r\n\t\t\tfor ( var key in data.fragments ) {\r\n\t\t\t\t// Try to get the target fragment element\r\n\t\t\t\tvar framentElement = document.querySelector( key );\r\n\t\t\t\tif ( framentElement ) {\r\n\t\t\t\t\t// Remove `is-loading` class from the fragment element\r\n\t\t\t\t\tframentElement.classList.remove( _settings.isLoadingClass );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar maybeSaveSubstep = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( substepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = substepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Collapse substep fields and display step in text format\r\n\t\tcollapseSubstepEdit( substepElement );\r\n\r\n\t\t// Update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tblockUI( contentElement );\r\n\r\n\t\t\t// Remove messages prior to updating\r\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\r\n\r\n\t\t\t// Trigger update checkout\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the progress bar state.\r\n\t */\r\n\tvar updateProgressBar = function() {\r\n\t\t// Get current step\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\r\n\t\t// Bail if no current step was found\r\n\t\tif ( ! currentStepElement ) { return; }\r\n\r\n\t\t// Get index of the current step\r\n\t\tvar currentStepIndex = parseInt( currentStepElement.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\tcurrentStepIndex = isNaN( currentStepIndex ) ? -1 : currentStepIndex;\r\n\r\n\t\t// Get progress bar items\r\n\t\tvar progressBarElement = document.querySelector( _settings.progressBarSelector )\r\n\r\n\t\t// Bail if progress bar element not found\r\n\t\tif ( ! progressBarElement ) { return; }\r\n\r\n\t\tvar progressBarItems = progressBarElement.querySelectorAll( _settings.progressBarItemSelector );\r\n\t\tvar progressBarItemsCount = progressBarItems.length;\r\n\r\n\t\t// Update progress bar items status\r\n\t\tfor ( var i = 0; i < progressBarItems.length; i++ ) {\r\n\t\t\tvar bar = progressBarItems[i];\r\n\t\t\tvar stepIndex = parseInt( bar.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\t\tstepIndex = isNaN( stepIndex ) ? -1 : stepIndex;\r\n\r\n\t\t\t// Update the `current` status for each progress bar item\r\n\t\t\tif ( stepIndex == currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCurrentClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCurrentClass );\r\n\t\t\t}\r\n\r\n\t\t\t// Update the `complete` status for each progress bar item\r\n\t\t\tif ( stepIndex <= currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Calculate the current step text value\r\n\t\tvar currentStepValue = currentStepIndex + 1;\r\n\t\tcurrentStepValue = currentStepValue <= progressBarItemsCount ? currentStepValue : progressBarItemsCount;\r\n\r\n\t\t// Change value of the current step text indicator\r\n\t\tvar currentStepTextElement = progressBarElement.querySelector( _settings.progressBarCurrentSelector );\r\n\t\tif ( currentStepTextElement ) {\r\n\t\t\tcurrentStepTextElement.innerText = currentStepValue;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar maybeProceedNextStep = function( stepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! stepElement ) { return; }\r\n\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( stepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = stepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when any substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Set current step as complete\r\n\t\tstepElement.setAttribute( _settings.stepCompleteAttribute, '' );\r\n\r\n\t\t// Collapse substeps fields and display step in text format\r\n\t\tvar substepElements = stepElement.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tif ( contentElement ) {\r\n\t\t\t\tcontentElement.classList.add( _settings.isLoadingClass );\r\n\t\t\t\tblockUI( contentElement );\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse substep\r\n\t\t\tcollapseSubstepEdit( substepElement );\r\n\t\t}\r\n\r\n\t\t// Get next step, and set it as current\r\n\t\tvar nextStepElement = stepElement.parentElement.querySelector( _settings.nextStepSelector );\r\n\t\tnextStepElement.setAttribute( _settings.stepCurrentAttribute, '' );\r\n\r\n\t\t// Unset `current` from the step that is closing\r\n\t\t// (needs to run after setting the next step as the current one)\r\n\t\tstepElement.removeAttribute( _settings.stepCurrentAttribute );\r\n\r\n\t\t// Remove `next-step-incomplete` class from previous steps\r\n\t\tvar allSteps = getAllSteps();\r\n\t\tvar stepIndex = allSteps.indexOf( stepElement );\r\n\t\tfor ( var i = 0; i < allSteps.length; i++ ) {\r\n\t\t\tif ( i < stepIndex ) {\r\n\t\t\t\tvar step = allSteps[i];\r\n\t\t\t\tstep.classList.remove( _settings.stepNextIncompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update progress bar\r\n\t\tupdateProgressBar();\r\n\r\n\t\t// Maybe set focus to the first focusable element that is visible in the next step\r\n\t\tmaybeFocusFirstElement( nextStepElement );\r\n\r\n\t\t// Change scroll position after moving to next step\r\n\t\tscrollToElement( stepElement );\r\n\r\n\t\t// Trigger update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the body classes for step states.\r\n\t */\r\n\tvar updateStepBodyClasses = function() {\r\n\t\t// Bail if not using multistep layout\r\n\t\tif ( 'yes' !== _settings.maybeDisablePlaceOrderButton || 'yes' !== _settings.isMultistepLayout ) { return; }\r\n\r\n\t\t// Remove current step class\r\n\t\tvar allSteps = getAllSteps();\r\n\t\tfor ( var i = 0; i < allSteps.length; i++ ) {\r\n\t\t\tvar step = allSteps[i];\r\n\t\t\tvar stepId = step.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar className = _settings.currentStepClassTemplate.replace( '##STEP_ID##', stepId );\r\n\t\t\tdocument.body.classList.remove( className );\r\n\t\t}\r\n\r\n\t\t// Maybe add current step class\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\tvar lastStepElement = document.querySelector( _settings.lastStepSelector );\r\n\t\tif ( currentStepElement ) {\r\n\t\t\tvar stepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\r\n\t\t\t// Add current step class\r\n\t\t\tvar className = _settings.currentStepClassTemplate.replace( '##STEP_ID##', stepId );\r\n\t\t\tdocument.body.classList.add( className );\r\n\r\n\t\t\t// Maybe add last step class\r\n\t\t\tif ( lastStepElement ) {\r\n\t\t\t\tvar currentStepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\t\tvar lastStepId = lastStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\t\tif ( lastStepId === currentStepId ) {\r\n\t\t\t\t\tdocument.body.classList.add( _settings.currentLastStepClass );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe disable the place order buttons.\r\n\t */\r\n\tvar maybeDisablePlaceOrderButton = function() {\r\n\t\t// Bail if not using multistep layout\r\n\t\tif ( 'yes' !== _settings.maybeDisablePlaceOrderButton || 'yes' !== _settings.isMultistepLayout ) { return; }\r\n\r\n\t\t// Check if current step is same as last step\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\tvar lastStepElement = document.querySelector( _settings.lastStepSelector );\r\n\t\tif ( currentStepElement && lastStepElement ) {\r\n\t\t\tvar currentStepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar lastStepId = lastStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar isDisabled = currentStepId !== lastStepId;\r\n\r\n\t\t\tvar placeOrderButtons = document.querySelectorAll( _settings.placeOrderButtonSelector );\r\n\t\t\tfor ( var i = 0; i < placeOrderButtons.length; i++ ) {\r\n\t\t\t\tvar button = placeOrderButtons[i];\r\n\t\t\t\tbutton.disabled = isDisabled;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the global state of steps.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar updateGlobalStepStates = function( _event, data ) {\r\n\t\tupdateStepBodyClasses();\r\n\t\tmaybeDisablePlaceOrderButton();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Maybe change visibility status of checkout substep sections.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeChangeSubstepState = function( _event, data ) {\r\n\t\tvar substepElements = document.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\r\n\t\t\t// Handle editable state\r\n\t\t\tvar editableHiddenField = substepElement.querySelector( _settings.substepEditableStateFieldSelector );\r\n\t\t\tif ( editableHiddenField ) {\r\n\t\t\t\tif ( 'no' === editableHiddenField.value ) {\r\n\t\t\t\t\tsubstepElement.setAttribute( _settings.substepEditableStateAttribute, editableHiddenField.value );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tsubstepElement.removeAttribute( _settings.substepEditableStateAttribute );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove editable state hidden field, to avoid it being used again\r\n\t\t\t\teditableHiddenField.parentNode.removeChild( editableHiddenField );\r\n\t\t\t}\r\n\r\n\t\t\t// Handle expanded state\r\n\t\t\tvar expandedHiddenField = substepElement.querySelector( _settings.substepExpandedStateFieldSelector );\r\n\t\t\tif ( expandedHiddenField ) {\r\n\t\t\t\tvar isSetExpanded = expandedHiddenField && 'yes' === expandedHiddenField.value;\r\n\t\t\t\tif ( isSetExpanded ) {\r\n\t\t\t\t\t// Expand section\r\n\t\t\t\t\texpandSubstepEdit( substepElement, true, false );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove expanded state hidden field, to avoid it being used again\r\n\t\t\t\texpandedHiddenField.parentNode.removeChild( expandedHiddenField );\r\n\t\t\t}\r\n\r\n\t\t\t// Handle visibility state\r\n\t\t\tvar visibilityHiddenField = substepElement.querySelector( _settings.substepVisibleStateFieldSelector );\r\n\t\t\tif ( visibilityHiddenField ) {\r\n\t\t\t\t// Change visibility state\r\n\t\t\t\tsubstepElement.setAttribute( _settings.substepVisibleStateAttribute, visibilityHiddenField.value );\r\n\r\n\t\t\t\t// Maybe collapse substep edit\r\n\t\t\t\t// when substep is already hidden, set as complete and set as expanded\r\n\t\t\t\tif ( 'no' === visibilityHiddenField.value && ! isSetExpanded && isStepComplete( substepElement ) ) {\r\n\t\t\t\t\tcollapseSubstepEdit( substepElement, true, false );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove visibility state hidden field, to avoid it being used again\r\n\t\t\t\tvisibilityHiddenField.parentNode.removeChild( visibilityHiddenField );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe move place order section to order summary for small screens.\r\n\t */\r\n\tvar maybeMovePlaceOrderSection = function() {\r\n\t\t// Bail if displaying the place order only on the sidebar. In this case there is no need to move the sections.\r\n\t\tif ( document.body.matches( _settings.placeOrderSkipMoveSelector ) ) { return; }\r\n\r\n\t\t// Get viewport width\r\n\t\tvar viewportWidth = window.innerWidth;\r\n\r\n\t\t// Get place order sections\r\n\t\tvar placeOrderMain = document.querySelector( _settings.placeOrderSectionMainSelector );\r\n\t\tvar placeOrderPlaceholderMain = document.querySelector( _settings.placeOrderPlaceholderMainSelector );\r\n\t\tvar placeOrderPlaceholderSidebar = document.querySelector( _settings.placeOrderPlaceholderSidebarSelector );\r\n\r\n\t\t// Bail if elements are not found\r\n\t\tif ( ! placeOrderMain || ! placeOrderPlaceholderMain || ! placeOrderPlaceholderSidebar ) { return; }\r\n\r\n\t\t// Maybe move to sidebar section\r\n\t\tif ( viewportWidth < 1000 && placeOrderPlaceholderSidebar.parentNode !== placeOrderMain.parentNode ) {\r\n\t\t\tplaceOrderPlaceholderSidebar.parentNode.insertBefore( placeOrderMain, placeOrderPlaceholderSidebar.nextSibling );\r\n\t\t}\r\n\t\t// Maybe move to steps section\r\n\t\telse if ( viewportWidth >= 1000 && placeOrderPlaceholderMain.parentNode !== placeOrderMain.parentNode ) {\r\n\t\t\tplaceOrderPlaceholderMain.parentNode.insertBefore( placeOrderMain, placeOrderPlaceholderMain.nextSibling );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle document clicks and route to the appropriate function.\r\n\t */\r\n\tvar handleClick = function( e ) {\r\n\t\t// NEXT STEP\r\n\t\tif ( e.target.closest( _settings.nextStepButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar step = e.target.closest( _settings.stepSelector );\r\n\t\t\tmaybeProceedNextStep( step );\r\n\t\t}\r\n\t\t// EDIT SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepEditButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\texpandSubstepEdit( substepElement );\r\n\t\t}\r\n\t\t// SAVE SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepSaveButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\tmaybeSaveSubstep( substepElement );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle keypress event.\r\n\t */\r\n\tvar handleKeyDown = function( e ) {\r\n\t\t// Should do nothing if the default action has been cancelled\r\n\t\tif ( e.defaultPrevented ) { return; }\r\n\r\n\t\t// ENTER or SPACE on handler elements\r\n\t\tif ( ( FCUtils.keyboardKeys.ENTER === e.key || FCUtils.keyboardKeys.SPACE === e.key ) && ( e.target.closest( _settings.substepEditButtonSelector ) || e.target.closest( _settings.substepSaveButtonSelector ) ) ) {\r\n\t\t\t// Simulate click\r\n\t\t\thandleClick( e );\r\n\t\t}\r\n\t\t// ENTER on form fields.\r\n\t\t// Prevents submit of the checkout form when pressing ENTER on a field inside the checkout form.\r\n\t\telse if ( FCUtils.keyboardKeys.ENTER === e.key && e.target.closest( _settings.checkoutFormSelector ) && e.target.closest( _settings.fieldSubmitFormSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t// Maybe validate field\r\n\t\t\tif ( window.CheckoutValidation ) {\r\n\t\t\t\tvar field = e.target.closest( _settings.fieldSubmitFormSelector );\r\n\t\t\t\tCheckoutValidation.validateField( field, 'step-validation' );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize component and set related handlers.\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) { return; }\r\n\r\n\t\t// Merge settings\r\n\t\t_settings = FCUtils.extendObject( _settings, options );\r\n\r\n\t\t// Maybe move place order section, and initialize resize observers\r\n\t\tmaybeMovePlaceOrderSection();\r\n\t\tif ( window.ResizeObserver ) {\r\n\t\t\t_resizeObserver = new ResizeObserver( FCUtils.debounce( maybeMovePlaceOrderSection, _settings.placeOrderRefreshRate ) );\r\n\t\t\t_resizeObserver.observe( document.body );\r\n\t\t}\r\n\r\n\t\t// Add event listeners\r\n\t\twindow.addEventListener( 'click', handleClick, true );\r\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\r\n\r\n\t\t// Add jQuery event listeners\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).on( 'updated_checkout', updateGlobalStepStates );\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeChangeSubstepState );\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeRemoveFragmentsLoadingClass );\r\n\r\n\t\t\t// Collapsible block, focus on expand\t\t\r\n\t\t\tif ( window.CollapsibleBlock ) {\r\n\t\t\t\t$( document.body ).on( 'updated_checkout', CollapsibleBlock.enableFocusOnExpand );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Collapsible block, focus on expand\r\n\t\tif ( window.CollapsibleBlock ) {\r\n\t\t\tCollapsibleBlock.disableFocusOnExpand();\r\n\t\t}\r\n\r\n\t\t// Add init class\r\n\t\tdocument.body.classList.add( _settings.bodyClass );\r\n\r\n\t\t_hasInitialized = true;\r\n\t};\r\n\r\n\r\n\r\n\t//\r\n\t// Public APIs\r\n\t//\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","CheckoutSteps","global","this","window","expandSubstepEdit","substepElement","withTransition","withFocus","substepFieldsElement","substepTextElement","querySelector","_settings","substepFieldsSelector","substepTextSelector","CollapsibleBlock","expand","collapse","classList","add","isEditingClass","maybeRemoveFragmentsLoadingClass","_event","data","fragments","key","framentElement","document","remove","isLoadingClass","updateGlobalStepStates","maybeDisablePlaceOrderButton","isMultistepLayout","allSteps","getAllSteps","i","length","stepId","getAttribute","stepIdAttribute","className","currentStepClassTemplate","replace","body","currentStepElement","currentStepSelector","lastStepElement","lastStepSelector","currentStepId","currentLastStepClass","isDisabled","placeOrderButtons","querySelectorAll","placeOrderButtonSelector","disabled","maybeChangeSubstepState","substepElements","substepSelector","isSetExpanded","editableHiddenField","substepEditableStateFieldSelector","expandedHiddenField","value","setAttribute","substepEditableStateAttribute","removeAttribute","parentNode","removeChild","substepExpandedStateFieldSelector","visibilityHiddenField","substepVisibleStateFieldSelector","substepVisibleStateAttribute","closest","stepCompleteSelector","collapseSubstepEdit","maybeMovePlaceOrderSection","viewportWidth","placeOrderMain","placeOrderPlaceholderMain","placeOrderPlaceholderSidebar","matches","placeOrderSkipMoveSelector","innerWidth","placeOrderSectionMainSelector","placeOrderPlaceholderMainSelector","placeOrderPlaceholderSidebarSelector","insertBefore","nextSibling","handleClick","e","target","nextStepButtonSelector","preventDefault","stepElement","stepSelector","CheckoutValidation","validateAllFields","firstInvalidField","invalidFieldRowSelector","focus","stepCompleteAttribute","contentElement","substepTextContentSelector","blockUI","nextStepElement","parentElement","nextStepSelector","stepCurrentAttribute","stepIndex","indexOf","stepNextIncompleteClass","updateProgressBar","maybeFocusFirstElement","scrollToElement","_hasJQuery","$","trigger","substepEditButtonSelector","substepSaveButtonSelector","handleKeyDown","field","defaultPrevented","FCUtils","keyboardKeys","ENTER","SPACE","checkoutFormSelector","fieldSubmitFormSelector","validateField","jQuery","_hasInitialized","_publicMethods","bodyClass","bodyClassActiveStepPattern","wrapperSelector","progressBarSelector","progressBarCurrentSelector","progressBarItemSelector","stepsWrapperSelector","stepIndexAttribute","isCurrentClass","isCompleteClass","placeOrderRefreshRate","element","stepsWrapper","Array","from","shouldScroll","editbutton","contains","focusElement","focusableElements","getFocusableElements","focusableElement","isElementVisible","block","message","overlayCSS","background","opacity","currentStepIndex","parseInt","isNaN","progressBarElement","progressBarItems","progressBarItemsCount","bar","currentStepValue","currentStepTextElement","innerText","init","options","extendObject","ResizeObserver","debounce","observe","addEventListener","on","enableFocusOnExpand","disableFocusOnExpand"],"mappings":"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"}