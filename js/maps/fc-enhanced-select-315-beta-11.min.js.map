{"version":3,"file":"../fc-enhanced-select-315-beta-11.min.js","sources":["fc-enhanced-select-315-beta-11.js"],"sourcesContent":["/**\r\n * Initialize enhanced select fields with TomSelect, instead of Select2.\r\n */\r\n(function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.FCEnhancedSelect = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _hasJQuery = ( $ != null );\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = {};\r\n\tvar _settings = {\r\n\t\tbodyClass:                             'has-fc-enhanced-select',\r\n\t\tformRowSelector:                       '.form-row.fc-select2-field',\r\n\t\tselectFieldSelector:                   '.fc-select2-field select',\r\n\t\tcontrolElementSelector:                '.ts-control',\r\n\t\tinputFieldSelector:                    '.fc-select2-field .ts-control > input',\r\n\r\n\t\tfieldSettings: {\r\n\t\t\tcreate: false,\r\n\t\t\tdiacritics: true,\r\n\t\t\topenOnFocus: false,\r\n\t\t},\r\n\t\tfieldPluginsSingle: [],\r\n\t\tfieldPluginsMulti: [ 'remove_button' ],\r\n\t};\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * Support for Select2 and SelectWoo jQuery plugins.\r\n\t * Replace `$.fn.select2` and `$.fn.selectWoo` with a dummy function to avoid JS errors when other plugins try to use them.\r\n\t */\r\n\tvar replaceSelect2JQueryPlugins = function() {\r\n\t\t// Bail if jQuery is not available\r\n\t\tif ( ! _hasJQuery ) { return; }\r\n\r\n\t\t// Replace `$.fn.select2` and `$.fn.selectWoo` with a dummy function\r\n\t\t$.fn.select2 = function() { return this; };\r\n\t\t$.fn.selectWoo = function() { return this; };\r\n\t}\r\n\t// Replace immediatelly.\r\n\treplaceSelect2JQueryPlugins();\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\t\r\n\t/**\r\n\t * Get the selected values of a select field.\r\n\t * \r\n\t * @param    {Element}       field   The select field.\r\n\t * \r\n\t * @returns  {Array|string}          The selected values as an array, or a single value if only one is selected.\r\n\t */\r\n\tvar getSelectValues = function( field ) {\r\n\t\tvar results = [];\r\n\t\tvar options = field && field.options;\r\n\t\tvar currentOption;\r\n\r\n\t\t// Iterate options and get selected values\r\n\t\tfor ( var i = 0; i < options.length; i++ ) {\r\n\t\t\tcurrentOption = options[i];\r\n\r\n\t\t\tif ( currentOption.selected ) {\r\n\t\t\t\tresults.push( currentOption.value || currentOption.text );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Maybe return single value\r\n\t\tif ( results.length === 1 ) {\r\n\t\t\tresults = results[0];\r\n\t\t}\r\n\r\n\t\treturn results;\r\n\t}\r\n\r\n\t/**\r\n\t * Update the selected value of an enhanced select field.\r\n\t * \r\n\t * @param  {Event}  event  The `change` event.\r\n\t */\r\n\tvar updateSelectedValue = function( event ) {\r\n\t\t// Get field reference and value\r\n\t\tvar field = event.target;\r\n\r\n\t\t// Bail if field does not match enhanced select selector\r\n\t\tif ( ! field.matches( _settings.selectFieldSelector ) ) { return; }\r\n\r\n\t\t// Bail if field is not a TomSelect field\r\n\t\tif ( ! field.tomselect ) { return; }\r\n\r\n\t\t// Get updated field value\r\n\t\tvar values = getSelectValues( field );\r\n\r\n\t\t// Set value, without triggering `change` event\r\n\t\t// to avoid infinite loop.\r\n\t\tfield.tomselect.setValue( values, true );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Unset autocomplete attribute for the search field.\r\n\t */\r\n\tvar disableFieldAutocomplete = function() {\r\n\t\t// Get field reference\r\n\t\tvar tomselect = this;\r\n\t\tvar searchField = tomselect.focus_node;\r\n\r\n\t\t// Unset autocomplete attribute for the search field\r\n\t\tsearchField.setAttribute( 'autocomplete', 'off-' + Date.now() );\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe scroll to the top of the field when opening the dropdown.\r\n\t */\r\n\tvar maybeScrollToField = function() {\r\n\t\t// Bail if not on target breakpoint or smaller\r\n\t\tif ( ! FCUtils.isCurrentBreakpointOrSmaller( 'phablet' ) ) { return; }\r\n\r\n\t\t// Get field reference\r\n\t\tvar tomselect = this;\r\n\t\tvar searchField = tomselect.focus_node;\r\n\t\tvar formRow = searchField.closest( _settings.formRowSelector );\r\n\r\n\t\t// Bail if form row is not found\r\n\t\tif ( ! formRow ) { return; }\r\n\r\n\t\t// Scroll to the top of the form row\r\n\t\tFCUtils.scrollToElement( formRow, null, 30 );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe open the dropdown of the field.\r\n\t * \r\n\t * @param  {Element}  field  The select field.\r\n\t */\r\n\tvar maybeOpenDropdown = function( field ) {\r\n\t\t// Bail if field is not valid\r\n\t\tif ( ! field ) { return; }\r\n\r\n\t\t// Bail if not a TomSelect field\r\n\t\tif ( ! field.tomselect ) { return; }\r\n\r\n\t\t// Get TomSelect instance\r\n\t\tvar tomselect = field.tomselect;\r\n\r\n\t\t// Maybe open field dropdown\r\n\t\tif ( ! tomselect.isOpen ) {\r\n\t\t\ttomselect.open();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe close the dropdown of the field.\r\n\t * \r\n\t * @param  {Element}  field  The select field.\r\n\t */\r\n\tvar maybeCloseDropdown = function( field ) {\r\n\t\t// Bail if field is not valid\r\n\t\tif ( ! field ) { return; }\r\n\r\n\t\t// Bail if not a TomSelect field\r\n\t\tif ( ! field.tomselect ) { return; }\r\n\r\n\t\t// Get TomSelect instance\r\n\t\tvar tomselect = field.tomselect;\r\n\r\n\t\t// Maybe close field dropdown\r\n\t\tif ( tomselect.isOpen ) {\r\n\t\t\ttomselect.close();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe toggle the dropdown of the field open/closed status.\r\n\t * \r\n\t * @param  {Element}  field  The select field.\r\n\t */\r\n\tvar maybeToggleDropdown = function( field ) {\r\n\t\t// Bail if field is not valid\r\n\t\tif ( ! field ) { return; }\r\n\r\n\t\t// Bail if not a TomSelect field\r\n\t\tif ( ! field.tomselect ) { return; }\r\n\r\n\t\t// Get TomSelect instance\r\n\t\tvar tomselect = field.tomselect;\r\n\t\tvar isOpen = tomselect.isOpen;\r\n\r\n\t\t// Maybe toggle field dropdown\r\n\t\trequestAnimationFrame( function() {\r\n\t\tif ( isOpen ) {\r\n\t\t\t\tmaybeCloseDropdown( field );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmaybeOpenDropdown( field );\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\r\n\r\n\t/** \r\n\t * Enhance selecct fields with TomSelect.\r\n\t * \r\n\t * @param  {string}  selector   (optional) Selector for the fields to enhance, will use default settings if not defined.\r\n\t * @param  {object}  settings   (optional) Settings for the enhanced select fields, will use default settings if not defined.\r\n\t */\r\n\t_publicMethods.enhanceFields = function( selector, settings ) {\r\n\t\t// Bail if TomSelect is not defined\r\n\t\tif ( 'undefined' === typeof TomSelect ) { return; }\r\n\r\n\t\t// Get selector from settings if not defined\r\n\t\tif ( undefined === selector || null === selector ) {\r\n\t\t\tselector = _settings.selectFieldSelector;\r\n\t\t}\r\n\r\n\t\t// Bail if selector is not of type string\r\n\t\tif ( 'string' !== typeof selector ) { return; }\r\n\r\n\t\t// Maybe get default settings\r\n\t\tif ( undefined === settings || null === settings ) {\r\n\t\t\tsettings = _settings.fieldSettings;\r\n\t\t}\r\n\r\n\t\t// Get fields to apply the enhanced select\r\n\t\tvar fields;\r\n\t\ttry {\r\n\t\t\tfields = document.querySelectorAll( selector );\r\n\t\t}\r\n\t\tcatch( error ) {\r\n\t\t\tconsole.warn( 'Enhanced select: ' + error.message );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Iterate fields and enhance them with TomSelect\r\n\t\tfor ( var i = 0; i < fields.length; i++ ) {\r\n\t\t\t// Get field reference and value\r\n\t\t\tvar field = fields[ i ];\r\n\t\t\tvar values = getSelectValues( field );\r\n\t\t\tvar isMultiple = field.hasAttribute( 'multiple' );\r\n\r\n\t\t\t// Maybe destroy TomSelect instance\r\n\t\t\tif ( field.tomselect ) {\r\n\t\t\t\tfield.tomselect.destroy();\r\n\t\t\t}\r\n\r\n\t\t\t// Handle differences between single and multiple select fields\r\n\t\t\t// Multiple select\r\n\t\t\tif ( isMultiple ) {\r\n\t\t\t\tsettings.plugins = _settings.fieldPluginsMulti;\r\n\t\t\t}\r\n\t\t\t// Single select\r\n\t\t\telse {\r\n\t\t\t\tsettings.plugins = _settings.fieldPluginsSingle;\r\n\t\t\t}\r\n\r\n\t\t\t// Enhance field with TomSelect\r\n\t\t\tvar instance = new TomSelect( field, settings );\r\n\r\n\t\t\t// Set value, without triggering `change` event\r\n\t\t\t// to avoid infinite loop.\r\n\t\t\tinstance.setValue( values, true );\r\n\r\n\t\t\t// Set event listeners\r\n\t\t\tinstance.on( 'focus', disableFieldAutocomplete );\r\n\t\t\tinstance.on( 'blur', disableFieldAutocomplete );\r\n\t\t\tinstance.on( 'dropdown_open', maybeScrollToField );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle captured `focus` event and route to the appropriate functions.\r\n\t */\r\n\tvar handleFocus = function( e ) {\r\n\t\t// INPUT ELEMENT\r\n\t\tif ( e.target.closest( _settings.inputFieldSelector ) ) {\r\n\t\t\tvar formRow = e.target.closest( _settings.formRowSelector );\r\n\t\t\tvar field = formRow.querySelector( 'select' );\r\n\t\t\tmaybeOpenDropdown( field );\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Handle captured `blur` event and route to the appropriate functions.\r\n\t */\r\n\tvar handleBlur = function( e ) {\r\n\t\t// INPUT ELEMENT\r\n\t\tif ( e.target.closest( _settings.inputFieldSelector ) ) {\r\n\t\t\tvar formRow = e.target.closest( _settings.formRowSelector );\r\n\t\t\tvar field = formRow.querySelector( 'select' );\r\n\t\t\tmaybeCloseDropdown( field );\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Handle captured `click` event and route to the appropriate functions.\r\n\t */\r\n\tvar handleClick = function( e ) {\r\n\t\t// INPUT ELEMENT\r\n\t\tif ( e.target.closest( _settings.controlElementSelector ) ) {\r\n\t\t\tvar formRow = e.target.closest( _settings.formRowSelector );\r\n\t\t\tvar field = formRow.querySelector( 'select' );\r\n\t\t\tmaybeToggleDropdown( field );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize component and set related handlers.\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) return;\r\n\r\n\t\t// Merge settings with defaults\r\n\t\t_settings = FCUtils.extendObject( _settings, options );\r\n\r\n\t\t// Set event listener for enhanced select fields\r\n\t\tdocument.addEventListener( 'click', handleClick, true );\r\n\t\tdocument.addEventListener( 'change', updateSelectedValue, true );\r\n\t\tdocument.addEventListener( 'focus', handleFocus, true );\r\n\t\tdocument.addEventListener( 'blur', handleBlur, true );\r\n\r\n\t\t// Initialize fields\r\n\t\t_publicMethods.enhanceFields();\r\n\r\n\t\t// Add init class\r\n\t\tdocument.body.classList.add( _settings.bodyClass );\r\n\r\n\t\t_hasInitialized = true;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Expose public APIs.\r\n\t */\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","FCEnhancedSelect","global","this","window","getSelectValues","field","currentOption","results","options","i","length","selected","push","value","text","updateSelectedValue","event","values","target","matches","_settings","selectFieldSelector","tomselect","setValue","disableFieldAutocomplete","focus_node","setAttribute","Date","now","maybeScrollToField","formRow","FCUtils","isCurrentBreakpointOrSmaller","closest","formRowSelector","scrollToElement","handleFocus","e","inputFieldSelector","querySelector","maybeOpenDropdown","handleBlur","maybeCloseDropdown","handleClick","isOpen","controlElementSelector","requestAnimationFrame","$","jQuery","_hasInitialized","_publicMethods","bodyClass","fieldSettings","create","diacritics","openOnFocus","fieldPluginsSingle","fieldPluginsMulti","fn","select2","selectWoo","open","close","enhanceFields","selector","settings","TomSelect","undefined","fields","document","querySelectorAll","error","console","warn","message","isMultiple","hasAttribute","instance","destroy","plugins","on","init","extendObject","addEventListener","body","classList","add"],"mappings":"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"}