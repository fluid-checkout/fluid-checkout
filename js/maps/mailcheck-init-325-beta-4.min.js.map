{"version":3,"file":"../mailcheck-init-325-beta-4.min.js","sources":["mailcheck-init-325-beta-4.js"],"sourcesContent":["/**\r\n * Handles Mailcheck runs on email fields\r\n */\r\n(function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.MailcheckInit = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = { }\r\n\tvar _settings = {\r\n\t\tmailFieldSelector: '[data-mailcheck]',\r\n\r\n\t\tformFieldWrapperSelector: '.form-row',\r\n\t\tinputFieldWrapperSelector: '.woocommerce-input-wrapper',\r\n\t\tsuggestionElementSelector: '[data-mailcheck-suggestion]',\r\n\t\tsuggestionApplySelector: '[data-mailcheck-apply]',\r\n\t\terrorMessageElementSelector: '.woocommerce-error',\r\n\r\n\t\tmailFieldSuggestedClass: 'has-email-suggestion',\r\n\r\n\t\tsuggestionValueAttr: 'data-suggestion-value',\r\n\r\n\t\tsuggestedElementTemplate: '<div class=\"fc-mailcheck-suggestion\" data-mailcheck-suggestion>Did you mean <a class=\"mailcheck-suggestion\" href=\"#apply-suggestion\" data-mailcheck-apply data-suggestion-value=\"{suggestion-value}\">{suggestion}</a>?</div>',\r\n\t\tsuggestionTemplate: '{address}@<span class=\"mailcheck-suggestion-domain\">{domain}</span>',\r\n\t}\r\n\tvar _tempTarget = null;\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\r\n\t/**\r\n\t * Remove Mailcheck suggestions elements\r\n\t */\r\n\tvar removeSuggestions = function() {\r\n\t\t// Bail if there is no target\r\n\t\tif ( ! _tempTarget ) { return; }\r\n\r\n\t\t// Get variables\r\n\t\tvar parent = _tempTarget.closest( _settings.formFieldWrapperSelector );\r\n\r\n\t\t// Bail if no parent found\r\n\t\tif ( ! parent ) { return; }\r\n\r\n\t\t// Get suggestion elements to be removed\r\n\t\tvar suggestions = parent.querySelectorAll( _settings.suggestionElementSelector );\r\n\r\n\t\t// Remove suggestions\r\n\t\tfor ( var i = 0; i < suggestions.length; i++ ) {\r\n\t\t\tsuggestions[ i ].parentNode.removeChild( suggestions[i] );\r\n\t\t}\r\n\r\n\t\t// Remove suggested class\r\n\t\t_tempTarget.classList.remove( _settings.mailFieldSuggestedClass );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Add Mailcheck suggestions elements\r\n\t */\r\n\tvar handleSuggested = function( suggestion ) {\r\n\t\t// Remove existing suggestions\r\n\t\tremoveSuggestions();\r\n\r\n\t\t// Bail if there is no target\r\n\t\tif ( ! _tempTarget ) { return; }\r\n\r\n\t\t// Get variables\r\n\t\tvar parent = _tempTarget.closest( _settings.inputFieldWrapperSelector );\r\n\t\tvar suggestionHtml = _settings.suggestionTemplate.replaceAll( '{address}', suggestion.address ).replaceAll( '{domain}', suggestion.domain );\r\n\t\tvar suggestedElementHtml = _settings.suggestedElementTemplate.replaceAll( '{suggestion}', suggestionHtml ).replaceAll( '{suggestion-value}', suggestion.full );\r\n\r\n\t\t// Get target sibling\r\n\t\tvar insertPositionElement = _tempTarget.nextSibling;\r\n\r\n\t\t// Handle position when error messages are present\r\n\t\tif ( parent.querySelector( _settings.errorMessageElementSelector ) ) {\r\n\t\t\tvar errorMessageElements = parent.querySelectorAll( _settings.errorMessageElementSelector );\r\n\r\n\t\t\t// Get last error message element\r\n\t\t\tinsertPositionElement = errorMessageElements[ errorMessageElements.length - 1 ].nextSibling;\r\n\t\t}\r\n\r\n\t\t// Create suggestion element and add it after the field\r\n\t\tvar element = document.createElement( 'div' );\r\n\t\telement.innerHTML = suggestedElementHtml;\r\n\t\tparent.insertBefore( element.firstChild, insertPositionElement );\r\n\t\telement = null;\r\n\r\n\t\t_tempTarget.classList.add( _settings.mailFieldSuggestedClass );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Apply an email suggestion value to the email field\r\n\t */\r\n\tvar applySuggestion = function( suggestionElement ){\r\n\t\t// Bail if there are no suggestions\r\n\t\tif ( suggestionElement === null ) { return; }\r\n\r\n\t\t// Get form row\r\n\t\tvar parentFormRow = suggestionElement.closest( _settings.formFieldWrapperSelector );\r\n\t\t\r\n\t\t// Bail if parent form row not found\r\n\t\tif ( parentFormRow === null ) { return; }\r\n\r\n\t\tvar targetField = parentFormRow.querySelector( _settings.mailFieldSelector )\r\n\r\n\t\t// Bail if target field not found\r\n\t\tif ( targetField === null ) { return; }\r\n\r\n\t\t// Apply suggested value\r\n\t\ttargetField.value = suggestionElement.getAttribute( _settings.suggestionValueAttr );\r\n\t\t\r\n\t\t// Remove existing suggestions\r\n\t\t_tempTarget = targetField;\r\n\t\tremoveSuggestions();\r\n\t\t_tempTarget = null;\r\n\r\n\t\t// Refocus on the target field\r\n\t\ttargetField.focus();\r\n\r\n\t\t// Revalidate the field\r\n\t\tif ( window.CheckoutValidation ) {\r\n\t\t\tCheckoutValidation.validateField( targetField, 'apply-mailcheck-suggestion' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle captured keyup event and route to appropriate function.\r\n\t * @param  {Event} e Event data.\r\n\t */\r\n\tvar handleTriggerEvents = function( e ) {\r\n\t\t// Bail if Mailcheck not available\r\n\t\tif ( undefined === Mailcheck ) { return; }\r\n\r\n\t\t// Get the target field\r\n\t\t_tempTarget = e.target;\r\n\r\n\t\t// Run Mailcheck and handle suggestions\r\n\t\tMailcheck.run( {\r\n\t\t\temail: _tempTarget.value,\r\n\t\t\tsuggested: handleSuggested,\r\n\t\t\tempty: removeSuggestions\r\n\t\t} );\r\n\r\n\t\t// Clear the temp target\r\n\t\t_tempTarget = null;\r\n\t};\r\n\tvar handleTriggerEventsDebounced = FCUtils.debounce( handleTriggerEvents, 100 );\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle document clicks and route to the appropriate function.\r\n\t */\r\n\tvar handleClick = function( e ) {\r\n\t\t// APPLY SUGGESTION\r\n\t\tif ( e.target.closest( _settings.suggestionApplySelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tapplySuggestion( e.target.closest( _settings.suggestionApplySelector ) );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle keypress event.\r\n\t */\r\n\tvar handleKeyDown = function( e ) {\r\n\t\t// Should do nothing if the default action has been cancelled\r\n\t\tif ( e.defaultPrevented ) { return; }\r\n\r\n\t\t// ENTER or SPACE on apply-suggestion element\r\n\t\tif ( ( FCUtils.keyboardKeys.ENTER === e.key || FCUtils.keyboardKeys.SPACE === e.key ) && e.target.closest( _settings.suggestionApplySelector ) ) {\r\n\t\t\t// Simulate click\r\n\t\t\thandleClick( e );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize Mailcheck feature\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) { return; }\r\n\r\n\t\t// Merge settings\r\n\t\t_settings = FCUtils.extendObject( true, _settings, options );\r\n\r\n\t\t// Add event listeners\r\n\t\twindow.addEventListener( 'input', handleTriggerEventsDebounced, true );\r\n\t\twindow.addEventListener( 'click', handleClick, true );\r\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\r\n\r\n\t\t_hasInitialized = true;\r\n\t};\r\n\r\n\t\r\n\t//\r\n\t// Public APIs\r\n\t//\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","MailcheckInit","global","this","window","jQuery","handleSuggested","suggestion","parent","suggestedElementHtml","element","removeSuggestions","_tempTarget","closest","_settings","inputFieldWrapperSelector","suggestionHtml","suggestionTemplate","replaceAll","address","domain","suggestedElementTemplate","full","insertPositionElement","nextSibling","querySelector","errorMessageElementSelector","errorMessageElements","querySelectorAll","length","document","createElement","innerHTML","insertBefore","firstChild","classList","add","mailFieldSuggestedClass","handleClick","e","targetField","target","suggestionApplySelector","preventDefault","suggestionElement","parentFormRow","formFieldWrapperSelector","mailFieldSelector","value","getAttribute","suggestionValueAttr","focus","CheckoutValidation","validateField","handleKeyDown","defaultPrevented","FCUtils","keyboardKeys","ENTER","key","SPACE","_hasInitialized","_publicMethods","suggestionElementSelector","suggestions","i","parentNode","removeChild","remove","handleTriggerEventsDebounced","debounce","undefined","Mailcheck","run","email","suggested","empty","init","options","extendObject","addEventListener"],"mappings":"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"}