{"version":3,"file":"../fc-fragments-refresh-310-beta-2.min.js","sources":["fc-fragments-refresh-310-beta-2.js"],"sourcesContent":["/**\r\n * Manage fragments refres update actions for other pages that don't use the default WooCommerce AJAX events.\r\n *\r\n * DEPENDS ON:\r\n * - jQuery // Interact with WooCommerce events\r\n */\r\n (function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.FCFragmentsRefresh = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _hasJQuery = ( $ != null );\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = {};\r\n\tvar _settings = {\r\n\t\tbodyClass:                             'has-fc-fragments-refresh',\r\n\r\n\t\tdataFormSelector:                      'div.woocommerce form',\r\n\t\tsectionSelector:                       '.fc-section',\r\n\t\tmessagesWrapperSelector:               '.woocommerce-notices-wrapper',\r\n\t\tformRowSelector:                       '.form-row',\r\n\t\tupdateFieldsSelector:                  '.update_totals_on_change input.input-text, .update_totals_on_change select',\r\n\t\tloadingInputSelector:                  '.loading_indicator_on_change input.input-text',\r\n\r\n\t\tsectionVisibleStateFieldSelector:      '.fc-section-visible-state[type=\"hidden\"]',\r\n\t\tsectionVisibleStateAttribute:          'data-section-visible',\r\n\r\n\t\tloadingClass:                           'fc-loading',\r\n\t\tuiProcessingClass:                     'processing',\r\n\r\n\t\tscrollOffsetSelector:                  '.fc-checkout-header',\r\n\t\tscrollBehavior:                        'smooth',\r\n\t\tscrollOffset:                          0,\r\n\r\n\t\tupdateFragmentsNonce:                  '', // Value updated during runtime\r\n\t\tupdateWaitTime:                        500,\r\n\t}\r\n\tvar _xhr = false;\r\n\tvar _debouncedUpdateFragments;\r\n\tvar _fragments = {};\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\r\n\t/**\r\n\t * Get the offset position of the element recursively adding the offset position of parent elements until the `stopElement` (or the `body` element).\r\n\t *\r\n\t * @param   HTMLElement  element      Element to get the offset position for.\r\n\t * @param   HTMLElement  stopElement  Parent element where to stop adding the offset position to the total offset top position of the element.\r\n\t *\r\n\t * @return  int                       Offset position of the element until the `stopElement` or the `body` element.\r\n\t */\r\n\tvar getOffsetTop = function( element, stopElement ) {\r\n\t\tvar offsetTop = 0;\r\n\r\n\t\twhile( element ) {\r\n\t\t\t// Reached the stopElement\r\n\t\t\tif ( stopElement && stopElement == element ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\toffsetTop += element.offsetTop;\r\n\t\t\telement = element.offsetParent;\r\n\t\t}\r\n\t\t\r\n\t\treturn offsetTop;\r\n\t}\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe change visibility status of cart sections.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeChangeSectionState = function( _event, data ) {\r\n\t\tvar sectionElements = document.querySelectorAll( _settings.sectionSelector );\r\n\t\tfor ( var i = 0; i < sectionElements.length; i++ ) {\r\n\t\t\tvar sectionElement = sectionElements[i];\r\n\r\n\t\t\t// Handle visibility state\r\n\t\t\tvar visibilityHiddenField = sectionElement.querySelector( _settings.sectionVisibleStateFieldSelector );\r\n\t\t\tif ( visibilityHiddenField && 'no' === visibilityHiddenField.value ) {\r\n\t\t\t\tsectionElement.setAttribute( _settings.sectionVisibleStateAttribute, visibilityHiddenField.value );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsectionElement.removeAttribute( _settings.sectionVisibleStateAttribute );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe set the focus back to the element with focus previously to fragments replacement.\r\n\t *\r\n\t * @param   HTMLElement  focusedElement  The current focused element.\r\n\t * @param   mixed        value           Value for the current focused element.\r\n\t */\r\n\tvar maybeRefocusElement = function( focusedElement, value ) {\r\n\t\t// Bail if no element to focus\r\n\t\tif ( null === focusedElement ) { return; }\r\n\r\n\t\trequestAnimationFrame( function() {\r\n\t\t\tvar elementToFocus;\r\n\r\n\t\t\t// Try findind the the current focused element after updating updated element by ID\r\n\t\t\tif ( focusedElement.id ) {\r\n\t\t\t\telementToFocus = document.getElementById( focusedElement.id );\r\n\t\t\t}\r\n\t\t\t// Try findind the updated element by name\r\n\t\t\telse if ( focusedElement.getAttribute( 'name' ) ) {\r\n\t\t\t\tvar nameAttr = focusedElement.getAttribute( 'name' );\r\n\t\t\t\telementToFocus = document.querySelector( '[name=\"'+nameAttr+'\"]' );\r\n\t\t\t}\r\n\t\t\t// Try findind the `select2` focusable element\r\n\t\t\telse if ( focusedElement.closest( '.form-row' ) ) {\r\n\t\t\t\tvar formRow = focusedElement.closest( '.form-row' );\r\n\t\t\t\tif ( formRow.id ) {\r\n\t\t\t\t\telementToFocus = document.querySelector( '.form-row[id=\"'+formRow.id+'\"] .select2-selection' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Try setting focus if element is found\r\n\t\t\tif ( elementToFocus ) {\r\n\t\t\t\telementToFocus.focus();\r\n\r\n\t\t\t\t// Try to set current value to the focused element\r\n\t\t\t\tif ( null !== value && value !== elementToFocus.value ) {\r\n\t\t\t\t\telementToFocus.value = value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set keyboard track position back to that previously to update\r\n\t\t\t\tsetTimeout( function(){\r\n\t\t\t\t\t// Try to set the same track position\r\n\t\t\t\t\tif( null !== elementToFocus.selectionStart && null !== elementToFocus.selectionEnd ) {\r\n\t\t\t\t\t\tif ( focusedElement.selectionStart && focusedElement.selectionEnd ) {\r\n\t\t\t\t\t\t\telementToFocus.selectionStart = focusedElement.selectionStart;\r\n\t\t\t\t\t\t\telementToFocus.selectionEnd = focusedElement.selectionEnd;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Otherwise try set the track position to the end of the field\r\n\t\t\t\t\t\t// @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange\r\n\t\t\t\t\t\t// @see https://html.spec.whatwg.org/multipage/input.html#concept-input-apply\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\telementToFocus.selectionStart = elementToFocus.selectionEnd = Number.MAX_SAFE_INTEGER || 10000;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Try to select the entire content of the field\r\n\t\t\t\t\t// @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/select\r\n\t\t\t\t\t// @see https://html.spec.whatwg.org/multipage/input.html#concept-input-apply\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttry { elementToFocus.select(); }\r\n\t\t\t\t\t\tcatch { /* Do nothing */ }\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 0 );\r\n\t\t\t}\r\n\t\t} );\r\n\t};\r\n\r\n\r\n\r\n\t// CHANGE: Maybe add loading class to the form row\r\n\tvar maybeSetLoadingIndicator = function ( e ) {\r\n\t\tif ( e.target && e.target.matches( _settings.loadingInputSelector ) ) {\r\n\t\t\tvar formRow = e.target.closest( _settings.formRowSelector );\r\n\t\t\tif ( formRow ) {\r\n\t\t\t\tformRow.classList.add( _settings.loadingClass );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// CHANGE: Add function to remove loading classes from elements after updating the checkout fragments\r\n\tvar maybeStopLoadingIndicators = function() {\r\n\t\tvar maybeLoadingFields = document.querySelectorAll( _settings.loadingInputSelector );\r\n\t\tfor ( var i = 0; i < maybeLoadingFields.length; i++ ) {\r\n\t\t\tvar input = maybeLoadingFields[ i ];\r\n\t\t\tvar formRow = input.closest( _settings.formRowSelector );\r\n\t\t\tif ( formRow ) {\r\n\t\t\t\tformRow.classList.remove( _settings.loadingClass );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the cart fragments.\r\n\t * @throws  {TypeError}  Throws TypeError when used directly with event handlers because events pass the Event object as the first parameter while this function expects the first parameter to be the extra data to be sent with the AJAX request.\r\n\t */\r\n\t_publicMethods.updateFragments = function() {\r\n\t\t// Cancel existing update request\r\n\t\tif ( _xhr ) { _xhr.abort(); }\r\n\r\n\t\t// Get data to send\r\n\t\tvar data = FCUtils.extendObject( data, {\r\n\t\t\tsecurity:     _settings.updateFragmentsNonce,\r\n\t\t\tpost_data :   $( _settings.dataFormSelector ).serialize(),\r\n\t\t} );\r\n\r\n\t\t_xhr = $.ajax({\r\n\t\t\ttype:\t\t'POST',\r\n\t\t\turl:\t\tfcSettings.wcAjaxUrl.toString().replace( '%%endpoint%%', 'fc_update_fragments' ),\r\n\t\t\tdata:\t\tdata,\r\n\t\t\tsuccess:\tfunction( result ) {\r\n\r\n\t\t\t\t// Reload the page if requested\r\n\t\t\t\tif ( result && true === result.reload ) {\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get current element with focus, will reset after updating the fragments\r\n\t\t\t\tvar currentFocusedElement = document.activeElement;\r\n\t\t\t\tvar currentValue = document.activeElement.value;\r\n\r\n\t\t\t\t// Always update the fragments\r\n\t\t\t\tif ( result && result.fragments ) {\r\n\r\n\t\t\t\t\t$.each( result.fragments, function ( key, value ) {\r\n\t\t\t\t\t\t// CHANGE: Declare local variables needed for some checks before replacing the fragment\r\n\t\t\t\t\t\tvar fragmentToReplace = document.querySelector( key );\r\n\t\t\t\t\t\tvar replaceFragment = true;\r\n\r\n\t\t\t\t\t\t// CHANGE: Allow fragments to be replaced every time even when their contents are equal the existing elements in the DOM\r\n\t\t\t\t\t\tif ( value && -1 !== value.toString().indexOf( 'fc-fragment-always-replace' ) ) {\r\n\t\t\t\t\t\t\treplaceFragment = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// CHANGE: Allow fragments to be replaced every time even when their contents are equal the existing elements in the DOM\r\n\t\t\t\t\t\tif ( replaceFragment && ( ! _fragments || _fragments[ key ] !== value ) ) {\r\n\t\t\t\t\t\t\t// CHANGE: Log replaced fragment to console if debug mode is enabled.\r\n\t\t\t\t\t\t\tif ( fcSettings.debugMode ) {\r\n\t\t\t\t\t\t\t\tconsole.log( 'Replacing fragment: ' + key );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$( key ).replaceWith( value );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$( key ).unblock();\r\n\t\t\t\t\t} );\r\n\t\t\t\t\t_fragments = result.fragments;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Re-set focus to the element with focus previously to updating fragments\r\n\t\t\t\tmaybeRefocusElement( currentFocusedElement, currentValue );\r\n\r\n\t\t\t\t// Maybe remove loading class from form rows when completing the ajax request\r\n\t\t\t\tmaybeStopLoadingIndicators();\r\n\r\n\t\t\t\t// Maybe scroll to notices\r\n\t\t\t\tvar messagesWrapper = document.querySelector( _settings.messagesWrapperSelector );\r\n\t\t\t\tif ( messagesWrapper && messagesWrapper.children.length > 0 ) {\r\n\t\t\t\t\t_publicMethods.scrollToNotices( messagesWrapper );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$( document.body ).trigger( 'fc_fragments_refreshed' );\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Change scroll position after changing steps.\r\n\t */\r\n\t_publicMethods.scrollToNotices = function() {\r\n\t\tvar element = document.querySelector( _settings.messagesWrapperSelector );\r\n\t\tvar stickyElementsOffset = 0;\r\n\r\n\t\t// Maybe add sticky elements height to scroll position\r\n\t\tif ( window.StickyStates ) {\r\n\t\t\tvar maybeStickyElements = document.querySelectorAll( _settings.scrollOffsetSelector );\r\n\t\t\tif ( maybeStickyElements && maybeStickyElements.length > 0 ) {\r\n\t\t\t\tfor ( var i = 0; i < maybeStickyElements.length; i++ ) {\r\n\t\t\t\t\tvar stickyElement = maybeStickyElements[i];\r\n\t\t\t\t\tif ( StickyStates.isStickyPosition( stickyElement ) ) {\r\n\t\t\t\t\t\tvar height = stickyElement.getBoundingClientRect().height;\r\n\t\t\t\t\t\tstickyElementsOffset += height;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Scroll to the top of the collapsed step\r\n\t\tvar elementOffset = getOffsetTop( element ) + ( _settings.scrollOffset * -1 ) + ( stickyElementsOffset * -1 );\r\n\t\trequestAnimationFrame( function() {\r\n\t\t\twindow.scrollTo( {\r\n\t\t\t\ttop: elementOffset,\r\n\t\t\t\tbehavior: _settings.scrollBehavior,\r\n\t\t\t} );\r\n\t\t} );\r\n\t}\r\n\r\n\t\r\n\r\n\t/**\r\n\t * Use the same method that WooCommerce uses to block other parts of the checkout form while updating.\r\n\t * The UI is unblocked by the WooCommerce `checkout.js` script (which is replaced with a modified version but keeps the same behavior)\r\n\t * using the checkout fragment selector, then unblocking after the checkout update is completed.\r\n\t *\r\n\t * @param   HTMLElement  element  Element to block the UI and show the loading indicator.\r\n\t */\r\n\t_publicMethods.blockUI = function( element ) {\r\n\t\t$( element ).addClass( _settings.uiProcessingClass ).block( {\r\n\t\t\tmessage: null,\r\n\t\t\toverlayCSS: {\r\n\t\t\t\tbackground: '#fff',\r\n\t\t\t\topacity: 0.6\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\t/**\r\n\t * Unblock UI element to be used again.\r\n\t *\r\n\t * @param   HTMLElement  element  Element to get the UI unblocked.\r\n\t *\r\n\t * @see  blockUI\r\n\t */\r\n\t_publicMethods.unblockUI = function( element ) {\r\n\t\t$( element ).removeClass( _settings.uiProcessingClass ).unblock();\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle form field change event and route to the appropriate function.\r\n\t */\r\n\tvar handleChange = function( e ) {\r\n\t\t// LOADING INDICATOR\r\n\t\tmaybeSetLoadingIndicator( e );\r\n\r\n\t\t// UPDATE ON CHANGE\r\n\t\tif ( e.target.matches( _settings.updateFieldsSelector ) ) {\r\n\t\t\t_debouncedUpdateFragments();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * Handle keypress event.\r\n\t */\r\n\tvar handleKeyDown = function( e ) {\r\n\t\t// Should do nothing if the default action has been cancelled\r\n\t\tif ( e.defaultPrevented ) { return; }\r\n\r\n\t\t// Bail if control keys pressed\r\n\t\tif (\r\n\t\t\tFCUtils.keyboardKeys.ESC === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ENTER === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.TAB === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.CAPS === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.SHIFT === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.FUNCTION === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.CONTROL === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.COMMAND_OR_WINDOWS === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ALT === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ARROW_LEFT === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ARROW_RIGHT === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ARROW_UP === e.key\r\n\t\t\t|| FCUtils.keyboardKeys.ARROW_DOWN === e.key\r\n\t\t) { return; }\r\n\r\n\t\t// LOADING INDICATOR\r\n\t\tmaybeSetLoadingIndicator( e );\r\n\r\n\t\t// UPDATE ON CHANGE\r\n\t\tif ( e.target.matches( _settings.updateFieldsSelector ) ) {\r\n\t\t\t_debouncedUpdateFragments();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize component and set related handlers.\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) return;\r\n\r\n\t\t// Merge settings\r\n\t\t_settings = FCUtils.extendObject( _settings, options );\r\n\r\n\t\t// Set debounced update fragments function\r\n\t\t_debouncedUpdateFragments = FCUtils.debounce( _publicMethods.updateFragments, _settings.updateWaitTime );\r\n\r\n\t\t// Add jQuery event listeners\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t// Refresh triggers\r\n\t\t\t$( document.body ).on( 'fc_fragment_refresh', _debouncedUpdateFragments );\r\n\r\n\t\t\t// After fragments has been updated\r\n\t\t\t$( document.body ).on( 'fc_fragments_refreshed', maybeChangeSectionState );\r\n\t\t}\r\n\r\n\t\t// Refresh triggers\r\n\t\twindow.addEventListener( 'change', handleChange );\r\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\r\n\r\n\t\t// Add init class\r\n\t\tdocument.body.classList.add( _settings.bodyClass );\r\n\r\n\t\t_hasInitialized = true;\r\n\t};\r\n\r\n\r\n\r\n\t//\r\n\t// Public APIs\r\n\t//\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","FCFragmentsRefresh","global","this","window","maybeChangeSectionState","_event","data","sectionElements","document","querySelectorAll","_settings","sectionSelector","i","length","sectionElement","visibilityHiddenField","querySelector","sectionVisibleStateFieldSelector","value","setAttribute","sectionVisibleStateAttribute","removeAttribute","maybeSetLoadingIndicator","e","target","matches","loadingInputSelector","formRow","closest","formRowSelector","classList","add","loadingClass","handleChange","updateFieldsSelector","_debouncedUpdateFragments","handleKeyDown","defaultPrevented","FCUtils","keyboardKeys","ESC","key","ENTER","TAB","CAPS","SHIFT","FUNCTION","CONTROL","COMMAND_OR_WINDOWS","ALT","ARROW_LEFT","ARROW_RIGHT","ARROW_UP","ARROW_DOWN","$","jQuery","_hasJQuery","_hasInitialized","_publicMethods","bodyClass","dataFormSelector","messagesWrapperSelector","uiProcessingClass","scrollOffsetSelector","scrollBehavior","scrollOffset","updateFragmentsNonce","updateWaitTime","_xhr","_fragments","updateFragments","abort","extendObject","security","post_data","serialize","ajax","type","url","fcSettings","wcAjaxUrl","toString","replace","success","result","reload","location","focusedElement","currentFocusedElement","activeElement","currentValue","fragments","each","replaceFragment","indexOf","debugMode","console","log","replaceWith","unblock","requestAnimationFrame","elementToFocus","id","getElementById","getAttribute","nameAttr","focus","setTimeout","selectionStart","selectionEnd","Number","MAX_SAFE_INTEGER","select","maybeLoadingFields","remove","messagesWrapper","children","scrollToNotices","body","trigger","element","stickyElementsOffset","StickyStates","maybeStickyElements","stickyElement","isStickyPosition","getBoundingClientRect","height","elementOffset","stopElement","offsetTop","offsetParent","scrollTo","top","behavior","blockUI","addClass","block","message","overlayCSS","background","opacity","unblockUI","removeClass","init","options","debounce","on","addEventListener"],"mappings":"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"}