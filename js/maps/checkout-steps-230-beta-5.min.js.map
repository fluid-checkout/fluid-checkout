{"version":3,"file":"../checkout-steps-230-beta-5.min.js","sources":["checkout-steps-230-beta-5.js"],"sourcesContent":["/**\r\n * Manage checkout steps state.\r\n *\r\n * DEPENDS ON:\r\n * - jQuery // Interact with WooCommerce events\r\n */\r\n(function (root, factory) {\r\n\tif ( typeof define === 'function' && define.amd ) {\r\n\t\tdefine([], factory(root));\r\n\t} else if ( typeof exports === 'object' ) {\r\n\t\tmodule.exports = factory(root);\r\n\t} else {\r\n\t\troot.CheckoutSteps = factory(root);\r\n\t}\r\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\r\n\r\n\t'use strict';\r\n\r\n\tvar $ = jQuery;\r\n\tvar _hasJQuery = ( $ != null );\r\n\r\n\tvar _hasInitialized = false;\r\n\tvar _publicMethods = {};\r\n\tvar _settings = {\r\n\t\tbodyClass: 'has-fc-checkout-steps',\r\n\t\tbodyClassActiveStepPattern: 'fc-checkout-step--active-{ID}',\r\n\r\n\t\tisMultistepLayout: 'yes',\r\n\t\tmaybeDisablePlaceOrderButton: 'yes',\r\n\r\n\t\twrapperSelector: '.fc-wrapper',\r\n\r\n\t\tprogressBarSelector: '.fc-progress-bar',\r\n\t\tprogressBarCurrentSelector: '.fc-progress-bar__current-step',\r\n\t\tprogressBarItemSelector: '.fc-progress-bar__bar',\r\n\r\n\t\tstepsWrapperSelector: '.fc-checkout-steps',\r\n\t\tstepSelector: '.fc-checkout-step',\r\n\t\tcurrentStepSelector: '[data-step-current]',\r\n\t\tlastStepSelector: '[data-step-last]',\r\n\t\tnextStepSelector: '[data-step-current] ~ .fc-checkout-step',\r\n\t\tnextStepButtonSelector: '[data-step-next]',\r\n\t\tfocusableElementsSelector: 'a[role=\"button\"], a[href], button:not([disabled]), input:not([disabled]):not([type=\"hidden\"]), textarea:not([disabled]), select:not([disabled]), details, summary, iframe, object, embed, [contenteditable] [tabindex]:not([tabindex=\"-1\"])',\r\n\r\n\t\tfieldSubmitFormSelector: 'input[type=\"text\"], input[type=\"checkbox\"], input[type=\"color\"], input[type=\"date\"], input[type=\"datetime\"], input[type=\"datetime-local\"], input[type=\"email\"], input[type=\"file\"], input[type=\"image\"], input[type=\"month\"], input[type=\"number\"], input[type=\"password\"], input[type=\"radio\"], input[type=\"search\"], input[type=\"tel\"], input[type=\"time\"], input[type=\"url\"], input[type=\"week\"]',\r\n\r\n\t\tsubstepSelector: '.fc-step__substep',\r\n\t\tsubstepTextContentSelector: '.fc-step__substep-text-content',\r\n\t\tsubstepFieldsSelector: '.fc-step__substep-fields',\r\n\t\tsubstepTextSelector: '.fc-step__substep-text',\r\n\t\tsubstepEditButtonSelector: '[data-step-edit]',\r\n\t\tsubstepSaveButtonSelector: '[data-step-save]',\r\n\r\n\t\texpansibleSectionToggleSelector: '[data-expansible-section-toggle]',\r\n\t\texpansibleSectionExpandAttribute: 'data-expansible-section-expand',\r\n\t\texpansibleSectionCollapseAttribute: 'data-expansible-section-collapse',\r\n\r\n\t\tstepCompleteAttribute: 'data-step-complete',\r\n\t\tstepCurrentAttribute: 'data-step-current',\r\n\t\tstepIndexAttribute: 'data-step-index',\r\n\t\tstepIdAttribute: 'data-step-id',\r\n\r\n\t\tisEditingClass: 'is-editing',\r\n\t\tisLoadingClass: 'is-loading',\r\n\t\tisCurrentClass: 'is-current',\r\n\t\tisCompleteClass: 'is-complete',\r\n\t\tstepNextIncompleteClass: 'fc-checkout-step--next-step-incomplete',\r\n\t\tcurrentStepClassTemplate: 'fc-checkout-step-current--##STEP_ID##',\r\n\t\tcurrentLastStepClass: 'fc-checkout-step-current-last',\r\n\r\n\t\tsubstepEditableStateFieldSelector: '.fc-substep-editable-state[type=\"hidden\"]',\r\n\t\tsubstepEditableStateAttribute: 'data-substep-editable',\r\n\t\tsubstepVisibleStateFieldSelector: '.fc-substep-visible-state[type=\"hidden\"]',\r\n\t\tsubstepVisibleStateAttribute: 'data-substep-visible',\r\n\r\n\t\tinvalidFieldRowSelector: '.woocommerce-invalid .input-text, .woocommerce-invalid select',\r\n\r\n\t\tplaceOrderButtonSelector: '.fc-place-order-button',\r\n\t\tplaceOrderSkipMoveSelector: '.has-place-order--below_order_summary',\r\n\t\tplaceOrderSectionMainSelector: '.fc-place-order__section--main',\r\n\t\tplaceOrderPlaceholderMainSelector: '.fc-inside .fc-place-order__section-placeholder',\r\n\t\tplaceOrderPlaceholderSidebarSelector: '.fc-sidebar .fc-place-order__section-placeholder',\r\n\t\tplaceOrderRefreshRate: 50,\r\n\r\n\t\tscrollOffsetSelector: '.fc-checkout-header',\r\n\t\tscrollBehavior: 'smooth',\r\n\t\tscrollOffset: 0,\r\n\t\tscrollDelay: 50,\r\n\t}\r\n\tvar _key = {\r\n\t\tENTER: 'Enter',\r\n\t\tSPACE: ' ',\r\n\t}\r\n\tvar _resizeObserver;\r\n\r\n\r\n\r\n\t/**\r\n\t * METHODS\r\n\t */\r\n\r\n\r\n\r\n\t/*!\r\n\t* Merge two or more objects together.\r\n\t* (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com\r\n\t* @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]\r\n\t* @param   {Object}   objects  The objects to merge together\r\n\t* @returns {Object}            Merged values of defaults and options\r\n\t*/\r\n\tvar extend = function () {\r\n\t\t// Variables\r\n\t\tvar extended = {};\r\n\t\tvar deep = false;\r\n\t\tvar i = 0;\r\n\r\n\t\t// Check if a deep merge\r\n\t\tif ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {\r\n\t\t\tdeep = arguments[0];\r\n\t\t\ti++;\r\n\t\t}\r\n\r\n\t\t// Merge the object into the extended object\r\n\t\tvar merge = function (obj) {\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (obj.hasOwnProperty(prop)) {\r\n\t\t\t\t\t// If property is an object, merge properties\r\n\t\t\t\t\tif (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n\t\t\t\t\t\textended[prop] = extend(extended[prop], obj[prop]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\textended[prop] = obj[prop];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Loop through each object and conduct a merge\r\n\t\tfor (; i < arguments.length; i++) {\r\n\t\t\tvar obj = arguments[i];\r\n\t\t\tmerge(obj);\r\n\t\t}\r\n\r\n\t\treturn extended;\r\n    };\r\n\r\n\r\n\r\n\t/**\r\n\t * Returns a function, that, as long as it continues to be invoked, will not\r\n\t * be triggered. The function will be called after it stops being called for\r\n\t * N milliseconds. If `immediate` is passed, trigger the function on the\r\n\t * leading edge, instead of the trailing.\r\n\t *\r\n\t * @param   {[type]}  func       Function to be executed.\r\n\t * @param   {[type]}  wait       Wait time in milliseconds.\r\n\t * @param   {[type]}  immediate  Trigger the function on the leading edge.\r\n\t *\r\n\t * @return  function              Function to be executed, incapsulated in a timed function.\r\n\t */\r\n\tvar _debounce = function ( func, wait, immediate ) {\r\n\t\tvar timeout;\r\n\r\n\t\treturn function() {\r\n\t\t  var context = this, args = arguments;\r\n\t\t  var later = function() {\r\n\t\t\ttimeout = null;\r\n\t\t\tif (!immediate) func.apply( context, args );\r\n\t\t  };\r\n\r\n\t\t  var callNow = immediate && !timeout;\r\n\t\t  clearTimeout( timeout );\r\n\t\t  timeout = setTimeout( later, wait );\r\n\r\n\t\t  if ( callNow ) func.apply( context, args );\r\n\t\t};\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Check if the element is considered visible. Does not consider the CSS property `visibility: hidden;`.\r\n\t */\r\n\tvar isVisible = function( element ) {\r\n\t\treturn !!( element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Gets keyboard-focusable elements within a specified element\r\n\t *\r\n\t * @param   HTMLElement  element  The element to search within. Defaults to the `document` root element.\r\n\t *\r\n\t * @return  NodeList              All focusable elements withing the element passed in.\r\n\t */\r\n\tvar getFocusableElements = function( element ) {\r\n\t\t// Set element to `document` root if not passed in\r\n\t\tif ( ! element ) { element = document; }\r\n\t\t\r\n\t\t// Get elements that are keyboard-focusable, but might be `disabled`\r\n\t\treturn element.querySelectorAll( _settings.focusableElementsSelector );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get the offset position of the element recursively adding the offset position of parent elements until the `stopElement` (or the `body` element).\r\n\t *\r\n\t * @param   HTMLElement  element      Element to get the offset position for.\r\n\t * @param   HTMLElement  stopElement  Parent element where to stop adding the offset position to the total offset top position of the element.\r\n\t *\r\n\t * @return  int                       Offset position of the element until the `stopElement` or the `body` element.\r\n\t */\r\n\tvar getOffsetTop = function( element, stopElement ) {\r\n\t\tvar offsetTop = 0;\r\n\t\t\r\n\t\twhile( element ) {\r\n\t\t\t// Reached the stopElement\r\n\t\t\tif ( stopElement && stopElement == element ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\toffsetTop += element.offsetTop;\r\n\t\t\telement = element.offsetParent;\r\n\t\t}\r\n\t\t\r\n\t\treturn offsetTop;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get all step elements.\r\n\t *\r\n\t * @return  Array  List of step elements.\r\n\t */\r\n\tvar getAllSteps = function() {\r\n\t\tvar stepsWrapper = document.querySelector( _settings.stepsWrapperSelector );\r\n\r\n\t\t// Bail if steps wrapper not found, returns empty `Array`.\r\n\t\tif ( ! stepsWrapper ) { return []; }\r\n\r\n\t\treturn Array.from( stepsWrapper.querySelectorAll( _settings.stepSelector ) );\r\n\t}\r\n\r\n\r\n\r\n\r\n\t/**\r\n\t * Expand the substep fields for edition, and collapse the substep values in text format.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar expandSubstepEdit = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.expand( substepFieldsElement );\r\n\t\tCollapsibleBlock.collapse( substepTextElement );\r\n\r\n\t\t// Add editing class to the substep element\r\n\t\tsubstepElement.classList.add( _settings.isEditingClass );\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar collapseSubstepEdit = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\r\n\t\tvar substepFieldsElement = substepElement.querySelector( _settings.substepFieldsSelector );\r\n\t\tvar substepTextElement = substepElement.querySelector( _settings.substepTextSelector );\r\n\r\n\t\t// Change expanded/collapsed states for the fields and text blocks\r\n\t\tCollapsibleBlock.collapse( substepFieldsElement );\r\n\t\tCollapsibleBlock.expand( substepTextElement );\r\n\r\n\t\t// Remove editing class from the substep element\r\n\t\tsubstepElement.classList.remove( _settings.isEditingClass );\r\n\r\n\t\t// Focus on the substep edit button\r\n\t\tvar editbutton = substepElement.querySelector( _settings.substepEditButtonSelector );\r\n\t\tif ( editbutton ) {\r\n\t\t\teditbutton.focus();\r\n\t\t}\r\n\r\n\t\t// Change scroll position after collapsing substep\r\n\t\tscrollTo( substepElement );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Use the same method that WooCommerce uses to block other parts of the checkout form while updating.\r\n\t * The UI is unblocked by the WooCommerce `checkout.js` script (which is replaced with a modified version but keeps the same behavior)\r\n\t * using the checkout fragment selector, then unblocking after the checkout update is completed.\r\n\t *\r\n\t * @param   HTMLElement  element  Element to block the UI and show the loading indicator.\r\n\t */\r\n\tvar blockUI = function( element ) {\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( element ).block( {\r\n\t\t\t\tmessage: null,\r\n\t\t\t\toverlayCSS: {\r\n\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\topacity: 0.6\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe remove `is-loading` class from fragments after checkout update.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeRemoveFragmentsLoadingClass = function( _event, data ) {\r\n\t\t// Iterate fragments\r\n\t\tif ( data && data.fragments ) {\r\n\t\t\tfor ( var key in data.fragments ) {\r\n\t\t\t\t// Try to get the target fragment element\r\n\t\t\t\tvar framentElement = document.querySelector( key );\r\n\t\t\t\tif ( framentElement ) {\r\n\t\t\t\t\t// Remove `is-loading` class from the fragment element\r\n\t\t\t\t\tframentElement.classList.remove( _settings.isLoadingClass );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar maybeSaveSubstep = function( substepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! substepElement ) { return; }\r\n\t\t\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( substepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = substepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Collapse substep fields and display step in text format\r\n\t\tcollapseSubstepEdit( substepElement );\r\n\r\n\t\t// Update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tblockUI( contentElement );\r\n\r\n\t\t\t// Remove messages prior to updating\r\n\t\t\t$( '.woocommerce-error, .woocommerce-message' ).remove();\r\n\r\n\t\t\t// Trigger update checkout\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the progress bar state.\r\n\t */\r\n\tvar updateProgressBar = function() {\r\n\t\t// Get current step\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\t\r\n\t\t// Bail if no current step was found\r\n\t\tif ( ! currentStepElement ) { return; }\r\n\r\n\t\t// Get index of the current step\r\n\t\tvar currentStepIndex = parseInt( currentStepElement.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\tcurrentStepIndex = isNaN( currentStepIndex ) ? -1 : currentStepIndex;\r\n\r\n\t\t// Get progress bar items\r\n\t\tvar progressBarElement = document.querySelector( _settings.progressBarSelector )\r\n\r\n\t\t// Bail if progress bar element not found\r\n\t\tif ( ! progressBarElement ) { return; }\r\n\r\n\t\tvar progressBarItems = progressBarElement.querySelectorAll( _settings.progressBarItemSelector );\r\n\t\tvar progressBarItemsCount = progressBarItems.length;\r\n\r\n\t\t// Update progress bar items status\r\n\t\tfor ( var i = 0; i < progressBarItems.length; i++ ) {\r\n\t\t\tvar bar = progressBarItems[i];\r\n\t\t\tvar stepIndex = parseInt( bar.getAttribute( _settings.stepIndexAttribute ) );\r\n\t\t\tstepIndex = isNaN( stepIndex ) ? -1 : stepIndex;\r\n\r\n\t\t\t// Update the `current` status for each progress bar item\r\n\t\t\tif ( stepIndex == currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCurrentClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCurrentClass );\r\n\t\t\t}\r\n\r\n\t\t\t// Update the `complete` status for each progress bar item\r\n\t\t\tif ( stepIndex <= currentStepIndex ) {\r\n\t\t\t\tbar.classList.add( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbar.classList.remove( _settings.isCompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Calculate the current step text value\r\n\t\tvar currentStepValue = currentStepIndex + 1;\r\n\t\tcurrentStepValue = currentStepValue <= progressBarItemsCount ? currentStepValue : progressBarItemsCount;\r\n\r\n\t\t// Change value of the current step text indicator\r\n\t\tvar currentStepTextElement = progressBarElement.querySelector( _settings.progressBarCurrentSelector );\r\n\t\tif ( currentStepTextElement ) {\r\n\t\t\tcurrentStepTextElement.innerText = currentStepValue;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Get the scroll offset position for the sticky elements.\r\n\t */\r\n\tvar getStickyElementsOffset = function() {\r\n\t\tvar stickyElementsOffset = 0;\r\n\r\n\t\t// Maybe add height of the progress bar to scroll position\r\n\t\tvar progressBarElement = document.querySelector( _settings.progressBarSelector );\r\n\t\tif ( progressBarElement ) {\r\n\t\t\tvar height = progressBarElement.getBoundingClientRect().height;\r\n\t\t\tstickyElementsOffset += height;\r\n\t\t}\r\n\r\n\t\t// Maybe add sticky elements height to scroll position\r\n\t\tif ( window.StickyStates ) {\r\n\t\t\tvar maybeStickyElements = document.querySelectorAll( _settings.scrollOffsetSelector );\r\n\t\t\tif ( maybeStickyElements && maybeStickyElements.length > 0 ) {\r\n\t\t\t\tfor ( var i = 0; i < maybeStickyElements.length; i++ ) {\r\n\t\t\t\t\tvar stickyElement = maybeStickyElements[i];\r\n\t\t\t\t\tif ( StickyStates.isStickyPosition( stickyElement ) ) {\r\n\t\t\t\t\t\tvar height = stickyElement.getBoundingClientRect().height;\r\n\t\t\t\t\t\tstickyElementsOffset += height;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn stickyElementsOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * Change scroll position to top of the element after the sticky elements.\r\n\t *\r\n\t * @param   HTMLElement  element      The element of to scroll to.\r\n\t */\r\n\tvar scrollTo = function( element ) {\r\n\t\t// Bail if step element not provided\r\n\t\tif ( ! element ) { return; }\r\n\r\n\t\tvar stickyElementsOffset = getStickyElementsOffset();\r\n\t\tvar elementOffset = getOffsetTop( element ) + ( _settings.scrollOffset * -1 ) + ( stickyElementsOffset * -1 );\r\n\t\twindow.setTimeout( function() {\r\n\t\t\twindow.scrollTo( {\r\n\t\t\t\ttop: elementOffset,\r\n\t\t\t\tbehavior: _settings.scrollBehavior,\r\n\t\t\t} );\r\n\t\t}, _settings.scrollDelay );\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Collapse the substep fields, and expand the substep values in text format for review.\r\n\t *\r\n\t * @param   HTMLElement  substepElement  Substep element to change the state of.\r\n\t */\r\n\tvar maybeProceedNextStep = function( stepElement ) {\r\n\t\t// Bail if editButton not valid\r\n\t\tif ( ! stepElement ) { return; }\r\n\r\n\t\t// Maybe validate fields\r\n\t\tif ( window.CheckoutValidation && ! CheckoutValidation.validateAllFields( stepElement ) ) {\r\n\t\t\t// Try to focus the first invalid field\r\n\t\t\tvar firstInvalidField = stepElement.querySelector( _settings.invalidFieldRowSelector );\r\n\t\t\tif ( firstInvalidField ) {\r\n\t\t\t\tfirstInvalidField.focus();\r\n\t\t\t}\r\n\r\n\t\t\t// Bail when any substep has invalid fields\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Set current step as complete\r\n\t\tstepElement.setAttribute( _settings.stepCompleteAttribute, '' );\r\n\r\n\t\t// Collapse substeps fields and display step in text format\r\n\t\tvar substepElements = stepElement.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\r\n\t\t\t// Get text content element, then block IU\r\n\t\t\tvar contentElement = substepElement.querySelector( _settings.substepTextContentSelector );\r\n\t\t\tif ( contentElement ) {\r\n\t\t\t\tcontentElement.classList.add( _settings.isLoadingClass );\r\n\t\t\t\tblockUI( contentElement );\r\n\t\t\t}\r\n\r\n\t\t\t// Collapse substep\r\n\t\t\tcollapseSubstepEdit( substepElement );\r\n\t\t}\r\n\r\n\t\t// Get next step, and set it as current\r\n\t\tvar nextStepElement = stepElement.parentElement.querySelector( _settings.nextStepSelector );\r\n\t\tnextStepElement.setAttribute( _settings.stepCurrentAttribute, '' );\r\n\r\n\t\t// Unset `current` from the step that is closing\r\n\t\t// (needs to run after setting the next step as the current one)\r\n\t\tstepElement.removeAttribute( _settings.stepCurrentAttribute );\r\n\r\n\t\t// Remove `next-step-incomplete` class from previous steps\r\n\t\tvar allSteps = getAllSteps();\r\n\t\tvar stepIndex = allSteps.indexOf( stepElement );\r\n\t\tfor ( var i = 0; i < allSteps.length; i++ ) {\r\n\t\t\tif ( i < stepIndex ) {\r\n\t\t\t\tvar step = allSteps[i];\r\n\t\t\t\tstep.classList.remove( _settings.stepNextIncompleteClass );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update progress bar\r\n\t\tupdateProgressBar();\r\n\r\n\t\t// Maybe set focusElement to the first focusable element that is visible\r\n\t\tvar focusElement = null;\r\n\t\tvar focusableElements = Array.from( getFocusableElements( nextStepElement ) );\r\n\t\tfor ( var i = 0; i < focusableElements.length; i++ ) {\r\n\t\t\tvar focusableElement = focusableElements[i];\r\n\t\t\tif ( isVisible( focusableElement ) ) {\r\n\t\t\t\tfocusElement = focusableElement;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set focus\r\n\t\tif ( focusElement ) {\r\n\t\t\tfocusElement.focus();\r\n\t\t}\r\n\r\n\t\t// Change scroll position after moving to next step\r\n\t\tscrollTo( stepElement );\r\n\r\n\t\t// Trigger update checkout\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).trigger( 'update_checkout' );\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the body classes for step states.\r\n\t */\r\n\tvar updateStepBodyClasses = function() {\r\n\t\t// Bail if not using multistep layout\r\n\t\tif ( 'yes' !== _settings.maybeDisablePlaceOrderButton || 'yes' !== _settings.isMultistepLayout ) { return; }\r\n\r\n\t\t// Remove current step class\r\n\t\tvar allSteps = getAllSteps();\r\n\t\tfor ( var i = 0; i < allSteps.length; i++ ) {\r\n\t\t\tvar step = allSteps[i];\r\n\t\t\tvar stepId = step.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar className = _settings.currentStepClassTemplate.replace( '##STEP_ID##', stepId );\r\n\t\t\tdocument.body.classList.remove( className );\r\n\t\t}\r\n\r\n\t\t// Maybe add current step class\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\tvar lastStepElement = document.querySelector( _settings.lastStepSelector );\r\n\t\tif ( currentStepElement ) {\r\n\t\t\tvar stepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\t\r\n\t\t\t// Add current step class\r\n\t\t\tvar className = _settings.currentStepClassTemplate.replace( '##STEP_ID##', stepId );\r\n\t\t\tdocument.body.classList.add( className );\r\n\t\t\t\r\n\t\t\t// Maybe add last step class\r\n\t\t\tif ( lastStepElement ) {\r\n\t\t\t\tvar currentStepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\t\tvar lastStepId = lastStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\t\tif ( lastStepId === currentStepId ) {\r\n\t\t\t\t\tdocument.body.classList.add( _settings.currentLastStepClass );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Maybe disable the place order buttons.\r\n\t */\r\n\tvar maybeDisablePlaceOrderButton = function() {\r\n\t\t// Bail if not using multistep layout\r\n\t\tif ( 'yes' !== _settings.maybeDisablePlaceOrderButton || 'yes' !== _settings.isMultistepLayout ) { return; }\r\n\r\n\t\t// Check if current step is same as last step\r\n\t\tvar currentStepElement = document.querySelector( _settings.currentStepSelector );\r\n\t\tvar lastStepElement = document.querySelector( _settings.lastStepSelector );\r\n\t\tif ( currentStepElement && lastStepElement ) {\r\n\t\t\tvar currentStepId = currentStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar lastStepId = lastStepElement.getAttribute( _settings.stepIdAttribute );\r\n\t\t\tvar isDisabled = currentStepId !== lastStepId;\r\n\r\n\t\t\tvar placeOrderButtons = document.querySelectorAll( _settings.placeOrderButtonSelector );\r\n\t\t\tfor ( var i = 0; i < placeOrderButtons.length; i++ ) {\r\n\t\t\t\tvar button = placeOrderButtons[i];\r\n\t\t\t\tbutton.disabled = isDisabled;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Update the global state of steps.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar updateGlobalStepStates = function( _event, data ) {\r\n\t\tupdateStepBodyClasses();\r\n\t\tmaybeDisablePlaceOrderButton();\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe change visibility status of checkout substep sections.\r\n\t *\r\n\t * @param   Event  _event  An unused `jQuery.Event` object.\r\n\t * @param   Array  data   The updated checkout data.\r\n\t */\r\n\tvar maybeChangeSubstepState = function( _event, data ) {\r\n\t\tvar substepElements = document.querySelectorAll( _settings.substepSelector );\r\n\t\tfor ( var i = 0; i < substepElements.length; i++ ) {\r\n\t\t\tvar substepElement = substepElements[i];\r\n\t\t\t\r\n\t\t\t// Handle editable state\r\n\t\t\tvar editableHiddenField = substepElement.querySelector( _settings.substepEditableStateFieldSelector );\r\n\t\t\tif ( editableHiddenField && 'no' === editableHiddenField.value ) {\r\n\t\t\t\tsubstepElement.setAttribute( _settings.substepEditableStateAttribute, editableHiddenField.value );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsubstepElement.removeAttribute( _settings.substepEditableStateAttribute );\r\n\t\t\t}\r\n\r\n\t\t\t// Handle visibility state\r\n\t\t\tvar visibilityHiddenField = substepElement.querySelector( _settings.substepVisibleStateFieldSelector );\r\n\t\t\tif ( visibilityHiddenField && 'no' === visibilityHiddenField.value ) {\r\n\t\t\t\tsubstepElement.setAttribute( _settings.substepVisibleStateAttribute, visibilityHiddenField.value );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsubstepElement.removeAttribute( _settings.substepVisibleStateAttribute );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Maybe move place order section to order summary for small screens.\r\n\t */\r\n\tvar maybeMovePlaceOrderSection = function() {\r\n\t\t// Bail if displaying the place order only on the sidebar. In this case there is no need to move the sections.\r\n\t\tif ( document.body.matches( _settings.placeOrderSkipMoveSelector ) ) { return; }\r\n\r\n\t\t// Get viewport width\r\n\t\tvar viewportWidth = window.innerWidth;\r\n\r\n\t\t// Get place order sections\r\n\t\tvar placeOrderMain = document.querySelector( _settings.placeOrderSectionMainSelector );\r\n\t\tvar placeOrderPlaceholderMain = document.querySelector( _settings.placeOrderPlaceholderMainSelector );\r\n\t\tvar placeOrderPlaceholderSidebar = document.querySelector( _settings.placeOrderPlaceholderSidebarSelector );\r\n\r\n\t\t// Maybe move to sidebar section\r\n\t\tif ( viewportWidth < 1000 && placeOrderPlaceholderSidebar.parentNode !== placeOrderMain.parentNode ) {\r\n\t\t\tplaceOrderPlaceholderSidebar.parentNode.insertBefore( placeOrderMain, placeOrderPlaceholderSidebar.nextSibling );\r\n\t\t}\r\n\t\t// Maybe move to steps section\r\n\t\telse if ( viewportWidth >= 1000 && placeOrderPlaceholderMain.parentNode !== placeOrderMain.parentNode ) {\r\n\t\t\tplaceOrderPlaceholderMain.parentNode.insertBefore( placeOrderMain, placeOrderPlaceholderMain.nextSibling );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle document clicks and route to the appropriate function.\r\n\t */\r\n\tvar handleClick = function( e ) {\r\n\t\t// NEXT STEP\r\n\t\tif ( e.target.closest( _settings.nextStepButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar step = e.target.closest( _settings.stepSelector );\r\n\t\t\tmaybeProceedNextStep( step );\r\n\t\t}\r\n\t\t// EDIT SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepEditButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\texpandSubstepEdit( substepElement );\r\n\t\t}\r\n\t\t// SAVE SUBSTEP\r\n\t\telse if ( e.target.closest( _settings.substepSaveButtonSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tvar substepElement = e.target.closest( _settings.substepSelector );\r\n\t\t\tmaybeSaveSubstep( substepElement );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Handle keypress event.\r\n\t */\r\n\tvar handleKeyDown = function( e ) {\r\n\t\t// Should do nothing if the default action has been cancelled\r\n\t\tif ( e.defaultPrevented ) { return; }\r\n\r\n\t\t// ENTER or SPACE on handler elements\r\n\t\tif ( ( e.key == _key.ENTER || e.key == _key.SPACE ) && ( e.target.closest( _settings.substepEditButtonSelector ) || e.target.closest( _settings.substepSaveButtonSelector ) ) ) {\r\n\t\t\t// Simulate click\r\n\t\t\thandleClick( e );\r\n\t\t}\r\n\t\telse if ( e.key == _key.ENTER && e.target.closest( _settings.fieldSubmitFormSelector ) ) {\r\n\t\t\te.preventDefault();\r\n\t\t\t// Maybe validate field\r\n\t\t\tif ( window.CheckoutValidation ) {\r\n\t\t\t\tvar field = e.target.closest( _settings.fieldSubmitFormSelector );\r\n\t\t\t\tCheckoutValidation.validateField( field );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t/**\r\n\t * Finish to initialize component and set related handlers.\r\n\t */\r\n\tvar finishInit = function() {\r\n\t\t// Add event listeners\r\n\t\twindow.addEventListener( 'click', handleClick );\r\n\t\tdocument.addEventListener( 'keydown', handleKeyDown, true );\r\n\r\n\t\t// Add jQuery event listeners\r\n\t\tif ( _hasJQuery ) {\r\n\t\t\t$( document.body ).on( 'updated_checkout', updateGlobalStepStates );\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeChangeSubstepState );\r\n\t\t\t$( document.body ).on( 'updated_checkout', maybeRemoveFragmentsLoadingClass );\r\n\t\t}\r\n\r\n\t\t// Add init class\r\n\t\tdocument.body.classList.add( _settings.bodyClass );\r\n\r\n\t\t_hasInitialized = true;\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Initialize component and set related handlers.\r\n\t */\r\n\t_publicMethods.init = function( options ) {\r\n\t\tif ( _hasInitialized ) return;\r\n\r\n\t\t// Merge settings\r\n\t\t_settings = extend( _settings, options );\r\n\r\n\t\t// Maybe move place order section, and initialize resize observers\r\n\t\tmaybeMovePlaceOrderSection();\r\n\t\tif ( window.ResizeObserver ) {\r\n\t\t\t_resizeObserver = new ResizeObserver( _debounce( maybeMovePlaceOrderSection, _settings.placeOrderRefreshRate ) );\r\n\t\t\t_resizeObserver.observe( document.body );\r\n\t\t}\r\n\r\n\t\t// Finish initialization, maybe load dependencies first\r\n\t\tif ( window.CollapsibleBlock ) {\r\n\t\t\tfinishInit();\r\n\t\t}\r\n\t\telse if( window.RequireBundle ) {\r\n\t\t\tRequireBundle.require( [ 'collapsible-block' ], function() { finishInit(); } );\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t//\r\n\t// Public APIs\r\n\t//\r\n\treturn _publicMethods;\r\n\r\n});\r\n"],"names":["root","factory","define","amd","exports","module","CheckoutSteps","global","this","window","extend","extended","deep","i","Object","prototype","toString","call","arguments","length","prop","obj","hasOwnProperty","getAllSteps","stepsWrapper","document","querySelector","_settings","stepsWrapperSelector","Array","from","querySelectorAll","stepSelector","collapseSubstepEdit","substepElement","substepTextElement","editbutton","substepFieldsElement","substepFieldsSelector","substepTextSelector","CollapsibleBlock","collapse","expand","classList","remove","isEditingClass","substepEditButtonSelector","focus","scrollTo","blockUI","element","_hasJQuery","$","block","message","overlayCSS","background","opacity","maybeRemoveFragmentsLoadingClass","_event","data","fragments","key","framentElement","isLoadingClass","stickyElementsOffset","elementOffset","getStickyElementsOffset","getOffsetTop","scrollOffset","setTimeout","top","behavior","scrollBehavior","scrollDelay","updateGlobalStepStates","updateStepBodyClasses","maybeDisablePlaceOrderButton","maybeChangeSubstepState","substepElements","substepSelector","editableHiddenField","substepEditableStateFieldSelector","visibilityHiddenField","value","setAttribute","substepEditableStateAttribute","removeAttribute","substepVisibleStateFieldSelector","substepVisibleStateAttribute","maybeMovePlaceOrderSection","viewportWidth","placeOrderMain","placeOrderPlaceholderMain","placeOrderPlaceholderSidebar","body","matches","placeOrderSkipMoveSelector","innerWidth","placeOrderSectionMainSelector","placeOrderPlaceholderMainSelector","placeOrderPlaceholderSidebarSelector","parentNode","insertBefore","nextSibling","handleKeyDown","e","field","defaultPrevented","_key","ENTER","SPACE","target","closest","substepSaveButtonSelector","fieldSubmitFormSelector","preventDefault","CheckoutValidation","validateField","handleClick","finishInit","addEventListener","on","add","bodyClass","_hasInitialized","jQuery","_publicMethods","bodyClassActiveStepPattern","isMultistepLayout","wrapperSelector","progressBarSelector","progressBarCurrentSelector","progressBarItemSelector","currentStepSelector","lastStepSelector","nextStepSelector","nextStepButtonSelector","focusableElementsSelector","substepTextContentSelector","expansibleSectionToggleSelector","expansibleSectionExpandAttribute","expansibleSectionCollapseAttribute","stepCompleteAttribute","stepCurrentAttribute","stepIndexAttribute","stepIdAttribute","isCurrentClass","isCompleteClass","stepNextIncompleteClass","currentStepClassTemplate","currentLastStepClass","invalidFieldRowSelector","placeOrderButtonSelector","placeOrderRefreshRate","scrollOffsetSelector","stopElement","offsetTop","offsetParent","expandSubstepEdit","maybeSaveSubstep","contentElement","validateAllFields","firstInvalidField","trigger","progressBarElement","getBoundingClientRect","height","StickyStates","maybeStickyElements","stickyElement","isStickyPosition","maybeProceedNextStep","stepElement","nextStepElement","parentElement","allSteps","stepIndex","indexOf","currentStepElement","currentStepIndex","parseInt","getAttribute","isNaN","progressBarItems","progressBarItemsCount","bar","currentStepValue","currentStepTextElement","innerText","focusElement","focusableElements","focusableElement","offsetWidth","offsetHeight","getClientRects","stepId","className","replace","lastStepElement","currentStepId","isDisabled","placeOrderButtons","disabled","step","init","options","func","wait","immediate","timeout","ResizeObserver","context","args","callNow","clearTimeout","apply","observe","RequireBundle","require"],"mappings":"AAMA,CAAA,SAAWA,EAAMC,GACO,YAAlB,OAAOC,QAAyBA,OAAOC,IAC3CD,OAAO,GAAID,EAAY,CAAC,EACM,UAAnB,OAAOG,QAClBC,OAAOD,QAAUH,EAAY,EAE7BD,EAAKM,cAAgBL,EAAY,CAElC,EAAoB,aAAlB,OAAOM,OAAyBA,OAASC,KAAKC,QAAUD,KAAKD,OAAQ,SAAUP,GAEjF,aA8Fa,SAATU,IAEH,IAAIC,EAAW,GACXC,EAAO,CAAA,EACPC,EAAI,EAuBR,IApBwD,qBAAnDC,OAAOC,UAAUC,SAASC,KAAMC,UAAU,EAAG,IACjDN,EAAOM,UAAU,GACjBL,CAAC,IAkBKA,EAAIK,UAAUC,OAAQN,CAAC,GAAI,CAbxBO,EAAAA,KAAAA,EAcT,IAdSA,EADYC,EAeXH,UAAUL,GAdpB,IAASO,KAAQC,EACZA,EAAIC,eAAeF,CAAI,IAEtBR,GAAsD,oBAA9CE,OAAOC,UAAUC,SAASC,KAAKI,EAAID,EAAK,EACnDT,EAASS,GAAQV,EAAOC,EAASS,GAAOC,EAAID,EAAK,EAEjDT,EAASS,GAAQC,EAAID,GAUzB,CAEA,OAAOT,CACL,CA6Fe,SAAdY,IACH,IAAIC,EAAeC,SAASC,cAAeC,EAAUC,oBAAqB,EAG1E,OAAOJ,EAEAK,MAAMC,KAAMN,EAAaO,iBAAkBJ,EAAUK,YAAa,CAAE,EAF5C,EAGhC,CA8B0B,SAAtBC,EAAgCC,GAEnC,IAGIC,EAUAC,EAbGF,IAEHG,EAAuBH,EAAeR,cAAeC,EAAUW,qBAAsB,EACrFH,EAAqBD,EAAeR,cAAeC,EAAUY,mBAAoB,EAGrFC,iBAAiBC,SAAUJ,CAAqB,EAChDG,iBAAiBE,OAAQP,CAAmB,EAG5CD,EAAeS,UAAUC,OAAQjB,EAAUkB,cAAe,GAGtDT,EAAaF,EAAeR,cAAeC,EAAUmB,yBAA0B,IAElFV,EAAWW,MAAM,EAIlBC,EAAUd,CAAe,EAC1B,CAWc,SAAVe,EAAoBC,GAClBC,GACJC,EAAGF,CAAQ,EAAEG,MAAO,CACnBC,QAAS,KACTC,WAAY,CACXC,WAAY,OACZC,QAAS,EACV,CACD,CAAE,CAEJ,CAUuC,SAAnCC,EAA6CC,EAAQC,GAExD,GAAKA,GAAQA,EAAKC,UACjB,IAAM,IAAIC,KAAOF,EAAKC,UAAY,CAE7BE,EAAiBtC,SAASC,cAAeoC,CAAI,EAC5CC,GAEJA,EAAepB,UAAUC,OAAQjB,EAAUqC,cAAe,CAE5D,CAEF,CAyIe,SAAXhB,EAAqBE,GAExB,IAEIe,EACAC,EAHGhB,IAEHe,EAAuBE,EAAwB,EAC/CD,EAAgBE,EAAclB,CAAQ,EAA+B,CAAC,EAA1BvB,EAAU0C,aAA+C,CAAC,EAAxBJ,EAClFxD,OAAO6D,WAAY,WAClB7D,OAAOuC,SAAU,CAChBuB,IAAKL,EACLM,SAAU7C,EAAU8C,cACrB,CAAE,CACH,EAAG9C,EAAU+C,WAAY,EAC1B,CAgK6B,SAAzBC,EAAmChB,EAAQC,GAC9CgB,EAAsB,EACtBC,EAA6B,CAC9B,CAU8B,SAA1BC,EAAoCnB,EAAQC,GAE/C,IADA,IAAImB,EAAkBtD,SAASM,iBAAkBJ,EAAUqD,eAAgB,EACjEnE,EAAI,EAAGA,EAAIkE,EAAgB5D,OAAQN,CAAC,GAAK,CAClD,IAAIqB,EAAiB6C,EAAgBlE,GAGjCoE,EAAsB/C,EAAeR,cAAeC,EAAUuD,iCAAkC,EAShGC,GARCF,GAAuB,OAASA,EAAoBG,MACxDlD,EAAemD,aAAc1D,EAAU2D,8BAA+BL,EAAoBG,KAAM,EAGhGlD,EAAeqD,gBAAiB5D,EAAU2D,6BAA8B,EAI7CpD,EAAeR,cAAeC,EAAU6D,gCAAiC,GAChGL,GAAyB,OAASA,EAAsBC,MAC5DlD,EAAemD,aAAc1D,EAAU8D,6BAA8BN,EAAsBC,KAAM,EAGjGlD,EAAeqD,gBAAiB5D,EAAU8D,4BAA6B,CAEzE,CACD,CAOiC,SAA7BC,IAEH,IAGIC,EAGAC,EACAC,EACAC,EARCrE,SAASsE,KAAKC,QAASrE,EAAUsE,0BAA2B,IAG7DN,EAAgBlF,OAAOyF,WAGvBN,EAAiBnE,SAASC,cAAeC,EAAUwE,6BAA8B,EACjFN,EAA4BpE,SAASC,cAAeC,EAAUyE,iCAAkC,EAChGN,EAA+BrE,SAASC,cAAeC,EAAU0E,oCAAqC,EAGrGV,EAAgB,KAAQG,EAA6BQ,aAAeV,EAAeU,WACvFR,EAA6BQ,WAAWC,aAAcX,EAAgBE,EAA6BU,WAAY,EAGrF,KAAjBb,GAAyBE,EAA0BS,aAAeV,EAAeU,YAC1FT,EAA0BS,WAAWC,aAAcX,EAAgBC,EAA0BW,WAAY,EAE3G,CAiCoB,SAAhBC,EAA0BC,GAE7B,IAWMC,EAXDD,EAAEE,mBAGAF,EAAE5C,KAAO+C,EAAKC,OAASJ,EAAE5C,KAAO+C,EAAKE,OAAaL,CAAAA,EAAEM,OAAOC,QAAStF,EAAUmB,yBAA0B,GAAK4D,CAAAA,EAAEM,OAAOC,QAAStF,EAAUuF,yBAA0B,EAIhKR,EAAE5C,KAAO+C,EAAKC,OAASJ,EAAEM,OAAOC,QAAStF,EAAUwF,uBAAwB,IACpFT,EAAEU,eAAe,EAEZ3G,OAAO4G,sBACPV,EAAQD,EAAEM,OAAOC,QAAStF,EAAUwF,uBAAwB,EAChEE,mBAAmBC,cAAeX,CAAM,GAPzCY,EAAab,CAAE,EAUjB,CAOiB,SAAbc,IAEH/G,OAAOgH,iBAAkB,QAASF,CAAY,EAC9C9F,SAASgG,iBAAkB,UAAWhB,EAAe,CAAA,CAAK,EAGrDtD,IACJC,EAAG3B,SAASsE,IAAK,EAAE2B,GAAI,mBAAoB/C,CAAuB,EAClEvB,EAAG3B,SAASsE,IAAK,EAAE2B,GAAI,mBAAoB5C,CAAwB,EACnE1B,EAAG3B,SAASsE,IAAK,EAAE2B,GAAI,mBAAoBhE,CAAiC,GAI7EjC,SAASsE,KAAKpD,UAAUgF,IAAKhG,EAAUiG,SAAU,EAEjDC,EAAkB,CAAA,CACnB,CA7vBA,IAAIzE,EAAI0E,OACJ3E,EAAoB,MAALC,EAEfyE,EAAkB,CAAA,EAClBE,EAAiB,GACjBpG,EAAY,CACfiG,UAAW,wBACXI,2BAA4B,gCAE5BC,kBAAmB,MACnBpD,6BAA8B,MAE9BqD,gBAAiB,cAEjBC,oBAAqB,mBACrBC,2BAA4B,iCAC5BC,wBAAyB,wBAEzBzG,qBAAsB,qBACtBI,aAAc,oBACdsG,oBAAqB,sBACrBC,iBAAkB,mBAClBC,iBAAkB,0CAClBC,uBAAwB,mBACxBC,0BAA2B,8OAE3BvB,wBAAyB,sYAEzBnC,gBAAiB,oBACjB2D,2BAA4B,iCAC5BrG,sBAAuB,2BACvBC,oBAAqB,yBACrBO,0BAA2B,mBAC3BoE,0BAA2B,mBAE3B0B,gCAAiC,mCACjCC,iCAAkC,iCAClCC,mCAAoC,mCAEpCC,sBAAuB,qBACvBC,qBAAsB,oBACtBC,mBAAoB,kBACpBC,gBAAiB,eAEjBrG,eAAgB,aAChBmB,eAAgB,aAChBmF,eAAgB,aAChBC,gBAAiB,cACjBC,wBAAyB,yCACzBC,yBAA0B,wCAC1BC,qBAAsB,gCAEtBrE,kCAAmC,4CACnCI,8BAA+B,wBAC/BE,iCAAkC,2CAClCC,6BAA8B,uBAE9B+D,wBAAyB,gEAEzBC,yBAA0B,yBAC1BxD,2BAA4B,wCAC5BE,8BAA+B,iCAC/BC,kCAAmC,kDACnCC,qCAAsC,mDACtCqD,sBAAuB,GAEvBC,qBAAsB,sBACtBlF,eAAgB,SAChBJ,aAAc,EACdK,YAAa,EACd,EACImC,EAAO,CACVC,MAAO,QACPC,MAAO,GACR,EAyHI3C,EAAe,SAAUlB,EAAS0G,GAGrC,IAFA,IAAIC,EAAY,EAET3G,IAED0G,CAAAA,GAAeA,GAAe1G,IAInC2G,GAAa3G,EAAQ2G,UACrB3G,EAAUA,EAAQ4G,aAGnB,OAAOD,CACR,EA0BIE,EAAoB,SAAU7H,GAEjC,IAEIG,EACAF,EAHGD,IAEHG,EAAuBH,EAAeR,cAAeC,EAAUW,qBAAsB,EACrFH,EAAqBD,EAAeR,cAAeC,EAAUY,mBAAoB,EAGrFC,iBAAiBE,OAAQL,CAAqB,EAC9CG,iBAAiBC,SAAUN,CAAmB,EAG9CD,EAAeS,UAAUgF,IAAKhG,EAAUkB,cAAe,EACxD,EAiFImH,EAAmB,SAAU9H,GAEhC,IAoBK+H,EApBE/H,IAGFzB,OAAO4G,oBAAsB,CAAEA,mBAAmB6C,kBAAmBhI,CAAe,GAEpFiI,EAAoBjI,EAAeR,cAAeC,EAAU6H,uBAAwB,IAEvFW,EAAkBpH,MAAM,GAQ1Bd,EAAqBC,CAAe,EAG/BiB,IAEA8G,EAAiB/H,EAAeR,cAAeC,EAAUgH,0BAA2B,EACxF1F,EAASgH,CAAe,EAGxB7G,EAAG,0CAA2C,EAAER,OAAO,EAGvDQ,EAAG3B,SAASsE,IAAK,EAAEqE,QAAS,iBAAkB,IAEhD,EAiEIjG,EAA0B,WAC7B,IAAIF,EAAuB,EAGvBoG,EAAqB5I,SAASC,cAAeC,EAAUwG,mBAAoB,EAO/E,GANKkC,IAEJpG,GADaoG,EAAmBC,sBAAsB,EAAEC,QAKpD9J,OAAO+J,aAAe,CAC1B,IAAIC,EAAsBhJ,SAASM,iBAAkBJ,EAAUgI,oBAAqB,EACpF,GAAKc,GAAoD,EAA7BA,EAAoBtJ,OAC/C,IAAM,IAAIN,EAAI,EAAGA,EAAI4J,EAAoBtJ,OAAQN,CAAC,GAAK,CACtD,IAAI6J,EAAgBD,EAAoB5J,GACnC2J,aAAaG,iBAAkBD,CAAc,IAEjDzG,GADayG,EAAcJ,sBAAsB,EAAEC,OAGrD,CAEF,CAEA,OAAOtG,CACR,EA4BI2G,EAAuB,SAAUC,GAEpC,GAAOA,EAGP,GAAKpK,OAAO4G,oBAAsB,CAAEA,mBAAmB6C,kBAAmBW,CAAY,GAEjFV,EAAoBU,EAAYnJ,cAAeC,EAAU6H,uBAAwB,IAEpFW,EAAkBpH,MAAM,MAJ1B,CAYA8H,EAAYxF,aAAc1D,EAAUoH,sBAAuB,EAAG,EAI9D,IADA,IAAIhE,EAAkB8F,EAAY9I,iBAAkBJ,EAAUqD,eAAgB,EACpEnE,EAAI,EAAGA,EAAIkE,EAAgB5D,OAAQN,CAAC,GAAK,CAClD,IAAIqB,EAAiB6C,EAAgBlE,GAGjCoJ,EAAiB/H,EAAeR,cAAeC,EAAUgH,0BAA2B,EACnFsB,IACJA,EAAetH,UAAUgF,IAAKhG,EAAUqC,cAAe,EACvDf,EAASgH,CAAe,GAIzBhI,EAAqBC,CAAe,CACrC,CAaA,IAVA,IAAI4I,EAAkBD,EAAYE,cAAcrJ,cAAeC,EAAU6G,gBAAiB,EAQtFwC,GAPJF,EAAgBzF,aAAc1D,EAAUqH,qBAAsB,EAAG,EAIjE6B,EAAYtF,gBAAiB5D,EAAUqH,oBAAqB,EAG7CzH,EAAY,GACvB0J,EAAYD,EAASE,QAASL,CAAY,EACpChK,EAAI,EAAGA,EAAImK,EAAS7J,OAAQN,CAAC,GACjCA,EAAIoK,GACGD,EAASnK,GACf8B,UAAUC,OAAQjB,EAAU0H,uBAAwB,EA3J3D,GAAO8B,EAHkB1J,SAASC,cAAeC,EAAU2G,mBAAoB,EAG/E,CAGA,IAAI8C,EAAmBC,SAAUF,EAAmBG,aAAc3J,EAAUsH,kBAAmB,CAAE,EACjGmC,EAAmBG,MAAOH,CAAiB,EAAI,CAAC,EAAIA,EAGhDf,EAAqB5I,SAASC,cAAeC,EAAUwG,mBAAoB,EAG/E,GAAOkC,EAAP,CAMA,IAJA,IAAImB,EAAmBnB,EAAmBtI,iBAAkBJ,EAAU0G,uBAAwB,EAC1FoD,EAAwBD,EAAiBrK,OAGnCN,EAAI,EAAGA,EAAI2K,EAAiBrK,OAAQN,CAAC,GAAK,CACnD,IAAI6K,EAAMF,EAAiB3K,GACvBoK,EAAYI,SAAUK,EAAIJ,aAAc3J,EAAUsH,kBAAmB,CAAE,GAItEgC,EAHOM,MAAON,CAAU,EAAI,CAAC,EAAIA,IAGpBG,EACjBM,EAAI/I,UAAUgF,IAAKhG,EAAUwH,cAAe,EAG5CuC,EAAI/I,UAAUC,OAAQjB,EAAUwH,cAAe,EAI3C8B,GAAaG,EACjBM,EAAI/I,UAAUgF,IAAKhG,EAAUyH,eAAgB,EAG7CsC,EAAI/I,UAAUC,OAAQjB,EAAUyH,eAAgB,CAElD,CAGA,IACAuC,GAAmBA,EADIP,EAAmB,IACHK,EAAwBE,EAAmBF,EAG9EG,EAAyBvB,EAAmB3I,cAAeC,EAAUyG,0BAA2B,EAC/FwD,IACJA,EAAuBC,UAAYF,EAnCE,CAVA,CAqKtC,IAFA,IAnXyBzI,EAmXrB4I,EAAe,KACfC,EAAoBlK,MAAMC,MAA4BgJ,GArW7BrJ,UAGdM,iBAAkBJ,EAAU+G,yBAA0B,CAkWO,EAClE7H,EAAI,EAAGA,EAAIkL,EAAkB5K,OAAQN,CAAC,GAAK,CACpD,IAAImL,EAAmBD,EAAkBlL,GACzC,GAtXM,CAAC,GADiBqC,EAuXR8I,GAtXEC,aAAe/I,EAAQgJ,cAAgBhJ,EAAQiJ,eAAe,EAAEhL,QAsX7C,CACpC2K,EAAeE,EACf,KACD,CACD,CAGKF,GACJA,EAAa/I,MAAM,EAIpBC,EAAU6H,CAAY,EAGjB1H,GACJC,EAAG3B,SAASsE,IAAK,EAAEqE,QAAS,iBAAkB,CA/D/C,CAiED,EAOIxF,EAAwB,WAE3B,GAAK,QAAUjD,EAAUkD,8BAAgC,QAAUlD,EAAUsG,kBAA7E,CAIA,IADA,IAAI+C,EAAWzJ,EAAY,EACjBV,EAAI,EAAGA,EAAImK,EAAS7J,OAAQN,CAAC,GAAK,CAC3C,IACIuL,EADOpB,EAASnK,GACFyK,aAAc3J,EAAUuH,eAAgB,EACtDmD,EAAY1K,EAAU2H,yBAAyBgD,QAAS,cAAeF,CAAO,EAClF3K,SAASsE,KAAKpD,UAAUC,OAAQyJ,CAAU,CAC3C,CAGA,IAAIlB,EAAqB1J,SAASC,cAAeC,EAAU2G,mBAAoB,EAC3EiE,EAAkB9K,SAASC,cAAeC,EAAU4G,gBAAiB,EACpE4C,IACAiB,EAASjB,EAAmBG,aAAc3J,EAAUuH,eAAgB,EAGpEmD,EAAY1K,EAAU2H,yBAAyBgD,QAAS,cAAeF,CAAO,EAClF3K,SAASsE,KAAKpD,UAAUgF,IAAK0E,CAAU,EAGlCE,KACAC,EAAgBrB,EAAmBG,aAAc3J,EAAUuH,eAAgB,EAC9DqD,EAAgBjB,aAAc3J,EAAUuH,eAAgB,IACrDsD,IACnB/K,SAASsE,KAAKpD,UAAUgF,IAAKhG,EAAU4H,oBAAqB,CA1B4C,CA8B5G,EAKI1E,EAA+B,WAElC,GAAK,QAAUlD,EAAUkD,8BAAgC,QAAUlD,EAAUsG,kBAA7E,CAGA,IAAIkD,EAAqB1J,SAASC,cAAeC,EAAU2G,mBAAoB,EAC3EiE,EAAkB9K,SAASC,cAAeC,EAAU4G,gBAAiB,EACzE,GAAK4C,GAAsBoB,EAM1B,IALA,IAEIE,EAFgBtB,EAAmBG,aAAc3J,EAAUuH,eAAgB,IAC9DqD,EAAgBjB,aAAc3J,EAAUuH,eAAgB,EAGrEwD,EAAoBjL,SAASM,iBAAkBJ,EAAU8H,wBAAyB,EAC5E5I,EAAI,EAAGA,EAAI6L,EAAkBvL,OAAQN,CAAC,GAClC6L,EAAkB7L,GACxB8L,SAAWF,CAbuF,CAgB5G,EAgFIlF,EAAc,SAAUb,GAE3B,IAEKkG,EAYA1K,EAdAwE,EAAEM,OAAOC,QAAStF,EAAU8G,sBAAuB,GACvD/B,EAAEU,eAAe,EACbwF,EAAOlG,EAAEM,OAAOC,QAAStF,EAAUK,YAAa,EACpD4I,EAAsBgC,CAAK,GAGlBlG,EAAEM,OAAOC,QAAStF,EAAUmB,yBAA0B,GAC/D4D,EAAEU,eAAe,EACblF,EAAiBwE,EAAEM,OAAOC,QAAStF,EAAUqD,eAAgB,EACjE+E,EAAmB7H,CAAe,GAGzBwE,EAAEM,OAAOC,QAAStF,EAAUuF,yBAA0B,IAC/DR,EAAEU,eAAe,EACblF,EAAiBwE,EAAEM,OAAOC,QAAStF,EAAUqD,eAAgB,EACjEgF,EAAkB9H,CAAe,EAEnC,EAiFA,OA3BA6F,EAAe8E,KAAO,SAAUC,GAC/B,IAxnB0BC,EAAMC,EAAMC,EAClCC,EAunBCrF,IAGLlG,EAAYjB,EAAQiB,EAAWmL,CAAQ,EAGvCpH,EAA2B,EACtBjF,OAAO0M,gBACO,IAAIA,gBAhoBGJ,EAgoBwBrH,EAhoBlBsH,EAgoB8CrL,EAAU+H,sBA7nBjF,WACL,IAAI0D,EAAU5M,KAAM6M,EAAOnM,UAMvBoM,EAAUL,GAAa,CAACC,EAC5BK,aAAcL,CAAQ,EACtBA,EAAU5I,WAPE,WACb4I,EAAU,KACLD,GAAWF,EAAKS,MAAOJ,EAASC,CAAK,CACzC,EAI6BL,CAAK,EAE7BM,GAAUP,EAAKS,MAAOJ,EAASC,CAAK,CAC3C,EAinBgH,EAC/FI,QAAShM,SAASsE,IAAK,EAInCtF,OAAO+B,iBACXgF,EAAW,EAEH/G,OAAOiN,eACfA,cAAcC,QAAS,CAAE,qBAAuB,WAAanG,EAAW,CAAG,CAAE,EAE/E,EAOOO,CAER,CAAC"}