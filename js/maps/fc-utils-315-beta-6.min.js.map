{"version":3,"file":"../fc-utils-315-beta-6.min.js","sources":["fc-utils-315-beta-6.js"],"sourcesContent":["/**\n * Utility resources shared across the scripts of Fluid Checkout.\n */\n(function (root, factory) {\n\tif ( typeof define === 'function' && define.amd ) {\n\t\tdefine([], factory(root));\n\t} else if ( typeof exports === 'object' ) {\n\t\tmodule.exports = factory(root);\n\t} else {\n\t\troot.FCUtils = factory(root);\n\t}\n})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {\n\n\t'use strict';\n\n\tvar _publicMethods = { }\n\tvar _settings = {\n\t\tselect2FormRowSelector:                '.form-row.fc-select2-field',\n\t\tselect2FocusElementSelector:           '.select2-selection, input[type=\"text\"]',\n\t\tselect2OptionsSelector:                '.select2-results__options',\n\t\tselect2SelectionSelector:              '.select2-selection__rendered',\n\t\t\n\t\ttomSelectFormRowSelector:              '.form-row.fc-select2-field',\n\t\ttomSelectKeepingClosedClass:           'keeping-closed',\n\t}\n\n\n\n\t/**\n\t * PROPERTIES\n\t */\n\n\n\n\t/**\n\t * Mapping of keyboard keys based on and comparable with `event.key` values.\n\t */\n\t_publicMethods.keyboardKeys = {\n\t\tESC: 'Escape',\n\t\tENTER: 'Enter',\n\t\tSPACE: ' ',\n\t\tTAB: 'Tab',\n\t\tCAPS: 'CapsLock',\n\t\tSHIFT: 'Shift',\n\t\tFUNCTION: 'Fn',\n\t\tCONTROL: 'Control',\n\t\tCOMMAND_OR_WINDOWS: 'Meta', // This is the `Windows` logo key, or the `Command` or `âŒ˜` key on Mac keyboards.\n\t\tALT: 'Alt',\n\t\tARROW_LEFT: 'ArrowLeft',\n\t\tARROW_RIGHT: 'ArrowRight',\n\t\tARROW_UP: 'ArrowUp',\n\t\tARROW_DOWN: 'ArrowDown',\n\t}\n\n\n\n\t/**\n\t * Determine which `animationend` event is supported.\n\t */\n\t_publicMethods.animationEndEvent = window.whichAnimationEnd ? window.whichAnimationEnd() : 'animationend';\n\n\n\n\n\t/**\n\t * METHODS\n\t */\n\n\n\n\t/*!\n\t* Merge two or more objects together.\n\t* (c) 2017 Chris Ferdinandi, MIT License, https://gomakethings.com\n\t* @param   {Boolean}  deep     If true, do a deep (or recursive) merge [optional]\n\t* @param   {Object}   objects  The objects to merge together\n\t* @returns {Object}            Merged values of defaults and options\n\t*/\n\t_publicMethods.extendObject = function () {\n\t\t// Variables\n\t\tvar extended = {};\n\t\tvar deep = false;\n\t\tvar i = 0;\n\n\t\t// Check if a deep merge\n\t\tif ( Object.prototype.toString.call( arguments[0] ) === '[object Boolean]' ) {\n\t\t\tdeep = arguments[0];\n\t\t\ti++;\n\t\t}\n\n\t\t// Merge the object into the extended object\n\t\tvar merge = function (obj) {\n\t\t\tfor (var prop in obj) {\n\t\t\t\tif (obj.hasOwnProperty(prop)) {\n\t\t\t\t\t// If property is an object, merge properties\n\t\t\t\t\tif (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\n\t\t\t\t\t\textended[prop] = _publicMethods.extendObject(extended[prop], obj[prop]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\textended[prop] = obj[prop];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Loop through each object and conduct a merge\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar obj = arguments[i];\n\t\t\tmerge(obj);\n\t\t}\n\n\t\treturn extended;\n\t};\n\n\n\n\t/**\n\t * Returns a function, that, as long as it continues to be invoked, will not\n\t * be triggered. The function will be called after it stops being called for\n\t * N milliseconds. If `immediate` is passed, trigger the function on the\n\t * leading edge, instead of the trailing.\n\t *\n\t * @param   {[type]}  func       Function to be executed.\n\t * @param   {[type]}  wait       Wait time in milliseconds.\n\t * @param   {[type]}  immediate  Trigger the function on the leading edge.\n\t *\n\t * @return  function              Function to be executed, incapsulated in a timed function.\n\t */\n\t_publicMethods.debounce = function ( func, wait, immediate ) {\n\t\tvar timeout;\n\n\t\treturn function() {\n\t\t\tvar context = this, args = arguments;\n\t\t\tvar later = function() {\n\t\t\t\ttimeout = null;\n\t\t\t\tif (!immediate) func.apply( context, args );\n\t\t\t};\n\n\t\t\tvar callNow = immediate && !timeout;\n\t\t\tclearTimeout( timeout );\n\t\t\ttimeout = setTimeout( later, wait );\n\n\t\t\tif ( callNow ) func.apply( context, args );\n\t\t};\n\t};\n\n\n\n\n\n\t/**\n\t * Set the variables that track the current focused element and its value.\n\t */\n\tvar getCurrentFocusedElementGlobalVariables = function( setToRelativeSelect2 ) {\n\t\t// Set defaults\n\t\tif ( setToRelativeSelect2 !== true ) {\n\t\t\tsetToRelativeSelect2 = false;\n\t\t}\n\n\t\t// Set current focused element and value\n\t\tvar currentfocusedElement = document.activeElement;\n\n\t\t// Maybe set to relative `select2` field element,\n\t\t// if the focus is current on a `select2` field option.\n\t\tvar select2Options = currentfocusedElement.closest( _settings.select2OptionsSelector );\n\t\tif ( setToRelativeSelect2 && select2Options ) {\n\t\t\tvar select2ElementId = select2Options.getAttribute( 'id' ).replace( '-results', '-container' );\n\t\t\tcurrentfocusedElement = document.getElementById( select2ElementId );\n\t\t}\n\n\t\t// Maybe set to form row for `select2` fields\n\t\tvar currentFocusedFormRow = currentfocusedElement.closest( _settings.select2FormRowSelector );\n\t\tif ( currentFocusedFormRow && currentFocusedFormRow.querySelector( _settings.select2SelectionSelector ) ) {\n\t\t\t// Remove focus from current element as it will be replaced\n\t\t\t// This fixes an issue where `select2` fields would not work properly\n\t\t\t// after checkout is updated while focus is on a `select2` field\n\t\t\tif ( currentfocusedElement ) { currentfocusedElement.blur(); }\n\n\t\t\tcurrentfocusedElement = currentFocusedFormRow;\n\t\t}\n\n\t\treturn currentfocusedElement;\n\t}\n\n\n\n\n\n\t/**\n\t * Set the variables that track the current focused element and its value.\n\t */\n\t_publicMethods.setCurrentFocusedElementGlobalVariables = function() {\n\t\t// Set current focused element and value\n\t\twindow.fcCurrentFocusedElement = getCurrentFocusedElementGlobalVariables();\n\t\twindow.fcCurrentFocusedElementValue = window.fcCurrentFocusedElement.value;\n\t\twindow.fcCurrentFocusedElementReopenDropdown = false;\n\n\t\t// Maybe set to reopen dropdown after refocusing\n\t\t// Maybe close TomSelect dropdown when refocusing\n\t\tif ( fcCurrentFocusedElement.id.includes( '-ts-control' ) ) {\n\t\t\t// Get related select field\n\t\t\tvar formRow = fcCurrentFocusedElement.closest( _settings.tomSelectFormRowSelector );\n\t\t\tvar selectField = formRow && formRow.querySelector( 'select' );\n\n\t\t\t// Maybe set to reopen dropdown after refocusing\n\t\t\tif ( selectField && selectField.tomselect && selectField.tomselect.isOpen ) {\n\t\t\t\tfcCurrentFocusedElementReopenDropdown = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Set the variables that track the current focused element and its value.\n\t */\n\t_publicMethods.maybeSetCurrentFocusedElementGlobalVariablesRelativeSelect2 = function() {\n\t\t// Set current focused element and value,\n\t\t// and retrieve relative `select2` field element if focus is on a `select2` field option.\n\t\tvar currentFocusedSelect2Element = getCurrentFocusedElementGlobalVariables( true );\n\n\t\t// Maybe set current focused element to relative `select2` field element\n\t\tif ( currentFocusedSelect2Element ) {\n\t\t\twindow.fcCurrentFocusedElement = currentFocusedSelect2Element;\n\t\t\twindow.fcCurrentFocusedElementValue = window.fcCurrentFocusedElement.value;\n\t\t}\n\t}\n\n\n\n\t/**\n\t * Unset the variables that track the current focused element and its value.\n\t */\n\t_publicMethods.unsetCurrentFocusedElementGlobalVariables = function() {\n\t\twindow.fcCurrentFocusedElement = null;\n\t\twindow.fcCurrentFocusedElementValue = null;\n\t}\n\n\n\n\t/**\n\t * Maybe set focus back to the element that was focused before an update.\n\t * \n\t * @param  {HTMLElement}  currentFocusedElement  The element that was currently focused before an update.\n\t * @param  {mixed}        currentValue           The value of the element in focus before an update.\n\t */\n\t_publicMethods.maybeRefocusElement = function( currentFocusedElement, currentValue ) {\n\t\t// Bail if no element to focus\n\t\tif ( null == currentFocusedElement ) { return; }\n\n\t\t// Bail if focus is set to the document body\n\t\tif ( document.body === currentFocusedElement ) { return; }\n\n\t\trequestAnimationFrame( function() {\n\t\t\tvar elementToFocus;\n\n\t\t\t// Try findind the `select2` focusable element\n\t\t\tif ( currentFocusedElement.closest( _settings.select2FormRowSelector ) ) {\n\t\t\t\tvar formRow = currentFocusedElement.closest( _settings.select2FormRowSelector );\n\t\t\t\telementToFocus = formRow.querySelector( _settings.select2FocusElementSelector );\n\t\t\t}\n\t\t\t// Try findind the the current focused element after updating updated element by ID\n\t\t\telse if ( currentFocusedElement.id ) {\n\t\t\t\telementToFocus = document.getElementById( currentFocusedElement.id );\n\t\t\t}\n\t\t\t// Try findind the updated element by name attribute\n\t\t\telse if ( currentFocusedElement.getAttribute( 'name' ) ) {\n\t\t\t\tvar nameAttr = currentFocusedElement.getAttribute( 'name' );\n\t\t\t\telementToFocus = document.querySelector( '[name=\"'+nameAttr+'\"]' );\n\t\t\t}\n\n\t\t\t// Try setting focus if element is found\n\t\t\tif ( elementToFocus ) {\n\t\t\t\t// Get related select field\n\t\t\t\tvar formRow = elementToFocus.closest( _settings.tomSelectFormRowSelector );\n\t\t\t\tvar selectField = formRow && formRow.querySelector( 'select' );\n\n\t\t\t\t// Maybe set class for keeping dropdown closed\n\t\t\t\tif ( ! fcCurrentFocusedElementReopenDropdown && formRow ) {\n\t\t\t\t\tformRow.classList.add( _settings.tomSelectKeepingClosedClass );\n\t\t\t\t}\n\n\t\t\t\t// Set focus to element\n\t\t\t\telementToFocus.focus();\n\n\t\t\t\t// Try to set current value to the focused element\n\t\t\t\tif ( undefined !== currentValue && null !== currentValue && currentValue !== elementToFocus.value ) {\n\t\t\t\t\telementToFocus.value = currentValue;\n\t\t\t\t}\n\n\t\t\t\t// Set keyboard track position back to that previously to update\n\t\t\t\tsetTimeout( function(){\n\t\t\t\t\t// Try to set the same track position\n\t\t\t\t\tif ( null !== elementToFocus.selectionStart && null !== elementToFocus.selectionEnd ) {\n\t\t\t\t\t\tif ( currentFocusedElement.selectionStart && currentFocusedElement.selectionEnd ) {\n\t\t\t\t\t\t\telementToFocus.selectionStart = currentFocusedElement.selectionStart;\n\t\t\t\t\t\t\telementToFocus.selectionEnd = currentFocusedElement.selectionEnd;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Otherwise try set the track position to the end of the field\n\t\t\t\t\t\t// @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setSelectionRange\n\t\t\t\t\t\t// @see https://html.spec.whatwg.org/multipage/input.html#concept-input-apply\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\telementToFocus.selectionStart = elementToFocus.selectionEnd = 999999;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Maybe close TomSelect dropdown when refocusing\n\t\t\t\t\tif ( ! fcCurrentFocusedElementReopenDropdown && elementToFocus.id.includes( '-ts-control' ) ) {\n\t\t\t\t\t\t// Maybe close TomSelect dropdown\n\t\t\t\t\t\tif ( selectField && selectField.tomselect ) {\n\t\t\t\t\t\t\tselectField.tomselect.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove TomSelect class for keeping dropdown closed\n\t\t\t\t\tif ( formRow ) {\n\t\t\t\t\t\tformRow.classList.remove( _settings.tomSelectKeepingClosedClass );\n\t\t\t\t\t}\n\t\t\t\t}, 0 );\n\t\t\t}\n\t\t} );\n\t};\n\n\n\n\n\n\t/**\n\t * Expose public APIs.\n\t */\n\treturn _publicMethods;\n\n});\n"],"names":["root","factory","define","amd","exports","module","FCUtils","global","this","window","getCurrentFocusedElementGlobalVariables","setToRelativeSelect2","currentfocusedElement","document","activeElement","select2Options","closest","_settings","select2ElementId","getAttribute","replace","getElementById","currentFocusedFormRow","querySelector","blur","_publicMethods","keyboardKeys","ESC","ENTER","SPACE","TAB","CAPS","SHIFT","FUNCTION","CONTROL","COMMAND_OR_WINDOWS","ALT","ARROW_LEFT","ARROW_RIGHT","ARROW_UP","ARROW_DOWN","animationEndEvent","whichAnimationEnd","extendObject","extended","deep","i","Object","prototype","toString","call","arguments","length","prop","obj","hasOwnProperty","debounce","func","wait","immediate","timeout","context","args","callNow","clearTimeout","setTimeout","apply","setCurrentFocusedElementGlobalVariables","selectField","fcCurrentFocusedElement","fcCurrentFocusedElementValue","value","fcCurrentFocusedElementReopenDropdown","id","includes","formRow","tomselect","isOpen","maybeSetCurrentFocusedElementGlobalVariablesRelativeSelect2","currentFocusedSelect2Element","unsetCurrentFocusedElementGlobalVariables","maybeRefocusElement","currentFocusedElement","currentValue","body","requestAnimationFrame","elementToFocus","nameAttr","classList","add","focus","undefined","selectionStart","selectionEnd","close","remove"],"mappings":"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"}